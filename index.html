<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium POS System - Geraiku</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #eef2ff;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --success-color: #10b981;
            --success-light: #d1fae5;
            --danger-color: #ef4444;
            --danger-light: #fee2e2;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --info-color: #3b82f6;
            --info-light: #dbeafe;
            --gray-color: #6b7280;
            --gray-light: #f3f4f6;
            --profit-color: #8b5cf6;
            --profit-light: #f5f3ff;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --rounded-sm: 0.25rem;
            --rounded: 0.5rem;
            --rounded-lg: 0.75rem;
            --rounded-xl: 1rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #fff;
            padding: 15px 20px;
            border-radius: var(--rounded-lg);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all .3s ease;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-info {
            text-align: right;
        }

        .header-info p {
            margin: 2px 0;
            font-size: .9rem;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            transition: all .3s ease;
        }

        .left-panel {
            flex: 1;
            min-width: 300px;
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: all .3s ease;
        }

        .right-panel {
            flex: 2;
            min-width: 400px;
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: all .3s ease;
        }

        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
            transition: all .3s;
        }

        .form-control:focus {
            border-color: var(--accent-color);
            outline: 0;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, .2);
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: var(--rounded-sm);
            cursor: pointer;
            font-size: 1rem;
            transition: all .3s;
            text-align: center;
            font-weight: 500;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #0d9b6c;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover {
            background-color: #e69007;
        }

        .btn-info {
            background-color: var(--info-color);
        }

        .btn-info:hover {
            background-color: #2563eb;
        }

        .btn-secondary {
            background-color: var(--gray-color);
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: .85rem;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }

        .table td, .table th {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #f1f3f5;
            font-weight: 500;
            color: #555;
            position: sticky;
            top: 0;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: .75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .badge-success {
            background-color: var(--success-light);
            color: #065f46;
        }

        .badge-danger {
            background-color: var(--danger-light);
            color: #b91c1c;
        }

        .badge-warning {
            background-color: var(--warning-light);
            color: #92400e;
        }

        .badge-info {
            background-color: var(--info-light);
            color: #1e40af;
        }

        .badge-primary {
            background-color: #eef2ff;
            color: var(--primary-color);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            padding-left: 40px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            transition: all .2s ease;
        }

        .cart-item:hover {
            background-color: #f9f9f9;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .cart-item-price {
            color: #666;
            font-size: .9rem;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
        }

        .cart-item-qty button {
            width: 25px;
            height: 25px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            cursor: pointer;
            border-radius: 3px;
            transition: all .2s;
        }

        .cart-item-qty button:hover {
            background-color: #e9ecef;
        }

        .cart-item-qty input {
            width: 40px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 3px;
        }

        .cart-summary {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #ddd;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-label {
            font-weight: 500;
        }

        .summary-value {
            font-weight: 500;
        }

        .total-row {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .payment-methods {
            margin-top: 20px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: all .2s;
        }

        .payment-method:hover {
            background-color: #f8f9fa;
        }

        .payment-method input {
            margin-right: 10px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all .3s;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .tab-content {
            display: none;
            animation: fadeIn .3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, .5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn .3s ease;
        }

        .modal-content {
            background-color: #fff;
            border-radius: var(--rounded-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn .3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-modal .modal-content {
            max-width: 95%;
            width: 95%;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: 0 0;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            transition: all .2s;
        }

        .modal-close:hover {
            color: #333;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: #fff;
            border-radius: var(--rounded-xl);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            animation: slideUp .4s ease;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 600;
        }

        .form-floating {
            position: relative;
            margin-bottom: 20px;
        }

        .form-floating input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
            transition: all .3s;
        }

        .form-floating input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, .2);
        }

        .form-floating label {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #999;
            transition: all .3s;
            pointer-events: none;
            background-color: #fff;
            padding: 0 5px;
        }

        .form-floating input:focus + label,
        .form-floating input:not(:placeholder-shown) + label {
            top: -10px;
            left: 10px;
            font-size: .8rem;
            color: var(--primary-color);
            font-weight: 500;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .login-logo i {
            font-size: 3rem;
            color: var(--primary-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .receipt {
            background-color: #fff;
            padding: 20px;
            font-family: 'Courier New', monospace;
            max-width: 300px;
            margin: 0 auto;
            box-shadow: var(--shadow-sm);
            position: relative;
            font-size: 14px;
        }

        .receipt::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url(https://raw.githubusercontent.com/LenteraKarya/transaksi/main/watermak-struk.png);
            background-repeat: no-repeat;
            background-position: center;
            background-size: 60%;
            opacity: .1;
            pointer-events: none;
            z-index: 0;
        }

        .receipt > * {
            position: relative;
            z-index: 1;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .receipt-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .receipt-address {
            font-size: .8rem;
            margin-bottom: 5px;
        }

        .receipt-date {
            font-size: .8rem;
            margin-bottom: 10px;
        }

        .receipt-items {
            margin-bottom: 15px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: .9rem;
        }

        .receipt-total {
            border-top: 1px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: 700;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 15px;
            font-size: .8rem;
        }

        .float-right {
            float: right;
        }

        .ml-2 {
            margin-left: 10px;
        }

        .mt-2 {
            margin-top: 10px;
        }

        .mt-3 {
            margin-top: 15px;
        }

        .mt-4 {
            margin-top: 20px;
        }

        .mb-3 {
            margin-bottom: 15px;
        }

        .admin-password-modal {
            max-width: 400px;
        }

        .admin-password-modal .modal-content {
            max-width: 400px;
        }

        .password-input-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
            transition: all .2s;
        }

        .password-toggle:hover {
            color: #333;
        }

        .error-message {
            color: var(--danger-color);
            font-size: .8rem;
            margin-top: 5px;
            display: none;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid hsla(0, 0%, 100%, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #333;
            color: #fff;
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow-md);
            z-index: 1100;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform .3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: var(--success-color);
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        .toast.info {
            background-color: var(--info-color);
        }

        .toast i {
            margin-right: 10px;
        }

        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, .5);
            z-index: 1200;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn .3s ease;
        }

        .confirmation-content {
            background-color: #fff;
            padding: 20px;
            border-radius: var(--rounded-lg);
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

      @media print {
            body * {
                visibility: hidden;
                margin: 0;
                padding: 0;
            }
            .receipt, .receipt * {
                visibility: visible;
            }
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm; /* Lebar struk standar */
                max-width: 100%;
                margin: 0;
                padding: 10px;
                font-size: 14px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                box-shadow: none;
                border: none;
                page-break-after: avoid;
                page-break-inside: avoid;
            }
            @page {
                size: auto;
                margin: 0;
            }
        }
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                min-width: 100%;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header-info {
                text-align: center;
                margin-top: 10px;
            }
            .modal-content {
                width: 95%;
            }
            .admin-modal .modal-content {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            .login-container {
                padding: 30px 20px;
                margin: 20px auto;
            }
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            .tab {
                padding: 10px 15px;
            }
            #adminAccess {
                bottom: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: .8rem;
            }
            .receipt {
                max-width: 100%;
                padding: 15px;
                font-size: 12px;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity .3s;
            font-size: .8rem;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }

        .data-backup {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .backup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .sales-report {
            margin-top: 20px;
        }

        .report-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .report-card {
            flex: 1;
            min-width: 200px;
            background: #fff;
            border-radius: var(--rounded-sm);
            padding: 15px;
            box-shadow: var(--shadow-sm);
        }

        .report-card-title {
            font-size: .9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .report-card-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all .3s;
            z-index: 100;
        }

        .fab:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .fab i {
            font-size: 1.5rem;
        }

        .input-group {
            display: flex;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .input-group button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        .fade-in {
            animation: fadeIn .3s ease;
        }

        .slide-up {
            animation: slideUp .3s ease;
        }

        .print-btn {
            background-color: var(--gray-color);
        }

        .print-btn:hover {
            background-color: #4b5563;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-active {
            background-color: var(--success-color);
        }

        .status-inactive {
            background-color: var(--danger-color);
        }

        .qr-container {
            text-align: center;
            margin: 20px 0;
        }

        .qr-container canvas {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fff;
        }

        .barcode-container {
            text-align: center;
            margin: 20px 0;
        }

        .barcode-container svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fff;
        }

        .product-brand-unit {
            font-size: .8rem;
            color: #666;
            margin-top: 3px;
        }

        .stock-opname-container {
            margin-top: 20px;
            border: 1px solid #eee;
            border-radius: var(--rounded);
            padding: 15px;
        }

        .stock-opname-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stock-opname-item:last-child {
            border-bottom: none;
        }

        .stock-opname-actions {
            display: flex;
            gap: 10px;
        }

        .return-reason {
            margin-top: 15px;
        }

        .return-reason textarea {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            padding: 10px;
        }

        .promo-card {
            background-color: var(--primary-light);
            border-radius: var(--rounded);
            padding: 15px;
            margin-bottom: 15px;
        }

        .promo-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .promo-card-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .promo-card-dates {
            font-size: .8rem;
            color: var(--gray-color);
        }

        .promo-card-products {
            margin-top: 10px;
            font-size: .9rem;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .dashboard-card {
            background: white;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card-icon {
            font-size: 2.5rem;
            padding: 15px;
            border-radius: 50%;
            color: white;
        }

        .icon-sales { background-color: var(--success-color); }
        .icon-profit { background-color: var(--profit-color); }
        .icon-transactions { background-color: var(--info-color); }
        .icon-low-stock { background-color: var(--warning-color); }

        .dashboard-card-content .dashboard-card-label {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .dashboard-card-content .dashboard-card-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        #heldSalesList {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .held-sale-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--rounded);
            margin-bottom: 10px;
            background-color: var(--primary-light);
        }

        /* Shift Management */
        .shift-history {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .shift-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: all 0.2s;
        }

        .shift-item:hover {
            background-color: #f8f9fa;
        }

        .shift-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .shift-details {
            font-size: 0.85rem;
            color: #666;
        }

        /* Inventory Management */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .inventory-item {
            background: white;
            border-radius: var(--rounded);
            padding: 15px;
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: all 0.2s;
        }

        .inventory-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .inventory-item-name {
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .inventory-item-stock {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Customer Management */
        .customer-card {
            background: white;
            border-radius: var(--rounded);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-sm);
        }

        .customer-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .customer-name {
            font-weight: 600;
            color: var(--primary-color);
        }

        .customer-type {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 20px;
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .customer-details {
            font-size: 0.9rem;
            color: #666;
        }

        /* Responsive Dashboard Cards */
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
       /* Tambahkan media query berikut untuk perbaikan mobile */
        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .dashboard-card {
                padding: 15px;
                flex-direction: column;
                text-align: center;
            }
            
            .dashboard-card-icon {
                margin-bottom: 10px;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
            
            .header-info p {
                font-size: 0.8rem;
            }
            
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .cart-item-qty {
                margin-top: 10px;
                width: 100%;
            }
            
            .payment-method {
                padding: 5px;
            }
            
            .modal-content {
                width: 95%;
                max-width: 95%;
            }
            
            .fab {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }
            
            #shiftAccess {
                bottom: 70px;
            }
        }
    </style>
</head>
<body>
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <div id="confirmationDialog" class="confirmation-dialog" style="display: none;">
        <div class="confirmation-content">
            <h4 id="confirmationMessage">Apakah Anda yakin?</h4>
            <div class="confirmation-buttons">
                <button id="confirmCancel" class="btn btn-secondary">Batal</button>
                <button id="confirmOk" class="btn btn-danger">Ya, Lanjutkan</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-cash-register"></i>
            </div>
            <h2 class="login-title">Premium POS - Geraiku</h2>
            <form id="loginForm">
                <div class="form-floating">
                    <input type="text" id="cashierId" placeholder="ID Kasir" required>
                    <label for="cashierId">ID Kasir</label>
                    <div class="error-message" id="cashierIdError"></div>
                </div>
                <div class="form-floating">
                    <input type="password" id="cashierPin" placeholder="PIN" required maxlength="4" inputmode="numeric">
                    <label for="cashierPin">PIN</label>
                    <div class="error-message" id="cashierPinError"></div>
                </div>
                <button type="submit" class="btn btn-block" id="loginBtn">
                    <span id="loginBtnText">Login</span>
                </button>
            </form>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-sales"><i class="fas fa-dollar-sign"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Penjualan Hari Ini</div>
                    <div class="dashboard-card-value" id="todaySales">Rp 0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-profit"><i class="fas fa-chart-line"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Laba Hari Ini</div>
                    <div class="dashboard-card-value" id="todayProfit">Rp 0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-transactions"><i class="fas fa-shopping-cart"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Transaksi Hari Ini</div>
                    <div class="dashboard-card-value" id="todayTransactions">0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-low-stock"><i class="fas fa-box-open"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Stok Rendah</div>
                    <div class="dashboard-card-value" id="lowStockItems">0</div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="header">
                <div>
                    <h1 id="storeName">Premium POS System</h1>
                    <p id="storeAddress">Jl. Contoh No. 123, Kota Contoh</p>
                </div>
                <div class="header-info">
                    <p id="currentDate">Senin, 1 Januari 2023</p>
                    <p>Kasir: <span id="loggedInCashier">John Doe</span> | <a href="#" id="logoutBtn" style="color: white; text-decoration: none;">Logout</a></p>
                    <p>Shift: <span id="shiftStatus" class="badge badge-danger">Belum Dimulai</span></p>
                </div>
            </div>

            <div class="main-content">
                <div class="left-panel">
                    <h2 class="panel-title">Produk</h2>
                    
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="productSearch" class="form-control" placeholder="Cari produk (nama/barcode)...">
                    </div>

                    <div class="form-group">
                        <label for="productCategory">Kategori</label>
                        <select id="productCategory" class="form-control">
                            <option value="all">Semua Kategori</option>
                        </select>
                    </div>

                    <div id="productList" class="table-responsive" style="max-height: 50vh; overflow-y: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productListBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="right-panel">
                    <h2 class="panel-title">Transaksi</h2>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="cart">Keranjang</div>
                        <div class="tab" data-tab="customer">Pelanggan</div>
                        <div class="tab" data-tab="payment">Pembayaran</div>
                    </div>

                    <div class="tab-content active" id="cartTab">
                        <div id="cartItems"></div>
                        
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value" id="cartSubtotal">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Diskon:</span>
                                <span class="summary-value" id="cartDiscount">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Pajak:</span>
                                <span class="summary-value" id="cartTax">Rp 0</span>
                            </div>
                            <div class="summary-row total-row">
                                <span class="summary-label">Total:</span>
                                <span class="summary-value" id="cartTotal">Rp 0</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button id="holdSaleBtn" class="btn btn-warning"><i class="fas fa-pause"></i> Tahan</button>
                            <button id="nextToCustomer" class="btn btn-primary" style="flex-grow: 1;">Lanjut <i class="fas fa-arrow-right"></i></button>
                        </div>
                        
                        <div id="heldSalesSection">
                            <h4 class="mt-4">Transaksi Ditahan</h4>
                            <div id="heldSalesList">
                                <div class="empty-state">
                                    <p>Tidak ada transaksi yang ditahan.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="customerTab">
                        <div class="form-group">
                            <label for="customerType">Tipe Pelanggan</label>
                            <select id="customerType" class="form-control">
                                <option value="walkin">Pelanggan Biasa</option>
                                <option value="member">Member</option>
                            </select>
                        </div>
                        <div id="memberFields" style="display:none">
                            <div class="form-group">
                                <label for="memberId">ID Member</label>
                                <div class="input-group">
                                    <input type="text" id="memberId" class="form-control" placeholder="Masukkan ID Member">
                                    <button id="searchMember" class="btn btn-info">Cari</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="memberDiscount">Diskon Member (%)</label>
                                <input type="number" id="memberDiscount" class="form-control" value="10" min="0" max="100">
                            </div>
                        </div>
                        <div id="customerFields" style="display:none">
                            <div class="form-group">
                                <label for="customerName">Nama Pelanggan</label>
                                <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama pelanggan">
                            </div>
                            <div class="form-group">
                                <label for="customerPhone">No. Telepon</label>
                                <input type="tel" id="customerPhone" class="form-control" placeholder="Masukkan nomor telepon">
                            </div>
                            <div class="form-group">
                                <label for="customerEmail">Email (opsional)</label>
                                <input type="email" id="customerEmail" class="form-control" placeholder="Masukkan email">
                            </div>
                        </div>
                        <div class="buttons">
                            <button id="backToCart" class="btn btn-warning">Kembali ke Keranjang</button>
                            <button id="nextToPayment" class="btn btn-primary float-right">Lanjut ke Pembayaran</button>
                        </div>
                    </div>

                    <div class="tab-content" id="paymentTab">
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value" id="paymentSubtotal">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Diskon:</span>
                                <span class="summary-value" id="paymentDiscount">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Pajak:</span>
                                <span class="summary-value" id="paymentTax">Rp 0</span>
                            </div>
                            <div class="summary-row total-row">
                                <span class="summary-label">Total:</span>
                                <span class="summary-value" id="paymentTotal">Rp 0</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="paymentAmount">Jumlah Pembayaran</label>
                            <input type="number" id="paymentAmount" class="form-control" placeholder="Masukkan jumlah pembayaran">
                        </div>
                        <div class="payment-methods">
                            <label>Metode Pembayaran:</label>
                            <div class="payment-method">
                                <input type="radio" id="cash" name="paymentMethod" value="cash" checked>
                                <label for="cash">Tunai</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="transfer" name="paymentMethod" value="transfer">
                                <label for="transfer">Transfer Bank</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="ewallet" name="paymentMethod" value="ewallet">
                                <label for="ewallet">E-Wallet</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="credit" name="paymentMethod" value="credit">
                                <label for="credit">Kredit</label>
                            </div>
                        </div>
                        <div class="buttons">
                            <button id="backToCustomer" class="btn btn-warning">Kembali ke Pelanggan</button>
                            <button id="completePayment" class="btn btn-success float-right"><i class="fas fa-print"></i> Selesaikan & Cetak</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="receiptTemplate" style="display: none;"></div>

    <!-- Admin Password Modal -->
    <div id="adminPasswordModal" class="modal admin-password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Akses Admin</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="adminPassword">Masukkan Password Admin</label>
                    <div class="password-input-container">
                        <input type="password" id="adminPassword" class="form-control" placeholder="Password Admin">
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                    <div class="error-message" id="adminPasswordError"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-admin-password-modal">Batal</button>
                <button class="btn btn-primary verify-admin-password">Masuk</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard Modal -->
    <div id="adminModal" class="modal admin-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Admin Dashboard</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab admin-tab active" data-tab="reports">Laporan</div>
                    <div class="tab admin-tab" data-tab="products">Produk</div>
                    <div class="tab admin-tab" data-tab="stockIn">Stok Masuk</div>
                    <div class="tab admin-tab" data-tab="categories">Kategori</div>
                    <div class="tab admin-tab" data-tab="customers">Pelanggan</div>
                    <div class="tab admin-tab" data-tab="transactions">Transaksi</div>
                    <div class="tab admin-tab" data-tab="cashiers">Kasir</div>
                    <div class="tab admin-tab" data-tab="settings">Pengaturan</div>
                </div>

                <div class="tab-content admin-tab-content active" id="reportsTab">
                    <div class="form-group">
                        <label for="reportDateRange">Rentang Tanggal</label>
                        <input type="text" id="reportDateRange" class="form-control" placeholder="Pilih rentang tanggal">
                    </div>
                    
                    <div class="report-summary">
                        <div class="report-card">
                            <div class="report-card-title">Total Pendapatan</div>
                            <div class="report-card-value" id="reportTotalRevenue">Rp 0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Total Laba</div>
                            <div class="report-card-value" id="reportTotalProfit" style="color: var(--profit-color);">Rp 0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Total Transaksi</div>
                            <div class="report-card-value" id="reportTotalTransactions">0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Produk Terlaris</div>
                            <div class="report-card-value" id="reportBestSeller">-</div>
                        </div>
                    </div>
                    
                    <div class="sales-report">
                        <canvas id="salesChart" height="150"></canvas>
                    </div>
                    
                    <div class="mt-3">
                        <button id="exportReportPDF" class="btn btn-info"><i class="fas fa-file-pdf"></i> Ekspor ke PDF</button>
                        <button id="exportReportExcel" class="btn btn-success ml-2"><i class="fas fa-file-excel"></i> Ekspor ke Excel</button>
                        <button id="exportReportPrint" class="btn btn-secondary ml-2"><i class="fas fa-print"></i> Cetak Laporan</button>
                    </div>
                </div>
                
                <div class="tab-content admin-tab-content" id="productsTab">
                    <div class="input-group">
                        <input type="text" id="adminProductSearch" class="form-control" placeholder="Cari produk...">
                        <button class="btn btn-info" id="adminSearchProductBtn"><i class="fas fa-search"></i></button>
                    </div>
                    <button id="addProduct" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Produk</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Barcode</th>
                                    <th>Nama</th>
                                    <th>Modal</th>
                                    <th>Harga Jual</th>
                                    <th>Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminProductsTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="stockInTab">
                    <button id="addStockIn" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Catat Stok Masuk</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Nota</th>
                                    <th>Pemasok</th>
                                    <th>Total Item</th>
                                    <th>Total Biaya</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminStockInTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="categoriesTab">
                    <button id="addCategory" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Kategori</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Deskripsi</th>
                                    <th>Jumlah Produk</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCategoriesTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="customersTab">
                    <button id="addCustomer" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Pelanggan</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Telepon</th>
                                    <th>Email</th>
                                    <th>Tipe</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCustomersTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="transactionsTab">
                    <div class="form-group">
                        <label for="transactionDateRange">Rentang Tanggal</label>
                        <input type="text" id="transactionDateRange" class="form-control" placeholder="Pilih rentang tanggal">
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tanggal</th>
                                    <th>Pelanggan</th>
                                    <th>Total</th>
                                    <th>Kasir</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminTransactionsTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="cashiersTab">
                    <button id="addCashier" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Kasir</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Status</th>
                                    <th>Terakhir Login</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCashiersTable"></tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content admin-tab-content" id="settingsTab">
                    <div class="form-group">
                        <label for="storeNameSetting">Nama Toko</label>
                        <input type="text" id="storeNameSetting" class="form-control" value="">
                    </div>
                    <div class="form-group">
                        <label for="storeAddressSetting">Alamat Toko</label>
                        <textarea id="storeAddressSetting" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="storePhoneSetting">Telepon Toko</label>
                        <input type="text" id="storePhoneSetting" class="form-control" value="">
                    </div>
                    <div class="form-group">
                        <label for="taxRateSetting">Persentase Pajak (%)</label>
                        <input type="number" id="taxRateSetting" class="form-control" min="0" max="100" value="10">
                    </div>
                    <div class="form-group">
                        <label for="receiptFooterSetting">Catatan Kaki Struk</label>
                        <textarea id="receiptFooterSetting" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="data-backup">
                        <h5>Backup Data</h5>
                        <p class="text-muted">Cadangkan atau pulihkan data toko Anda</p>
                        <div class="backup-actions">
                            <button id="exportData" class="btn btn-info"><i class="fas fa-file-export"></i> Ekspor Data</button>
                            <button id="importData" class="btn btn-warning"><i class="fas fa-file-import"></i> Impor Data</button>
                            <input type="file" id="importFile" style="display: none;" accept=".json">
                        </div>
                    </div>
                    <div class="mt-4">
                        <button id="saveSettings" class="btn btn-primary">Simpan Pengaturan</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-admin-modal">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Tambah Produk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label for="productBarcode">Barcode</label>
                    <input type="text" id="productBarcode" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productName">Nama Produk</label>
                    <input type="text" id="productName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productCategoryModal">Kategori</label>
                    <select id="productCategoryModal" class="form-control"></select>
                </div>
                <div class="form-group">
                    <label for="productCostPrice">Harga Modal</label>
                    <input type="number" id="productCostPrice" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productPrice">Harga Jual</label>
                    <input type="number" id="productPrice" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productStock">Stok Awal</label>
                    <input type="number" id="productStock" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-product-modal">Batal</button>
                <button class="btn btn-success" id="saveProductBtn">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Barcode/QR Code Generator Modal -->
    <div id="codeGeneratorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Barcode & QR Code</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <h4 id="codeGeneratorProductName" class="text-center"></h4>
                <div class="barcode-container">
                    <svg id="barcode"></svg>
                </div>
                <div class="qrcode-container" id="qrcode"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-code-generator-modal">Tutup</button>
                <button class="btn btn-primary print-codes"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>
    
    <!-- Shift Management Modal -->
    <div id="shiftModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="shiftModalTitle"></h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="shiftModalBody"></div>
            <div class="modal-footer" id="shiftModalFooter"></div>
        </div>
    </div>

    <!-- Stock In Modal -->
    <div id="stockInModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="stockInModalTitle">Catat Stok Masuk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="stockInId">
                <div class="row" style="display:flex; gap: 20px;">
                    <div style="flex:1;">
                        <label for="stockInDate">Tanggal</label>
                        <input type="date" id="stockInDate" class="form-control">
                    </div>
                    <div style="flex:1;">
                        <label for="stockInRef">No. Nota/Referensi</label>
                        <input type="text" id="stockInRef" class="form-control">
                    </div>
                    <div style="flex:1;">
                        <label for="stockInSupplier">Pemasok</label>
                        <input type="text" id="stockInSupplier" class="form-control">
                    </div>
                </div>
                <hr class="my-3">
                <div class="input-group">
                    <input type="text" id="stockInProductSearch" class="form-control" placeholder="Cari produk untuk ditambahkan...">
                    <button class="btn btn-info" id="searchStockProductBtn"><i class="fas fa-search"></i> Cari</button>
                </div>
                <div class="table-responsive" style="max-height: 250px; overflow-y:auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Jml</th>
                                <th>Harga Beli</th>
                                <th>Subtotal</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="stockInItemsTable"></tbody>
                    </table>
                </div>
                <div class="cart-summary">
                    <div class="summary-row total-row">
                        <span class="summary-label">Total Biaya:</span>
                        <span class="summary-value" id="stockInTotalCost">Rp 0</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-stock-in-modal">Batal</button>
                <button class="btn btn-success" id="saveStockInBtn">Simpan Stok Masuk</button>
            </div>
        </div>
    </div>
    
    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Kategori</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="categoryName">Nama Kategori</label>
                    <input type="text" id="categoryName" class="form-control" placeholder="Masukkan nama kategori">
                </div>
                <div class="form-group">
                    <label for="categoryDescription">Deskripsi</label>
                    <textarea id="categoryDescription" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-category-modal">Batal</button>
                <button class="btn btn-success save-category"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="editCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Kategori</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCategoryId">
                <div class="form-group">
                    <label for="editCategoryName">Nama Kategori</label>
                    <input type="text" id="editCategoryName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editCategoryDescription">Deskripsi</label>
                    <textarea id="editCategoryDescription" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-edit-category-modal">Batal</button>
                <button class="btn btn-success update-category"><i class="fas fa-save"></i> Update</button>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Pelanggan</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="customerTypeModal">Tipe Pelanggan</label>
                    <select id="customerTypeModal" class="form-control">
                        <option value="walkin">Pelanggan Biasa</option>
                        <option value="member">Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customerNameModal">Nama Lengkap</label>
                    <input type="text" id="customerNameModal" class="form-control" placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label for="customerPhoneModal">No. Telepon</label>
                    <input type="tel" id="customerPhoneModal" class="form-control" placeholder="Masukkan nomor telepon">
                </div>
                <div class="form-group">
                    <label for="customerEmailModal">Email</label>
                    <input type="email" id="customerEmailModal" class="form-control" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label for="customerAddressModal">Alamat</label>
                    <textarea id="customerAddressModal" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-customer-modal">Batal</button>
                <button class="btn btn-success save-customer"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Pelanggan</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCustomerId">
                <div class="form-group">
                    <label for="editCustomerType">Tipe Pelanggan</label>
                    <select id="editCustomerType" class="form-control">
                        <option value="walkin">Pelanggan Biasa</option>
                        <option value="member">Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCustomerName">Nama Lengkap</label>
                    <input type="text" id="editCustomerName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editCustomerPhone">No. Telepon</label>
                    <input type="tel" id="editCustomerPhone" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editCustomerEmail">Email</label>
                    <input type="email" id="editCustomerEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editCustomerAddress">Alamat</label>
                    <textarea id="editCustomerAddress" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-edit-customer-modal">Batal</button>
                <button class="btn btn-success update-customer"><i class="fas fa-save"></i> Update</button>
            </div>
        </div>
    </div>

    <!-- Transaction Detail Modal -->
    <div id="transactionDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail Transaksi</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="receipt" id="transactionDetailReceipt"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary print-receipt"><i class="fas fa-print"></i> Cetak Ulang</button>
                <button class="btn btn-secondary close-detail-modal">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Cashier Modal -->
    <div id="cashierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Kasir</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cashierModalId">
                <div class="form-group">
                    <label for="cashierModalName">Nama Lengkap</label>
                    <input type="text" id="cashierModalName" class="form-control" placeholder="Masukkan nama kasir">
                </div>
                <div class="form-group">
                    <label for="cashierModalPin">PIN (4 digit)</label>
                    <input type="password" id="cashierModalPin" class="form-control" maxlength="4" inputmode="numeric" placeholder="Masukkan PIN">
                </div>
                <div class="form-group">
                    <label for="cashierModalStatus">Status</label>
                    <select id="cashierModalStatus" class="form-control">
                        <option value="active">Aktif</option>
                        <option value="inactive">Nonaktif</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-cashier-modal">Batal</button>
                <button class="btn btn-success save-cashier"><i class="fas fa-save"></i> Simpan</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div id="adminAccess" class="fab" title="Akses Admin" style="bottom: 20px;">
        <i class="fas fa-lock"></i>
    </div>
    <div id="shiftAccess" class="fab" title="Manajemen Shift" style="bottom: 90px; background-color: var(--warning-color);">
        <i class="fas fa-clock"></i>
    </div>

    <!-- Script Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>

    <script>
        // Immediately set locale for moment.js
        moment.locale('id');

        // Admin password (hidden from public)
        const ADMIN_PASSWORD = "Geraiku.12345";
        
        // Local storage keys
        const STORAGE_KEYS = {
            PRODUCTS: 'pos_premium_products',
            CATEGORIES: 'pos_premium_categories',
            CUSTOMERS: 'pos_premium_customers',
            CASHIERS: 'pos_premium_cashiers',
            TRANSACTIONS: 'pos_premium_transactions',
            SETTINGS: 'pos_premium_settings',
            CURRENT_CASHIER: 'pos_premium_current_cashier',
            HELD_SALES: 'pos_premium_held_sales',
            STOCK_IN: 'pos_premium_stock_in',
            CURRENT_SHIFT: 'pos_premium_current_shift',
            SHIFT_HISTORY: 'pos_premium_shift_history'
        };
        
        // Initialize data variables
        let products, categories, customers, cashiers, transactions, settings, heldSales, stockInRecords, currentShift, shiftHistory;
        
        // Current transaction state
        let currentCart = { 
            items: [], 
            customer: null, 
            discount: 0, 
            tax: 0, 
            subtotal: 0, 
            total: 0, 
            totalCost: 0, 
            profit: 0 
        };
        let currentCashier = null;
        let salesChart = null;
        let currentStockInItems = [];

        // --- CORE FUNCTIONS ---
        function showToast(message, type = 'info', duration = 3000) {
            const toast = $("#toast");
            const toastMessage = $("#toast-message");
            toast.removeClass("success error warning info").addClass(type);
            toastMessage.text(message);
            toast.addClass("show");
            setTimeout(() => {
                toast.removeClass("show");
            }, duration);
        }

        function showConfirmation(message, callback, btnText = "Ya, Lanjutkan") {
            const confirmationMessage = $("#confirmationMessage");
            const confirmationDialog = $("#confirmationDialog");
            const confirmOk = $("#confirmOk");
            const confirmCancel = $("#confirmCancel");
            
            confirmationMessage.text(message);
            confirmOk.text(btnText);
            confirmationDialog.css("display", "flex");
            
            confirmOk.off("click").on("click", () => {
                confirmationDialog.hide();
                callback && callback(true);
            });
            
            confirmCancel.off("click").on("click", () => {
                confirmationDialog.hide();
                callback && callback(false);
            });
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat("id-ID", {
                style: "currency",
                currency: "IDR",
                minimumFractionDigits: 0
            }).format(amount || 0);
        }

        function exportToExcel(data, filename) {
            try {
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Laporan");
                XLSX.writeFile(workbook, filename || "export.xlsx");
                showToast("Excel berhasil diekspor", "success");
            } catch (error) {
                showToast("Gagal mengekspor ke Excel", "error");
                console.error("Excel export error:", error);
            }
        }

        // --- DATA SAVING & LOADING ---
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

         function initializeDefaultData() {
            loadData();

            if (cashiers.length === 0) {
                cashiers = [
                    { id: 'K001', name: 'Admin', pin: '1234', status: 'active', lastLogin: null },
                    { id: 'K002', name: 'Kasir 1', pin: '1111', status: 'active', lastLogin: null },
                ];
                saveData(STORAGE_KEYS.CASHIERS, cashiers);
            }

        
        function loadData() {
            products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS)) || [];
            categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.CATEGORIES)) || [];
            customers = JSON.parse(localStorage.getItem(STORAGE_KEYS.CUSTOMERS)) || [];
            cashiers = JSON.parse(localStorage.getItem(STORAGE_KEYS.CASHIERS)) || [];
            transactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS)) || [];
            settings = JSON.parse(localStorage.getItem(STORAGE_KEYS.SETTINGS)) || {};
            heldSales = JSON.parse(localStorage.getItem(STORAGE_KEYS.HELD_SALES)) || [];
            stockInRecords = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK_IN)) || [];
            currentCashier = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_CASHIER)) || null;
            currentShift = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_SHIFT)) || null;
            shiftHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.SHIFT_HISTORY)) || [];
        }

                   if (Object.keys(settings).length === 0) {
                settings = {
                    storeName: "Toko Geraiku",
                    storeAddress: "Jl. Digital Raya No. 1",
                    storePhone: "081234567890",
                    taxRate: 10,
                    receiptFooter: "Terima kasih telah berbelanja!"
                };
                saveData(STORAGE_KEYS.SETTINGS, settings);
            }

            if (categories.length === 0) {
                categories = [
                    { id: 'C001', name: 'Makanan Ringan', description: '' },
                    { id: 'C002', name: 'Minuman Dingin', description: '' },
                ];
                saveData(STORAGE_KEYS.CATEGORIES, categories);
            }

            if (products.length === 0) {
                products = [
                    { id: 'P001', barcode: '8992761134015', name: 'Chitato Sapi Panggang', categoryId: 'C001', costPrice: 7500, price: 10000, stock: 50 },
                    { id: 'P002', barcode: '8996001300032', name: 'Coca-Cola 390ml', categoryId: 'C002', costPrice: 3500, price: 5000, stock: 100 },
                    { id: 'P003', barcode: '8886008101068', name: 'Pocari Sweat 500ml', categoryId: 'C002', costPrice: 5000, price: 7000, stock: 3 },
                ];
                saveData(STORAGE_KEYS.PRODUCTS, products);
            }
        }
        
        // --- UI UPDATE FUNCTIONS ---
        function updateAllUI() {
            updateCurrentDate();
            updateDashboard();
            loadProducts();
            updateCategoryDropdowns();
            updateCart();
            updateHeldSalesList();
            updateShiftStatus();
            
            // Update settings display
            $('#storeName').text(settings.storeName);
            $('#storeAddress').text(settings.storeAddress);
            
            // Update settings form
            $('#storeNameSetting').val(settings.storeName);
            $('#storeAddressSetting').val(settings.storeAddress);
            $('#storePhoneSetting').val(settings.storePhone);
            $('#taxRateSetting').val(settings.taxRate);
            $('#receiptFooterSetting').val(settings.receiptFooter);
        }

        function updateCurrentDate() {
            $('#currentDate').text(moment().format('dddd, D MMMM YYYY, HH:mm'));
        }

        function updateDashboard() {
            const today = moment().startOf('day');
            const todayTransactions = transactions.filter(t => moment(t.date).isSameOrAfter(today));
            
            const todaySales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            const todayProfit = todayTransactions.reduce((sum, t) => sum + t.profit, 0);
            const lowStockItems = products.filter(p => p.stock <= 5 && p.stock > 0).length;

            $('#todaySales').text(formatCurrency(todaySales));
            $('#todayProfit').text(formatCurrency(todayProfit));
            $('#todayTransactions').text(todayTransactions.length);
            $('#lowStockItems').text(lowStockItems);
        }

        function updateCart() {
            currentCart.subtotal = currentCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            currentCart.totalCost = currentCart.items.reduce((sum, item) => sum + (item.costPrice * item.quantity), 0);
            
            // Recalculate discount and tax
            const discountPercentage = currentCart.customer?.type === 'member' ? (parseInt($('#memberDiscount').val()) || 0) : 0;
            currentCart.discount = (currentCart.subtotal * discountPercentage) / 100;
            currentCart.tax = ((currentCart.subtotal - currentCart.discount) * settings.taxRate) / 100;
            currentCart.total = currentCart.subtotal - currentCart.discount + currentCart.tax;
            currentCart.profit = (currentCart.subtotal - currentCart.discount) - currentCart.totalCost;

            // Render Cart Items
            $('#cartItems').empty();
            if (currentCart.items.length === 0) {
                $('#cartItems').html('<div class="empty-state"><i class="fas fa-shopping-cart"></i><p>Keranjang belanja kosong</p></div>');
            } else {
                currentCart.items.forEach(item => {
                    $('#cartItems').append(`
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">${formatCurrency(item.price)}</div>
                            </div>
                            <div class="cart-item-qty">
                                <input type="number" value="${item.quantity}" min="1" max="${item.stock}" class="cart-item-quantity" data-id="${item.productId}">
                                <button class="btn btn-danger btn-sm ml-2 remove-from-cart" data-id="${item.productId}"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `);
                });
            }

            // Update Summaries
            $('#cartSubtotal, #paymentSubtotal').text(formatCurrency(currentCart.subtotal));
            $('#cartDiscount, #paymentDiscount').text(formatCurrency(currentCart.discount));
            $('#cartTax, #paymentTax').text(formatCurrency(currentCart.tax));
            $('#cartTotal, #paymentTotal').text(formatCurrency(currentCart.total));
        }

        function resetCart() {
            currentCart = { items: [], customer: null, discount: 0, tax: 0, subtotal: 0, total: 0, totalCost: 0, profit: 0 };
            updateCart();
            // Reset customer form
            $('#customerType').val('walkin').trigger('change');
            $('#memberId, #customerName, #customerPhone, #customerEmail').val('');
            // Reset payment form
            $('#paymentAmount').val('');
        }

        function loadProducts(searchTerm = '', categoryId = 'all') {
            let filteredProducts = products;
            if (searchTerm) {
                searchTerm = searchTerm.toLowerCase();
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.barcode.includes(searchTerm)
                );
            }
            if (categoryId !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.categoryId === categoryId);
            }

            const productListBody = $('#productListBody');
            productListBody.empty();
            if (filteredProducts.length === 0) {
                productListBody.html('<tr><td colspan="4"><div class="empty-state"><p>Produk tidak ditemukan</p></div></td></tr>');
            } else {
                filteredProducts.forEach(product => {
                    const stockClass = product.stock <= 5 ? 'text-danger' : product.stock <= 10 ? 'text-warning' : '';
                    productListBody.append(`
                        <tr>
                            <td>${product.name}</td>
                            <td>${formatCurrency(product.price)}</td>
                            <td class="${stockClass}">${product.stock}</td>
                            <td>
                                <button class="btn btn-success btn-sm add-to-cart" data-id="${product.id}" ${product.stock <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        function updateCategoryDropdowns() {
            const selects = $('#productCategory, #productCategoryModal');
            selects.empty().append('<option value="all">Semua Kategori</option>');
            categories.forEach(c => selects.append(`<option value="${c.id}">${c.name}</option>`));
        }

        // --- TRANSACTION MANAGEMENT ---
        function holdSale() {
            if (currentCart.items.length === 0) {
                showToast('Keranjang kosong, tidak ada yang bisa ditahan.', 'warning');
                return;
            }
            const saleName = `Pelanggan #${heldSales.length + 1} - ${moment().format('HH:mm')}`;
            heldSales.push({ name: saleName, cart: currentCart });
            saveData(STORAGE_KEYS.HELD_SALES, heldSales);
            resetCart();
            updateHeldSalesList();
            showToast(`Transaksi "${saleName}" berhasil ditahan.`, 'success');
        }

        function resumeSale(index) {
            const saleToResume = heldSales[index];
            if (currentCart.items.length > 0) {
                showToast('Selesaikan atau tahan transaksi saat ini terlebih dahulu.', 'warning');
                return;
            }
            currentCart = saleToResume.cart;
            heldSales.splice(index, 1); // Remove from held list
            saveData(STORAGE_KEYS.HELD_SALES, heldSales);
            updateCart();
            updateHeldSalesList();
            showToast(`Transaksi "${saleToResume.name}" dilanjutkan.`, 'info');
        }

        function deleteHeldSale(index) {
            const saleName = heldSales[index].name;
            showConfirmation(`Yakin ingin menghapus transaksi tertahan "${saleName}"?`, (confirmed) => {
                if (confirmed) {
                    heldSales.splice(index, 1);
                    saveData(STORAGE_KEYS.HELD_SALES, heldSales);
                    updateHeldSalesList();
                    showToast('Transaksi tertahan dihapus.', 'success');
                }
            });
        }
        
        function updateHeldSalesList() {
            const list = $('#heldSalesList');
            list.empty();
            if (heldSales.length === 0) {
                list.html('<div class="empty-state"><p>Tidak ada transaksi yang ditahan.</p></div>');
            } else {
                heldSales.forEach((sale, index) => {
                    list.append(`
                        <div class="held-sale-item">
                            <span><i class="fas fa-user-clock"></i> ${sale.name}</span>
                            <div>
                                <button class="btn btn-info btn-sm resume-sale" data-index="${index}"><i class="fas fa-play"></i> Lanjutkan</button>
                                <button class="btn btn-danger btn-sm delete-held-sale" data-index="${index}"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `);
                });
            }
        }

        function completePayment() {
            if (!currentShift || !currentShift.isActive) {
                showToast('Shift belum dimulai. Harap mulai shift terlebih dahulu.', 'error');
                return;
            }
            
            const paymentAmount = parseFloat($('#paymentAmount').val()) || 0;
            if (paymentAmount < currentCart.total) {
                showToast('Jumlah pembayaran kurang dari total.', 'error');
                return;
            }

            const transaction = {
                id: 'T' + moment().format('YYYYMMDDHHmmss'),
                date: new Date(),
                ...currentCart, // Spread all cart properties
                paymentMethod: $('input[name="paymentMethod"]:checked').val(),
                paymentAmount: paymentAmount,
                change: paymentAmount - currentCart.total,
                cashier: {id: currentCashier.id, name: currentCashier.name},
                shiftId: currentShift.startTime // Link transaction to shift
            };

            // Update product stock
            transaction.items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if (product) {
                    product.stock -= item.quantity;
                }
            });

            transactions.unshift(transaction);
            saveData(STORAGE_KEYS.TRANSACTIONS, transactions);
            saveData(STORAGE_KEYS.PRODUCTS, products);

            generateReceipt(transaction);
            setTimeout(() => window.print(), 500);

            resetCart();
            updateAllUI();
            showToast('Transaksi berhasil!', 'success');
            $('.tab').removeClass('active');
            $('[data-tab="cart"]').addClass('active');
            $('.tab-content').removeClass('active');
            $('#cartTab').addClass('active');
        }

       function generateReceipt(transaction) {
    let receiptHTML = `
        <div class="receipt">
            <div class="receipt-header" style="text-align: center; margin-bottom: 10px;">
                <div class="receipt-title" style="font-weight: bold; font-size: 1.2em;">${settings.storeName}</div>
                <div class="receipt-address">${settings.storeAddress}</div>
                ${settings.storePhone ? `<div class="receipt-phone">Telp: ${settings.storePhone}</div>` : ''}
                <div class="receipt-date" style="margin: 5px 0;">${moment(transaction.date).format('DD/MM/YYYY HH:mm')}</div>
                <div class="receipt-id">No: ${transaction.id}</div>
                <hr style="border-top: 1px dashed #000; margin: 5px 0;">
            </div>
            <div class="receipt-items" style="margin-bottom: 10px;">`;
    
    transaction.items.forEach(item => {
        receiptHTML += `
            <div class="receipt-item" style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                <div style="flex: 3;">${item.name}</div>
                <div style="flex: 1; text-align: right;">${item.quantity}x</div>
                <div style="flex: 2; text-align: right;">${formatCurrency(item.price * item.quantity)}</div>
            </div>`;
    });

    receiptHTML += `
            </div>
            <hr style="border-top: 1px dashed #000; margin: 5px 0;">
            <div class="receipt-total" style="margin-top: 5px;">
                <div class="receipt-item" style="display: flex; justify-content: space-between;">
                    <span>Subtotal</span>
                    <span>${formatCurrency(transaction.subtotal)}</span>
                </div>
                ${transaction.discount > 0 ? `
                <div class="receipt-item" style="display: flex; justify-content: space-between;">
                    <span>Diskon</span>
                    <span>-${formatCurrency(transaction.discount)}</span>
                </div>` : ''}
                <div class="receipt-item" style="display: flex; justify-content: space-between;">
                    <span>Pajak</span>
                    <span>${formatCurrency(transaction.tax)}</span>
                </div>
                <div class="receipt-item" style="display: flex; justify-content: space-between; font-weight: bold; margin-top: 5px;">
                    <span>TOTAL</span>
                    <span>${formatCurrency(transaction.total)}</span>
                </div>
                <div class="receipt-item" style="display: flex; justify-content: space-between; margin-top: 10px;">
                    <span>${transaction.paymentMethod.toUpperCase()}</span>
                    <span>${formatCurrency(transaction.paymentAmount)}</span>
                </div>
                <div class="receipt-item" style="display: flex; justify-content: space-between;">
                    <span>Kembali</span>
                    <span>${formatCurrency(transaction.change)}</span>
                </div>
            </div>
            <hr style="border-top: 1px dashed #000; margin: 10px 0 5px;">
            <div class="receipt-footer" style="text-align: center; font-size: 0.8em;">
                <div>${settings.receiptFooter}</div>
                <div style="margin-top: 5px;">Kasir: ${transaction.cashier.name}</div>
                <div style="margin-top: 10px;">Terima kasih telah berbelanja</div>
            </div>
        </div>`;
    
    $('#receiptTemplate').html(receiptHTML);
    $('#transactionDetailReceipt').html(receiptHTML);
}

        // --- SHIFT MANAGEMENT ---
        function updateShiftStatus() {
            const statusBadge = $('#shiftStatus');
            if (currentShift && currentShift.isActive) {
                statusBadge.text(`Aktif Sejak ${moment(currentShift.startTime).format('HH:mm')}`).removeClass('badge-danger').addClass('badge-success');
            } else {
                statusBadge.text('Belum Dimulai').removeClass('badge-success').addClass('badge-danger');
            }
        }

        function manageShift() {
            const modalTitle = $('#shiftModalTitle');
            const modalBody = $('#shiftModalBody');
            const modalFooter = $('#shiftModalFooter');

            if (currentShift && currentShift.isActive) {
                // Form to end shift
                modalTitle.text('Akhiri Shift');
                const cashSales = transactions
                    .filter(t => moment(t.date).isAfter(moment(currentShift.startTime)) && t.paymentMethod === 'cash')
                    .reduce((sum, t) => sum + t.total, 0);
                const expectedCash = currentShift.openingBalance + cashSales;
                
                modalBody.html(`
                    <p>Shift dimulai: <strong>${moment(currentShift.startTime).format('LLL')}</strong></p>
                    <p>Modal Awal: <strong>${formatCurrency(currentShift.openingBalance)}</strong></p>
                    <p>Total Penjualan Tunai: <strong>${formatCurrency(cashSales)}</strong></p>
                    <hr>
                    <p>Total Uang di Laci (Harusnya): <strong>${formatCurrency(expectedCash)}</strong></p>
                    <div class="form-group mt-3">
                        <label for="closingBalance">Jumlah Uang Aktual di Laci</label>
                        <input type="number" id="closingBalance" class="form-control" placeholder="Masukkan jumlah aktual">
                    </div>
                `);
                modalFooter.html(`
                    <button class="btn btn-secondary close-shift-modal">Batal</button>
                    <button class="btn btn-danger" id="endShiftBtn">Akhiri Shift</button>
                `);

                $('#endShiftBtn').on('click', function() {
                    const closingBalance = parseFloat($('#closingBalance').val());
                    if (isNaN(closingBalance)) {
                        showToast('Masukkan jumlah uang aktual.', 'error'); 
                        return;
                    }
                    
                    currentShift.endTime = new Date();
                    currentShift.isActive = false;
                    currentShift.cashSales = cashSales;
                    currentShift.expectedBalance = expectedCash;
                    currentShift.closingBalance = closingBalance;
                    currentShift.difference = closingBalance - expectedCash;
                    
                    // Add to shift history
                    shiftHistory.unshift(currentShift);
                    saveData(STORAGE_KEYS.SHIFT_HISTORY, shiftHistory);
                    
                    // Clear current shift
                    showToast(`Shift diakhiri. Selisih: ${formatCurrency(currentShift.difference)}`, 'success');
                    currentShift = null;
                    saveData(STORAGE_KEYS.CURRENT_SHIFT, null);
                    
                    $('#shiftModal').hide();
                    updateShiftStatus();
                });

            } else {
                // Form to start shift
                modalTitle.text('Mulai Shift Baru');
                modalBody.html(`
                    <div class="form-group">
                        <label for="openingBalance">Modal Awal (Uang di Laci)</label>
                        <input type="number" id="openingBalance" class="form-control" placeholder="Masukkan modal awal">
                    </div>
                `);
                modalFooter.html(`
                    <button class="btn btn-secondary close-shift-modal">Batal</button>
                    <button class="btn btn-success" id="startShiftBtn">Mulai Shift</button>
                `);

                $('#startShiftBtn').on('click', function() {
                    const openingBalance = parseFloat($('#openingBalance').val());
                    if (isNaN(openingBalance)) {
                        showToast('Masukkan modal awal.', 'error'); 
                        return;
                    }
                    
                    currentShift = {
                        id: 'SH' + moment().format('YYYYMMDDHHmmss'),
                        cashierId: currentCashier.id,
                        cashierName: currentCashier.name,
                        startTime: new Date(),
                        openingBalance: openingBalance,
                        isActive: true
                    };
                    
                    saveData(STORAGE_KEYS.CURRENT_SHIFT, currentShift);
                    showToast('Shift berhasil dimulai!', 'success');
                    $('#shiftModal').hide();
                    updateShiftStatus();
                });
            }
            $('#shiftModal').css('display', 'flex');
        }

        // --- PRODUCT MANAGEMENT ---
        function loadAdminProducts() {
            const tableBody = $('#adminProductsTable');
            tableBody.empty();
            products.forEach(p => {
                const category = categories.find(c => c.id === p.categoryId);
                tableBody.append(`
                    <tr>
                        <td>${p.barcode}</td>
                        <td>${p.name}</td>
                        <td>${formatCurrency(p.costPrice)}</td>
                        <td>${formatCurrency(p.price)}</td>
                        <td>${p.stock}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-product" data-id="${p.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-product" data-id="${p.id}"><i class="fas fa-trash"></i></button>
                            <button class="btn btn-secondary btn-sm generate-codes" data-id="${p.id}"><i class="fas fa-barcode"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function saveProduct() {
            const productId = $('#productId').val();
            const productData = {
                barcode: $('#productBarcode').val().trim(),
                name: $('#productName').val().trim(),
                categoryId: $('#productCategoryModal').val(),
                costPrice: parseFloat($('#productCostPrice').val()) || 0,
                price: parseFloat($('#productPrice').val()) || 0,
                stock: parseInt($('#productStock').val()) || 0
            };

            if (!productData.name || !productData.barcode || productData.price <= 0) {
                showToast('Nama, barcode, dan harga jual harus diisi.', 'error');
                return;
            }
            if (productData.costPrice > productData.price) {
                showToast('Harga modal tidak boleh lebih besar dari harga jual.', 'warning');
            }

            if (productId) { // Update
                const index = products.findIndex(p => p.id === productId);
                products[index] = { ...products[index], ...productData };
                showToast('Produk berhasil diperbarui.', 'success');
            } else { // Create
                productData.id = 'P' + Date.now();
                products.push(productData);
                showToast('Produk berhasil ditambahkan.', 'success');
            }
            saveData(STORAGE_KEYS.PRODUCTS, products);
            loadAdminProducts();
            loadProducts();
            $('#productModal').hide();
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            $('#productModalTitle').text('Edit Produk');
            $('#productId').val(product.id);
            $('#productBarcode').val(product.barcode);
            $('#productName').val(product.name);
            $('#productCategoryModal').val(product.categoryId);
            $('#productCostPrice').val(product.costPrice);
            $('#productPrice').val(product.price);
            $('#productStock').val(product.stock).prop('disabled', true); // Stock edited via Stock In
            $('#productModal').css('display', 'flex');
        }

        function deleteProduct(id) {
            showConfirmation('Yakin ingin menghapus produk ini? Tindakan ini tidak bisa dibatalkan.', (confirmed) => {
                if(confirmed) {
                    products = products.filter(p => p.id !== id);
                    saveData(STORAGE_KEYS.PRODUCTS, products);
                    loadAdminProducts();
                    loadProducts();
                    showToast('Produk dihapus.', 'success');
                }
            });
        }

        // --- BARCODE & QR CODE GENERATION ---
        function generateCodes(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            $('#codeGeneratorProductName').text(product.name);
            
            // Barcode
            try {
                JsBarcode("#barcode", product.barcode, {
                    format: "CODE128",
                    displayValue: true,
                    fontSize: 18,
                    margin: 10
                });
            } catch (e) {
                $('#barcode').parent().html('<p class="text-danger">Barcode tidak valid.</p>');
            }

            // QR Code
            $('#qrcode').empty();
            new QRCode(document.getElementById("qrcode"), {
                text: product.barcode,
                width: 150,
                height: 150
            });

            $('#codeGeneratorModal').css('display', 'flex');
        }

        // --- STOCK IN MANAGEMENT ---
        function loadAdminStockIn() {
            const tableBody = $('#adminStockInTable');
            tableBody.empty();
            stockInRecords.forEach(rec => {
                tableBody.append(`
                    <tr>
                        <td>${moment(rec.date).format('L')}</td>
                        <td>${rec.ref}</td>
                        <td>${rec.supplier}</td>
                        <td>${rec.items.length}</td>
                        <td>${formatCurrency(rec.totalCost)}</td>
                        <td>
                            <button class="btn btn-info btn-sm view-stock-in" data-id="${rec.id}"><i class="fas fa-eye"></i></button>
                        </td>
                    </tr>
                `);
            });
        }

        function newStockIn() {
            $('#stockInId').val('');
            $('#stockInDate').val(moment().format('YYYY-MM-DD'));
            $('#stockInRef, #stockInSupplier').val('');
            currentStockInItems = [];
            updateStockInTable();
            $('#stockInModal').css('display', 'flex');
        }

        function addProductToStockIn(product) {
            if (!product) { 
                showToast('Produk tidak ditemukan.', 'error'); 
                return; 
            }
            
            if (currentStockInItems.some(item => item.productId === product.id)) {
                showToast('Produk sudah ada di daftar.', 'warning'); 
                return;
            }
            
            currentStockInItems.push({
                productId: product.id,
                name: product.name,
                quantity: 1,
                purchasePrice: product.costPrice, // Default to current cost price
            });
            updateStockInTable();
        }

        function updateStockInTable() {
            const tableBody = $('#stockInItemsTable');
            tableBody.empty();
            let totalCost = 0;
            
            currentStockInItems.forEach((item, index) => {
                const subtotal = item.quantity * item.purchasePrice;
                totalCost += subtotal;
                
                tableBody.append(`
                    <tr>
                        <td>${item.name}</td>
                        <td><input type="number" class="form-control stock-in-qty" data-index="${index}" value="${item.quantity}" min="1"></td>
                        <td><input type="number" class="form-control stock-in-price" data-index="${index}" value="${item.purchasePrice}" min="0"></td>
                        <td>${formatCurrency(subtotal)}</td>
                        <td><button class="btn btn-danger btn-sm remove-stock-in-item" data-index="${index}"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `);
            });
            
            $('#stockInTotalCost').text(formatCurrency(totalCost));
        }

        function saveStockIn() {
            if (currentStockInItems.length === 0) {
                showToast('Tidak ada item untuk disimpan.', 'error'); 
                return;
            }
            
            const record = {
                id: 'SI' + Date.now(),
                date: $('#stockInDate').val(),
                ref: $('#stockInRef').val(),
                supplier: $('#stockInSupplier').val(),
                items: currentStockInItems,
                totalCost: currentStockInItems.reduce((sum, item) => sum + (item.quantity * item.purchasePrice), 0)
            };

            // Update product stock and cost price
            record.items.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if(product) {
                    product.stock += item.quantity;
                    // Optional: update cost price based on new purchase
                    product.costPrice = item.purchasePrice;
                }
            });

            stockInRecords.unshift(record);
            saveData(STORAGE_KEYS.STOCK_IN, stockInRecords);
            saveData(STORAGE_KEYS.PRODUCTS, products);
            
            loadAdminStockIn();
            loadAdminProducts();
            loadProducts();
            
            $('#stockInModal').hide();
            showToast('Stok masuk berhasil dicatat.', 'success');
        }

        // --- CATEGORY MANAGEMENT ---
        function loadAdminCategories() {
            const tableBody = $('#adminCategoriesTable');
            tableBody.empty();
            
            categories.forEach(c => {
                const productCount = products.filter(p => p.categoryId === c.id).length;
                tableBody.append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>${c.description || '-'}</td>
                        <td>${productCount}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-category-btn" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-category-btn" data-id="${c.id}" ${productCount > 0 ? 'disabled' : ''}><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }

        function saveCategory() {
            const name = $('#categoryName').val().trim();
            const description = $('#categoryDescription').val().trim();
            
            if (!name) {
                showToast('Nama kategori harus diisi.', 'error');
                return;
            }
            
            const newCategory = {
                id: 'C' + Date.now(),
                name: name,
                description: description
            };
            
            categories.push(newCategory);
            saveData(STORAGE_KEYS.CATEGORIES, categories);
            
            updateCategoryDropdowns();
            loadAdminCategories();
            $('#categoryModal').hide();
            showToast('Kategori berhasil ditambahkan.', 'success');
        }

        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            $('#editCategoryId').val(category.id);
            $('#editCategoryName').val(category.name);
            $('#editCategoryDescription').val(category.description);
            $('#editCategoryModal').css('display', 'flex');
        }

        function updateCategory() {
            const id = $('#editCategoryId').val();
            const name = $('#editCategoryName').val().trim();
            const description = $('#editCategoryDescription').val().trim();
            
            if (!name) {
                showToast('Nama kategori harus diisi.', 'error');
                return;
            }
            
            const index = categories.findIndex(c => c.id === id);
            if (index !== -1) {
                categories[index] = {
                    ...categories[index],
                    name: name,
                    description: description
                };
                
                saveData(STORAGE_KEYS.CATEGORIES, categories);
                updateCategoryDropdowns();
                loadAdminCategories();
                $('#editCategoryModal').hide();
                showToast('Kategori berhasil diperbarui.', 'success');
            }
        }

        function deleteCategory(id) {
            showConfirmation('Yakin ingin menghapus kategori ini?', (confirmed) => {
                if (confirmed) {
                    categories = categories.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CATEGORIES, categories);
                    updateCategoryDropdowns();
                    loadAdminCategories();
                    showToast('Kategori dihapus.', 'success');
                }
            });
        }

        // --- CUSTOMER MANAGEMENT ---
        function loadAdminCustomers() {
            const tableBody = $('#adminCustomersTable');
            tableBody.empty();
            
            customers.forEach(c => {
                tableBody.append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>${c.phone || '-'}</td>
                        <td>${c.email || '-'}</td>
                        <td>
                            <span class="badge ${c.type === 'member' ? 'badge-primary' : 'badge-secondary'}">
                                ${c.type === 'member' ? 'Member' : 'Biasa'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-info btn-sm edit-customer-btn" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-customer-btn" data-id="${c.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }

       function saveCustomer() {
    const customerData = {
        type: $('#customerTypeModal').val(),
        name: $('#customerNameModal').val().trim(),
        phone: $('#customerPhoneModal').val().trim(),
        email: $('#customerEmailModal').val().trim(),
        address: $('#customerAddressModal').val().trim()
    };
    
    if (!customerData.name) {
        showToast('Nama pelanggan harus diisi.', 'error');
        return;
    }
    
    // Generate ID member
    function generateMemberId() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let result = '';
        for (let i = 0; i < 6; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return 'M' + result;
    }
    
    customerData.id = generateMemberId();
    
    customers.push(customerData);
    saveData(STORAGE_KEYS.CUSTOMERS, customers);
    
    loadAdminCustomers();
    $('#customerModal').hide();
    showToast('Pelanggan berhasil ditambahkan.', 'success');
}

        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            $('#editCustomerId').val(customer.id);
            $('#editCustomerType').val(customer.type);
            $('#editCustomerName').val(customer.name);
            $('#editCustomerPhone').val(customer.phone);
            $('#editCustomerEmail').val(customer.email);
            $('#editCustomerAddress').val(customer.address);
            $('#editCustomerModal').css('display', 'flex');
        }

        function updateCustomer() {
            const id = $('#editCustomerId').val();
            const customerData = {
                type: $('#editCustomerType').val(),
                name: $('#editCustomerName').val().trim(),
                phone: $('#editCustomerPhone').val().trim(),
                email: $('#editCustomerEmail').val().trim(),
                address: $('#editCustomerAddress').val().trim()
            };
            
            if (!customerData.name) {
                showToast('Nama pelanggan harus diisi.', 'error');
                return;
            }
            
            const index = customers.findIndex(c => c.id === id);
            if (index !== -1) {
                customers[index] = {
                    ...customers[index],
                    ...customerData
                };
                
                saveData(STORAGE_KEYS.CUSTOMERS, customers);
                loadAdminCustomers();
                $('#editCustomerModal').hide();
                showToast('Pelanggan berhasil diperbarui.', 'success');
            }
        }

        function deleteCustomer(id) {
            showConfirmation('Yakin ingin menghapus pelanggan ini?', (confirmed) => {
                if (confirmed) {
                    customers = customers.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CUSTOMERS, customers);
                    loadAdminCustomers();
                    showToast('Pelanggan dihapus.', 'success');
                }
            });
        }

        // --- CASHIER MANAGEMENT ---
        function loadAdminCashiers() {
            const tableBody = $('#adminCashiersTable');
            tableBody.empty();
            
            cashiers.forEach(c => {
                tableBody.append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>
                            <span class="badge ${c.status === 'active' ? 'badge-success' : 'badge-danger'}">
                                ${c.status === 'active' ? 'Aktif' : 'Nonaktif'}
                            </span>
                        </td>
                        <td>${c.lastLogin ? moment(c.lastLogin).format('LLL') : '-'}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-cashier-btn" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-cashier-btn" data-id="${c.id}" ${c.id === currentCashier?.id ? 'disabled' : ''}><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }

        function saveCashier() {
            const cashierData = {
                name: $('#cashierModalName').val().trim(),
                pin: $('#cashierModalPin').val(),
                status: $('#cashierModalStatus').val()
            };
            
            if (!cashierData.name || !cashierData.pin || cashierData.pin.length !== 4) {
                showToast('Nama dan PIN (4 digit) harus diisi.', 'error');
                return;
            }
            
            const id = $('#cashierModalId').val();
            if (id) {
                // Update existing cashier
                const index = cashiers.findIndex(c => c.id === id);
                if (index !== -1) {
                    cashiers[index] = {
                        ...cashiers[index],
                        ...cashierData
                    };
                }
            } else {
                // Add new cashier
                cashierData.id = 'K' + (cashiers.length + 1).toString().padStart(3, '0');
                cashierData.lastLogin = null;
                cashiers.push(cashierData);
            }
            
            saveData(STORAGE_KEYS.CASHIERS, cashiers);
            loadAdminCashiers();
            $('#cashierModal').hide();
            showToast('Kasir berhasil disimpan.', 'success');
        }

        function editCashier(id) {
            const cashier = cashiers.find(c => c.id === id);
            if (!cashier) return;
            
            $('#cashierModalId').val(cashier.id);
            $('#cashierModalName').val(cashier.name);
            $('#cashierModalPin').val(cashier.pin);
            $('#cashierModalStatus').val(cashier.status);
            $('#cashierModal .modal-title').text('Edit Kasir');
            $('#cashierModal').css('display', 'flex');
        }

        function deleteCashier(id) {
            showConfirmation('Yakin ingin menghapus kasir ini?', (confirmed) => {
                if (confirmed) {
                    cashiers = cashiers.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CASHIERS, cashiers);
                    loadAdminCashiers();
                    showToast('Kasir dihapus.', 'success');
                }
            });
        }

        // --- TRANSACTION MANAGEMENT ---
        function loadAdminTransactions(startDate, endDate) {
            const tableBody = $('#adminTransactionsTable');
            tableBody.empty();
            
            let filteredTransactions = transactions;
            if (startDate && endDate) {
                filteredTransactions = transactions.filter(t => 
                    moment(t.date).isBetween(startDate, endDate, undefined, '[]')
                );
            }
            
            if (filteredTransactions.length === 0) {
                tableBody.html('<tr><td colspan="6"><div class="empty-state"><p>Tidak ada transaksi</p></div></td></tr>');
            } else {
                filteredTransactions.forEach(t => {
                    tableBody.append(`
                        <tr>
                            <td>${t.id}</td>
                            <td>${moment(t.date).format('L LT')}</td>
                            <td>${t.customer?.name || 'Walk-in'}</td>
                            <td>${formatCurrency(t.total)}</td>
                            <td>${t.cashier.name}</td>
                            <td>
                                <button class="btn btn-info btn-sm view-transaction" data-id="${t.id}"><i class="fas fa-eye"></i></button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        function viewTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            generateReceipt(transaction);
            $('#transactionDetailModal').css('display', 'flex');
        }

        // --- REPORTS ---
        function loadSalesReport(startDate, endDate) {
            let filteredTransactions = transactions;
            if (startDate && endDate) {
                filteredTransactions = transactions.filter(t => 
                    moment(t.date).isBetween(startDate, endDate, undefined, '[]')
                );
            }

            const totalRevenue = filteredTransactions.reduce((sum, t) => sum + t.total, 0);
            const totalProfit = filteredTransactions.reduce((sum, t) => sum + t.profit, 0);
            
            // Find best selling product
            const productSales = {};
            filteredTransactions.forEach(t => {
                t.items.forEach(item => {
                    if (!productSales[item.productId]) {
                        productSales[item.productId] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productSales[item.productId].quantity += item.quantity;
                    productSales[item.productId].revenue += (item.price * item.quantity);
                });
            });
            
            let bestSeller = '-';
            if (Object.keys(productSales).length > 0) {
                const sorted = Object.values(productSales).sort((a, b) => b.quantity - a.quantity);
                bestSeller = `${sorted[0].name} (${sorted[0].quantity} pcs)`;
            }
            
            $('#reportTotalRevenue').text(formatCurrency(totalRevenue));
            $('#reportTotalProfit').text(formatCurrency(totalProfit));
            $('#reportTotalTransactions').text(filteredTransactions.length);
            $('#reportBestSeller').text(bestSeller);

            // Chart
            const salesByDay = {};
            filteredTransactions.forEach(t => {
                const day = moment(t.date).format('YYYY-MM-DD');
                if (!salesByDay[day]) salesByDay[day] = { revenue: 0, profit: 0 };
                salesByDay[day].revenue += t.total;
                salesByDay[day].profit += t.profit;
            });
            
            const labels = Object.keys(salesByDay).sort();
            
            if (salesChart) salesChart.destroy();
            salesChart = new Chart($('#salesChart'), {
                type: 'bar',
                data: {
                    labels: labels.map(l => moment(l).format('D MMM')),
                    datasets: [
                        { 
                            label: 'Pendapatan', 
                            data: labels.map(l => salesByDay[l].revenue), 
                            backgroundColor: 'rgba(67, 97, 238, 0.8)'
                        },
                        { 
                            label: 'Laba', 
                            data: labels.map(l => salesByDay[l].profit), 
                            backgroundColor: 'rgba(139, 92, 246, 0.8)'
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

           function exportReportPDF() {
            const element = document.createElement('div');
            element.style.padding = '20px';
            element.style.fontFamily = "'Poppins', sans-serif";
            
            element.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 5px;">${settings.storeName}</h2>
                <h3 style="text-align: center; margin-top: 0; color: #555;">Laporan Penjualan</h3>
                <p style="text-align: center; margin-bottom: 20px;">${$('#reportDateRange').val() || 'Semua Data'}</p>
                <div style="display: flex; justify-content: space-between; margin: 20px 0; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <p><strong>Total Pendapatan:</strong> ${$('#reportTotalRevenue').text()}</p>
                        <p><strong>Total Laba:</strong> ${$('#reportTotalProfit').text()}</p>
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <p><strong>Total Transaksi:</strong> ${$('#reportTotalTransactions').text()}</p>
                        <p><strong>Produk Terlaris:</strong> ${$('#reportBestSeller').text()}</p>
                    </div>
                </div>
                <div style="height: 300px; margin: 20px 0;">
                    <canvas id="chartForExport" width="600" height="300"></canvas>
                </div>
                <p style="text-align: right; margin-top: 30px; font-size: 0.8em;">Dicetak pada: ${moment().format('LLLL')}</p>
            `;
        
            const opt = {
                margin: 10,
                filename: `Laporan_Penjualan_${moment().format('YYYYMMDD')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    allowTaint: true
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait'
                }
            };
            
            // Clone chart untuk ekspor
            setTimeout(() => {
                const chartCanvas = document.createElement('canvas');
                chartCanvas.width = 600;
                chartCanvas.height = 300;
                const chartCtx = chartCanvas.getContext('2d');
                chartCtx.fillStyle = 'white';
                chartCtx.fillRect(0, 0, chartCanvas.width, chartCanvas.height);
                chartCtx.drawImage($('#salesChart')[0], 0, 0, 600, 300);
                
                const img = new Image();
                img.src = chartCanvas.toDataURL('image/png');
                document.querySelector('#chartForExport').replaceWith(img);
                
                html2pdf().set(opt).from(element).save();
                showToast('Laporan berhasil diekspor ke PDF', 'success');
            }, 500);
        }

        // --- SETTINGS ---
        function saveSettings() {
            const newSettings = {
                storeName: $('#storeNameSetting').val().trim(),
                storeAddress: $('#storeAddressSetting').val().trim(),
                storePhone: $('#storePhoneSetting').val().trim(),
                taxRate: parseInt($('#taxRateSetting').val()) || 0,
                receiptFooter: $('#receiptFooterSetting').val().trim()
            };
            
            if (!newSettings.storeName) {
                showToast('Nama toko harus diisi.', 'error');
                return;
            }
            
            settings = newSettings;
            saveData(STORAGE_KEYS.SETTINGS, settings);
            
            // Update UI
            $('#storeName').text(settings.storeName);
            $('#storeAddress').text(settings.storeAddress);
            
            showToast('Pengaturan berhasil disimpan.', 'success');
        }

        function exportData() {
            const data = {
                products,
                categories,
                customers,
                cashiers,
                transactions,
                settings,
                stockInRecords,
                shiftHistory
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportName = `Backup_Data_${moment().format('YYYYMMDD_HHmmss')}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportName);
            linkElement.click();
            
            showToast('Data berhasil diekspor', 'success');
        }

        function importData() {
            const fileInput = $('#importFile');
            fileInput.trigger('click');
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    showConfirmation('Impor data akan menimpa semua data saat ini. Lanjutkan?', (confirmed) => {
                        if (confirmed) {
                            if (data.products) products = data.products;
                            if (data.categories) categories = data.categories;
                            if (data.customers) customers = data.customers;
                            if (data.cashiers) cashiers = data.cashiers;
                            if (data.transactions) transactions = data.transactions;
                            if (data.settings) settings = data.settings;
                            if (data.stockInRecords) stockInRecords = data.stockInRecords;
                            if (data.shiftHistory) shiftHistory = data.shiftHistory;
                            
                            // Save all data
                            saveData(STORAGE_KEYS.PRODUCTS, products);
                            saveData(STORAGE_KEYS.CATEGORIES, categories);
                            saveData(STORAGE_KEYS.CUSTOMERS, customers);
                            saveData(STORAGE_KEYS.CASHIERS, cashiers);
                            saveData(STORAGE_KEYS.TRANSACTIONS, transactions);
                            saveData(STORAGE_KEYS.SETTINGS, settings);
                            saveData(STORAGE_KEYS.STOCK_IN, stockInRecords);
                            saveData(STORAGE_KEYS.SHIFT_HISTORY, shiftHistory);
                            
                            // Update UI
                            updateAllUI();
                            loadAdminData();
                            
                            showToast('Data berhasil diimpor', 'success');
                        }
                    });
                } catch (error) {
                    showToast('Gagal memproses file. Format tidak valid.', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }

        // --- EVENT HANDLERS ---
            function viewStockIn(id) {
            const record = stockInRecords.find(r => r.id === id);
            if (!record) return;
        
            let itemsHtml = '';
            record.items.forEach(item => {
                itemsHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${formatCurrency(item.purchasePrice)}</td>
                        <td>${formatCurrency(item.quantity * item.purchasePrice)}</td>
                    </tr>
                `;
            });
        
            $('#stockInModalTitle').text('Detail Stok Masuk');
            $('#stockInModalBody').html(`
                <div class="row" style="display:flex; gap: 20px; margin-bottom: 15px;">
                    <div style="flex:1;">
                        <p><strong>Tanggal:</strong> ${moment(record.date).format('LL')}</p>
                    </div>
                    <div style="flex:1;">
                        <p><strong>No. Nota:</strong> ${record.ref}</p>
                    </div>
                    <div style="flex:1;">
                        <p><strong>Pemasok:</strong> ${record.supplier}</p>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Jumlah</th>
                                <th>Harga Beli</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>${itemsHtml}</tbody>
                    </table>
                </div>
                <div class="cart-summary">
                    <div class="summary-row total-row">
                        <span class="summary-label">Total Biaya:</span>
                        <span class="summary-value">${formatCurrency(record.totalCost)}</span>
                    </div>
                </div>
            `);
            $('#stockInModalFooter').html(`
                <button class="btn btn-secondary close-stock-in-modal">Tutup</button>
            `);
            $('#stockInModal').css('display', 'flex');
        }
        $(document).ready(function() {
            initializeDefaultData();
            
             $(document).on('click', '.view-stock-in', function() {
             viewStockIn($(this).data('id'));
            });
            
            // Check for logged in user
            if (!currentCashier) {
                $('#loginModal').css('display', 'flex');
                $('#mainApp').hide();
            } else {
                $('#loginModal').hide();
                $('#mainApp').show();
                $('#loggedInCashier').text(currentCashier.name);
                updateAllUI();
            }

            // --- Login/Logout ---
           $('#loginForm').submit(function(e) {
            e.preventDefault();
            const id = $('#cashierId').val();
            const pin = $('#cashierPin').val();
            
            // Pastikan cashiers sudah terload
            const cashier = cashiers.find(c => c.id === id && c.pin === pin && c.status === 'active');
            
            if (cashier) {
                // Update last login
                cashier.lastLogin = new Date();
                saveData(STORAGE_KEYS.CASHIERS, cashiers);
                
                currentCashier = cashier;
                saveData(STORAGE_KEYS.CURRENT_CASHIER, currentCashier);
                
                $('#loginModal').fadeOut(() => {
                    $('#mainApp').fadeIn();
                    $('#loggedInCashier').text(currentCashier.name);
                    updateAllUI();
                });
                
                showToast(`Selamat datang, ${cashier.name}!`, 'success');
            } else {
                showToast('ID Kasir atau PIN salah.', 'error');
            }
        });
                    
                    showToast(`Selamat datang, ${cashier.name}!`, 'success');
                } else {
                    showToast('ID Kasir atau PIN salah.', 'error');
                }
            });

            $('#logoutBtn').click(function(e) {
                e.preventDefault();
                showConfirmation('Apakah Anda yakin ingin logout?', (confirmed) => {
                    if (confirmed) {
                        currentCashier = null;
                        localStorage.removeItem(STORAGE_KEYS.CURRENT_CASHIER);
                        $('#mainApp').fadeOut(() => $('#loginModal').fadeIn());
                    }
                });
            });

            // --- Main Sales Screen Handlers ---
            $('#productSearch, #productCategory').on('input change', () => 
                loadProducts($('#productSearch').val(), $('#productCategory').val())
            );
            
            $(document).on('click', '.add-to-cart', function() {
                const product = products.find(p => p.id === $(this).data('id'));
                const existingItem = currentCart.items.find(i => i.productId === product.id);
                
                if (existingItem) {
                    if (existingItem.quantity < product.stock) {
                        existingItem.quantity++;
                    } else {
                        showToast('Stok tidak mencukupi.', 'error');
                    }
                } else {
                    currentCart.items.push({ 
                        productId: product.id, 
                        name: product.name, 
                        price: product.price, 
                        costPrice: product.costPrice, 
                        stock: product.stock, 
                        quantity: 1 
                    });
                }
                updateCart();
            });
            
            $(document).on('click', '.remove-from-cart', function() {
                currentCart.items = currentCart.items.filter(i => i.productId !== $(this).data('id'));
                updateCart();
            });
            
            $(document).on('change', '.cart-item-quantity', function() {
                const item = currentCart.items.find(i => i.productId === $(this).data('id'));
                const newQty = parseInt($(this).val());
                
                if (newQty > item.stock) {
                    showToast('Stok tidak mencukupi.', 'error');
                    $(this).val(item.quantity); // revert
                } else {
                    item.quantity = newQty;
                }
                updateCart();
            });

            $('#holdSaleBtn').click(holdSale);
            $(document).on('click', '.resume-sale', function() { 
                resumeSale($(this).data('index')); 
            });
            $(document).on('click', '.delete-held-sale', function() { 
                deleteHeldSale($(this).data('index')); 
            });

            // --- Tab Navigation ---
            $('.tab').click(function() {
                const tab = $(this).data("tab");
                $(this).addClass("active").siblings().removeClass("active");
                $("#"+tab+"Tab").addClass("active").siblings(".tab-content").removeClass("active");
            });
            
            $('.admin-tab').click(function() {
                const tab = $(this).data("tab");
                $(this).addClass("active").siblings().removeClass("active");
                $("#"+tab+"Tab").addClass("active").siblings(".admin-tab-content").removeClass("active");
            });
            
            $('#nextToCustomer').click(() => $('[data-tab="customer"]').click());
            $('#backToCart').click(() => $('[data-tab="cart"]').click());
            
            $('#nextToPayment').click(() => {
                const customerType = $('#customerType').val();
                if (customerType === 'member' && !$('#memberId').val()) {
                    showToast('Harap cari atau masukkan ID member.', 'warning'); 
                    return;
                }
                
                currentCart.customer = { 
                    type: customerType, 
                    name: $('#customerName').val() || 'Walk-in', 
                    phone: $('#customerPhone').val() 
                };
                updateCart();
                $('[data-tab="payment"]').click();
            });
            
            $('#backToCustomer').click(() => $('[data-tab="customer"]').click());
            $('#completePayment').click(completePayment);
            
            // --- Customer Type Toggle ---
            $('#customerType').change(function() {
                const type = $(this).val();
                if (type === 'member') {
                    $('#memberFields').show();
                    $('#customerFields').hide();
                } else {
                    $('#memberFields').hide();
                    $('#customerFields').show();
                }
            }).trigger('change');
            
            // --- FAB & Modals ---
            $('#adminAccess').click(() => $('#adminPasswordModal').css('display', 'flex'));
            
            $('.verify-admin-password').click(function() {
                if ($("#adminPassword").val() === ADMIN_PASSWORD) {
                    $("#adminPasswordModal").hide();
                    $("#adminModal").css("display", "flex");
                    loadAdminData();
                    showToast("Berhasil masuk sebagai admin", "success");
                } else {
                    showToast("Password admin salah", "error");
                }
            });
            
            $('#shiftAccess').click(manageShift);
            $('.modal-close, .close-admin-password-modal, .close-shift-modal').click(function() {
                $(this).closest('.modal').hide();
            });
            
            // Toggle password visibility
            $('#togglePassword').click(function() {
                const passwordField = $('#adminPassword');
                const type = passwordField.attr('type') === 'password' ? 'text' : 'password';
                passwordField.attr('type', type);
                $(this).toggleClass('fa-eye fa-eye-slash');
            });

            // --- Admin Product Handlers ---
            $('#addProduct').click(() => {
                $('#productModalTitle').text('Tambah Produk');
                $('#productModal form')[0]?.reset(); // Reset form if exists
                $('#productId, #productCostPrice, #productPrice, #productStock').val('');
                $('#productStock').prop('disabled', false);
                $('#productModal').css('display', 'flex');
            });
            
            $('#saveProductBtn').click(saveProduct);
            
            $(document).on('click', '.edit-product', function() { 
                editProduct($(this).data('id')); 
            });
            
            $(document).on('click', '.delete-product', function() { 
                deleteProduct($(this).data('id')); 
            });
            
            $(document).on('click', '.generate-codes', function() { 
                generateCodes($(this).data('id')); 
            });
            
            $('.print-codes').click(function() {
                window.print();
            });

            // --- Admin Stock In Handlers ---
            $('#addStockIn').click(newStockIn);
            
            $('#searchStockProductBtn').click(() => {
                const term = $('#stockInProductSearch').val();
                const found = products.find(p => 
                    p.name.toLowerCase().includes(term.toLowerCase()) || 
                    p.barcode === term
                );
                addProductToStockIn(found);
            });
            
            $(document).on('change', '.stock-in-qty, .stock-in-price', function() {
                const index = $(this).data('index');
                currentStockInItems[index].quantity = parseInt($(`.stock-in-qty[data-index=${index}]`).val());
                currentStockInItems[index].purchasePrice = parseFloat($(`.stock-in-price[data-index=${index}]`).val());
                updateStockInTable();
            });
            
            $(document).on('click', '.remove-stock-in-item', function() {
                currentStockInItems.splice($(this).data('index'), 1);
                updateStockInTable();
            });
            
            $('#saveStockInBtn').click(saveStockIn);

            // --- Admin Category Handlers ---
            $('#addCategory').click(() => {
                $('#categoryModal').css('display', 'flex');
            });
            
            $('.save-category').click(saveCategory);
            
            $(document).on('click', '.edit-category-btn', function() {
                editCategory($(this).data('id'));
            });
            
            $(document).on('click', '.delete-category-btn', function() {
                deleteCategory($(this).data('id'));
            });
            
            $('.update-category').click(updateCategory);
            
            $('.close-category-modal, .close-edit-category-modal').click(function() {
                $(this).closest('.modal').hide();
            });

            // --- Admin Customer Handlers ---
            $('#addCustomer').click(() => {
                $('#customerModal').css('display', 'flex');
            });
            
            $('.save-customer').click(saveCustomer);
            
            $(document).on('click', '.edit-customer-btn', function() {
                editCustomer($(this).data('id'));
            });
            
            $(document).on('click', '.delete-customer-btn', function() {
                deleteCustomer($(this).data('id'));
            });
            
            $('.update-customer').click(updateCustomer);
            
            $('.close-customer-modal, .close-edit-customer-modal').click(function() {
                $(this).closest('.modal').hide();
            });

            // --- Admin Cashier Handlers ---
            $('#addCashier').click(() => {
                $('#cashierModalId').val('');
                $('#cashierModal .modal-title').text('Tambah Kasir');
                $('#cashierModal').css('display', 'flex');
            });
            
            $('.save-cashier').click(saveCashier);
            
            $(document).on('click', '.edit-cashier-btn', function() {
                editCashier($(this).data('id'));
            });
            
            $(document).on('click', '.delete-cashier-btn', function() {
                deleteCashier($(this).data('id'));
            });
            
            $('.close-cashier-modal').click(function() {
                $(this).closest('.modal').hide();
            });

            // --- Admin Transaction Handlers ---
            $(document).on('click', '.view-transaction', function() {
                viewTransaction($(this).data('id'));
            });
            
            $('.print-receipt').click(function() {
                window.print();
            });
            
            $('.close-detail-modal').click(function() {
                $('#transactionDetailModal').hide();
            });

            // --- Admin Report Handlers ---
            $('#exportReportPDF').click(exportReportPDF);
            
           $('#exportReportExcel').click(function() {
                    const dateRange = $('#reportDateRange').val();
                    let startDate, endDate;
                    
                    if (dateRange) {
                        const dates = dateRange.split(' - ');
                        startDate = moment(dates[0], 'DD/MM/YYYY').startOf('day');
                        endDate = moment(dates[1], 'DD/MM/YYYY').endOf('day');
                    }
                    
                    const filteredTransactions = transactions.filter(t => {
                        if (!dateRange) return true;
                        return moment(t.date).isBetween(startDate, endDate, undefined, '[]');
                    });
                    
                    if (filteredTransactions.length === 0) {
                        showToast('Tidak ada data transaksi untuk diekspor', 'warning');
                        return;
                    }
                    
                    // Format data untuk Excel
                    const reportData = filteredTransactions.map(t => {
                        const itemsList = t.items.map(i => `${i.name} (${i.quantity}x)`).join(', ');
                        return {
                            'ID Transaksi': t.id,
                            'Tanggal': moment(t.date).format('DD/MM/YYYY HH:mm'),
                            'Pelanggan': t.customer?.name || 'Walk-in',
                            'Item': itemsList,
                            'Subtotal': t.subtotal,
                            'Diskon': t.discount,
                            'Pajak': t.tax,
                            'Total': t.total,
                            'Metode Pembayaran': t.paymentMethod.charAt(0).toUpperCase() + t.paymentMethod.slice(1),
                            'Kasir': t.cashier.name
                        };
                    });
                    
                    try {
                        const worksheet = XLSX.utils.json_to_sheet(reportData);
                        const workbook = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(workbook, worksheet, "Laporan Penjualan");
                        
                        // Auto-size columns
                        const wscols = [
                            {wch: 15}, // ID Transaksi
                            {wch: 20}, // Tanggal
                            {wch: 20}, // Pelanggan
                            {wch: 40}, // Item
                            {wch: 15}, // Subtotal
                            {wch: 15}, // Diskon
                            {wch: 15}, // Pajak
                            {wch: 15}, // Total
                            {wch: 15}, // Metode Pembayaran
                            {wch: 20}  // Kasir
                        ];
                        worksheet['!cols'] = wscols;
                        
                        XLSX.writeFile(workbook, `Laporan_Penjualan_${moment().format('YYYYMMDD')}.xlsx`);
                        showToast("Excel berhasil diekspor", "success");
                    } catch (error) {
                        showToast("Gagal mengekspor ke Excel", "error");
                        console.error("Excel export error:", error);
                    }
                });
                
                const reportData = filteredTransactions.map(t => ({
                    ID: t.id,
                    Tanggal: moment(t.date).format('L LTS'),
                    Pelanggan: t.customer?.name || 'Walk-in',
                    'Total Item': t.items.reduce((sum, item) => sum + item.quantity, 0),
                    Subtotal: t.subtotal,
                    Diskon: t.discount,
                    Pajak: t.tax,
                    Total: t.total,
                    'Metode Pembayaran': t.paymentMethod,
                    Kasir: t.cashier.name
                }));
                
                exportToExcel(reportData, `Laporan_Penjualan_${moment().format('YYYYMMDD')}.xlsx`);
            });
            
            $('#exportReportPrint').click(function() {
                window.print();
            });

            // --- Admin Settings Handlers ---
            $('#saveSettings').click(saveSettings);
            
            $('#exportData').click(exportData);
            
            $('#importData').click(importData);
            
            $('#importFile').change(handleFileImport);

            // --- Date Range Pickers for reports ---
            const datePickerOptions = { 
                opens: 'left', 
                locale: { 
                    format: 'DD/MM/YYYY', 
                    applyLabel: 'Pilih', 
                    cancelLabel: 'Batal',
                    daysOfWeek: ['Mg', 'Sn', 'Sl', 'Rb', 'Km', 'Jm', 'Sb'],
                    monthNames: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'],
                    firstDay: 1
                }
            };
            
            $('#transactionDateRange').daterangepicker(datePickerOptions)
                .on('apply.daterangepicker', (e, picker) => 
                    loadAdminTransactions(picker.startDate, picker.endDate)
                );
            
            $('#reportDateRange').daterangepicker(datePickerOptions)
                .on('apply.daterangepicker', (e, picker) => 
                    loadSalesReport(picker.startDate, picker.endDate)
                );

            // --- Member Search ---
            $('#searchMember').click(function() {
                const memberId = $('#memberId').val();
                const member = customers.find(c => c.id === memberId && c.type === 'member');
                
                if (member) {
                    showToast(`Member ditemukan: ${member.name}`, 'success');
                    $('#customerName').val(member.name);
                    $('#customerPhone').val(member.phone);
                    $('#customerEmail').val(member.email);
                } else {
                    showToast('Member tidak ditemukan', 'error');
                }
            });

            // --- Password Toggle ---
            $('.password-toggle').click(function() {
                const input = $(this).siblings('input');
                const type = input.attr('type') === 'password' ? 'text' : 'password';
                input.attr('type', type);
                $(this).toggleClass('fa-eye fa-eye-slash');
            });

            // --- Close All Modals ---
            $(document).keyup(function(e) {
                if (e.key === "Escape") {
                    $('.modal').hide();
                }
            });
        });
    </script>
</body>
</html>
