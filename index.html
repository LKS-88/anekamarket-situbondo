<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI KASIR CAFE & RESTO</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #28a745;
            --primary-light: #d4edda;
            --secondary: #218838;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --white: #ffffff;
            --shadow-sm: 0 0.15rem 0.35rem rgba(0,0,0,0.1);
            --shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            --rounded-sm: 0.35rem;
            --rounded: 0.75rem;
            --rounded-lg: 1rem;
            --donation: #6f42c1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1.5;
            touch-action: manipulation;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 12px;
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 12px 16px;
            border-radius: var(--rounded);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .header-info {
            text-align: right;
            font-size: 0.9rem;
        }

        .header-info p {
            margin: 2px 0;
        }

        /* Main Content Layout */
        .app-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Panel Styles */
        .panel {
            background: var(--white);
            border-radius: var(--rounded);
            padding: 16px;
            box-shadow: var(--shadow-sm);
        }

        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .menu-card {
            background: var(--white);
            border-radius: var(--rounded-sm);
            padding: 12px;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .menu-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .menu-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .menu-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .menu-image i {
            font-size: 1.5rem;
            color: var(--gray);
        }

        .menu-name {
            font-weight: 500;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .menu-price {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .menu-category {
            font-size: 0.7rem;
            color: var(--gray);
            background-color: var(--light);
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 4px;
        }

        /* Search and Filter */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-container i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-chip {
            padding: 8px 12px;
            background: var(--light);
            border-radius: 20px;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
        }

        .filter-chip.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Order Styles */
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: 500;
        }

        .order-item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .order-item-qty {
            display: flex;
            align-items: center;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: var(--light);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .qty-input {
            width: 40px;
            text-align: center;
            margin: 0 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px;
        }

        .remove-btn {
            color: var(--danger);
            margin-left: 8px;
            cursor: pointer;
        }

        /* Summary Styles */
        .summary-container {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px dashed #ddd;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .total-row {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #ddd;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--rounded-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s;
            width: 100%;
        }

        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning);
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-info {
            background-color: var(--info);
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-donation {
            background-color: var(--donation);
        }

        .btn-donation:hover {
            background-color: #5a32a3;
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 16px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--rounded-lg);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 16px;
        }

        .modal-footer {
            padding: 16px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Login Styles */
        .login-container {
            max-width: 400px;
            margin: 20px auto;
            background: var(--white);
            border-radius: var(--rounded-lg);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .login-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .login-logo {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .login-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 600;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            background-color: var(--dark);
            color: var(--white);
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow);
            z-index: 1100;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: var(--success);
        }

        .toast.error {
            background-color: var(--danger);
        }

        .toast.warning {
            background-color: var(--warning);
            color: #000;
        }

        .toast i {
            margin-right: 8px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 24px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 12px;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background-color: var(--light);
            border-radius: var(--rounded);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: var(--light);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f9f9f9;
        }

        /* Menu Actions */
        .menu-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: none;
            gap: 4px;
        }

        .menu-card:hover .menu-actions {
            display: flex;
        }

        .action-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
            color: white;
        }

        .edit-btn {
            background-color: var(--info);
        }

        .delete-btn {
            background-color: var(--danger);
        }

        /* Note Input */
        .note-input {
            margin-top: 12px;
        }

        .note-input textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            resize: vertical;
            min-height: 60px;
        }

        /* Table Number */
        .table-number {
            margin-bottom: 16px;
        }

        .table-number select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
        }

        /* Order Type */
        .order-type {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .order-type-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            text-align: center;
            cursor: pointer;
            background-color: var(--light);
        }

        .order-type-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Member Search */
        .member-search-container {
            position: relative;
        }

        .member-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--rounded-sm) var(--rounded-sm);
            z-index: 100;
            display: none;
        }

        .member-search-item {
            padding: 8px 12px;
            cursor: pointer;
        }

        .member-search-item:hover {
            background-color: var(--light);
        }

        /* Kitchen Status */
        .kitchen-status {
            margin-top: 16px;
            padding: 12px;
            background-color: var(--light);
            border-radius: var(--rounded-sm);
        }

        .kitchen-status h4 {
            margin-bottom: 8px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-preparing {
            color: var(--danger);
            cursor: pointer;
        }

        .status-ready {
            color: var(--success);
        }

        .status-locked {
            color: var(--gray);
            cursor: default;
        }

        /* Member Badge */
        .member-badge {
            background-color: var(--info);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Donation Badge */
        .donation-badge {
            background-color: var(--donation);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .app-content {
                flex-direction: row;
            }
            
            .menu-panel {
                flex: 2;
            }
            
            .order-panel {
                flex: 1;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mt-3 {
            margin-top: 16px;
        }

        .mb-2 {
            margin-bottom: 8px;
        }

        .mb-3 {
            margin-bottom: 16px;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }

        .gap-2 {
            gap: 8px;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #receiptTemplate, #receiptTemplate * {
                visibility: visible;
            }
            #receiptTemplate {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                padding: 20px;
                margin: 0;
                font-size: 14px;
            }
            
            .no-print {
                display: none !important;
            }
            
            @page {
                size: auto;
                margin: 0;
            }
        }

        /* Footer */
        .app-footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: var(--gray);
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: block;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-utensils"></i>
                </div>
                <h1 class="login-title">APLIKASI KASIR CAFE & RESTO</h1>
                <p>Sistem Kasir Restoran Siap Saji</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn mt-3">
                    <span id="loginBtnText">Login</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main App (Hidden Initially) -->
    <div class="container" id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div>
                <h1 class="app-title" id="storeNameHeader">APLIKASI KASIR CAFE & RESTO</h1>
                <p id="currentDate">Senin, 1 Januari 2023</p>
            </div>
            <div class="header-info">
                <p>Kasir: <span id="loggedInUser">Admin</span></p>
                <p><a href="#" id="logoutBtn" style="color: white;">Logout</a></p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-content">
            <!-- Menu Panel -->
            <section class="panel menu-panel">
                <h2 class="panel-title">
                    <span>Daftar Menu</span>
                    <span id="menuCount">(0 menu)</span>
                </h2>
                
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="menuSearch" class="search-input" placeholder="Cari menu...">
                </div>
                
                <div class="filter-row">
                    <div class="filter-chip active" data-category="all">Semua</div>
                    <!-- Categories will be added here -->
                </div>
                
                <div class="menu-grid" id="menuGrid">
                    <!-- Menu items will be added here -->
                </div>

                <!-- Admin Panel (Visible only for admin) -->
                <div id="adminPanel" class="admin-panel">
                    <h3 class="panel-title">Admin Panel</h3>
                    <button id="addMenuBtn" class="btn btn-sm mb-2">Tambah Menu</button>
                    <button id="manageCategoriesBtn" class="btn btn-sm mb-2">Kelola Kategori</button>
                    <button id="viewReportsBtn" class="btn btn-sm mb-2">Laporan Penjualan</button>
                    <button id="kitchenDisplayBtn" class="btn btn-sm mb-2">Info Pesanan</button>
                    <button id="manageMembersBtn" class="btn btn-sm mb-2">Kelola Member</button>
                    <button id="manageStoreInfoBtn" class="btn btn-sm">Kelola Info Restoran</button>
                </div>
            </section>

            <!-- Order Panel -->
            <section class="panel order-panel">
                <h2 class="panel-title">
                    <span>Pesanan</span>
                    <span id="orderCount">(0 item)</span>
                </h2>
                
                <div class="order-type">
                    <div class="order-type-btn active" data-type="dinein">Makan di Tempat</div>
                    <div class="order-type-btn" data-type="takeaway">Bungkus</div>
                </div>
                
                <div class="table-number" id="tableNumberContainer">
                    <label class="form-label">Nomor Meja</label>
                    <select id="tableNumber">
                        <option value="1">Meja 1</option>
                        <option value="2">Meja 2</option>
                        <option value="3">Meja 3</option>
                        <option value="4">Meja 4</option>
                        <option value="5">Meja 5</option>
                    </select>
                </div>

                <div class="form-group mt-2">
                    <label class="form-label">Member</label>
                    <div class="member-search-container">
                        <select id="customerMember" class="form-control" style="display: none;">
                            <option value="">Bukan Member</option>
                            <!-- Member options will be added here -->
                        </select>
                        <input type="text" id="memberSearchInput" class="form-control" placeholder="Cari member...">
                        <div id="memberSearchResults" class="member-search-results"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Donasi LAZISNU (opsional)</label>
                    <input type="number" id="donationAmount" class="form-control" placeholder="Masukkan jumlah donasi" value="0" min="0">
                </div>
                
                <div id="orderItems">
                    <!-- Order items will be added here -->
                </div>
                
                <div class="note-input">
                    <label class="form-label">Catatan Pesanan (opsional)</label>
                    <textarea id="orderNote" placeholder="Contoh: Pedas, tanpa bawang, dll."></textarea>
                </div>
                
                <div class="summary-container">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="orderSubtotal">Rp 0</span>
                    </div>
                    <div id="donationRow" class="summary-row">
                        <span>Donasi LAZISNU:</span>
                        <span id="orderDonation">Rp 0</span>
                    </div>
                    <div id="discountRow" class="summary-row" style="display: none;">
                        <span>Diskon Member:</span>
                        <span id="orderDiscount">-Rp 0</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <span id="orderTotal">Rp 0</span>
                    </div>
                </div>
                
                <button id="processOrderBtn" class="btn btn-success mt-3">Proses Pesanan</button>
            </section>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>&copy; <span id="currentYear"></span> APLIKASI KASIR CAFE & RESTO - Hak Cipta oleh Lentera Karya Situbondo</p>
        </footer>
    </div>

    <!-- Process Order Modal -->
    <div id="processOrderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Proses Pembayaran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="customer">Pelanggan</div>
                    <div class="tab" data-tab="payment">Pembayaran</div>
                </div>
                
                <div class="tab-content active" id="customerTab">
                    <div class="form-group">
                        <label class="form-label">Nama Pelanggan</label>
                        <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama pelanggan">
                    </div>
                    
                    <div id="orderSummary">
                        <!-- Order summary will be shown here -->
                    </div>
                </div>
                
                <div class="tab-content" id="paymentTab">
                    <div class="summary-container mb-3">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="paymentSubtotal">Rp 0</span>
                        </div>
                        <div id="paymentDonationRow" class="summary-row">
                            <span>Donasi LAZISNU:</span>
                            <span id="paymentDonation">Rp 0</span>
                        </div>
                        <div id="paymentDiscountRow" class="summary-row" style="display: none;">
                            <span>Diskon Member:</span>
                            <span id="paymentDiscount">-Rp 0</span>
                        </div>
                        <div class="summary-row total-row">
                            <span>Total:</span>
                            <span id="paymentTotal">Rp 0</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Metode Pembayaran</label>
                        <select id="paymentMethod" class="form-control">
                            <option value="cash">Tunai</option>
                            <option value="transfer">Transfer Bank</option>
                            <option value="ewallet">E-Wallet</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jumlah Pembayaran</label>
                        <input type="number" id="paymentAmount" class="form-control" placeholder="Masukkan jumlah">
                    </div>
                    
                    <div id="changeContainer" style="display: none;">
                        <div class="summary-row">
                            <span>Kembalian:</span>
                            <span id="paymentChange">Rp 0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="backToOrderBtn" class="btn btn-warning">Kembali</button>
                <button id="prevTabBtn" class="btn btn-info" style="display: none;">Sebelumnya</button>
                <button id="nextTabBtn" class="btn">Lanjut</button>
                <button id="completePaymentBtn" class="btn btn-success" style="display: none;">Selesaikan</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Menu Modal -->
    <div id="menuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Menu Baru</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="menuForm">
                    <input type="hidden" id="menuId">
                    <div class="form-group">
                        <label class="form-label">Nama Menu</label>
                        <input type="text" id="menuName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select id="menuCategory" class="form-control" required>
                            <!-- Categories will be added here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Harga</label>
                        <input type="number" id="menuPrice" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gambar (URL)</label>
                        <input type="text" id="menuImage" class="form-control" placeholder="Masukkan URL gambar">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deskripsi (opsional)</label>
                        <textarea id="menuDescription" class="form-control"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelMenu">Batal</button>
                <button class="btn btn-success" id="saveMenuBtn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Manage Categories Modal -->
    <div id="manageCategoriesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Kategori</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="categoriesList">
                    <!-- Categories will be listed here -->
                </div>
                <div class="form-group mt-3">
                    <input type="text" id="newCategoryName" class="form-control" placeholder="Nama kategori baru">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelManageCategories">Tutup</button>
                <button class="btn btn-success" id="addCategoryBtn">Tambah Kategori</button>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Laporan Penjualan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Periode</label>
                    <select id="reportPeriod" class="form-control">
                        <option value="today">Hari Ini</option>
                        <option value="week">Minggu Ini</option>
                        <option value="month">Bulan Ini</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div id="customDateRange" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Dari Tanggal</label>
                        <input type="date" id="reportStartDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sampai Tanggal</label>
                        <input type="date" id="reportEndDate" class="form-control">
                    </div>
                </div>
                <div id="reportResults" class="mt-3">
                    <!-- Report results will be shown here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelReports">Tutup</button>
                <button class="btn btn-success" id="generateReportBtn">Generate Laporan</button>
                <button class="btn btn-primary" id="printReportBtn" style="display: none;">Cetak Laporan</button>
            </div>
        </div>
    </div>

    <!-- Kitchen Display Modal -->
    <div id="kitchenDisplayModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Info Pesanan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="kitchen-status">
                    <h4>Pesanan Masuk</h4>
                    <div id="kitchenOrders">
                        <!-- Kitchen orders will be shown here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelKitchenDisplay">Tutup</button>
                <button class="btn btn-success" id="refreshKitchenBtn">Refresh</button>
            </div>
        </div>
    </div>

    <!-- Manage Members Modal -->
    <div id="manageMembersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="membersList">
                    <!-- Members will be listed here -->
                </div>
                <div class="member-form">
                    <div class="form-group">
                        <label class="form-label">Nama Member</label>
                        <input type="text" id="memberName" class="form-control" placeholder="Masukkan nama member">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nomor Telepon</label>
                        <input type="text" id="memberPhone" class="form-control" placeholder="Masukkan nomor telepon">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alamat</label>
                        <textarea id="memberAddress" class="form-control" placeholder="Masukkan alamat"></textarea>
                    </div>
                    <div id="memberAdminFields" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Total Transaksi</label>
                            <input type="number" id="memberTransactions" class="form-control" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Belanja</label>
                            <input type="text" id="memberTotalSpent" class="form-control" disabled>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelManageMembers">Tutup</button>
                <button class="btn btn-success" id="saveMemberBtn">Simpan Member</button>
                <button class="btn btn-danger" id="deleteMemberBtn" style="display: none;">Hapus Member</button>
            </div>
        </div>
    </div>

    <!-- Manage Store Info Modal -->
    <div id="manageStoreInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kelola Info Restoran</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="storeInfoForm">
                    <div class="form-group">
                        <label class="form-label">Nama Restoran</label>
                        <input type="text" id="storeName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alamat Restoran</label>
                        <textarea id="storeAddress" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nomor Telepon</label>
                        <input type="text" id="storePhone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jumlah Meja</label>
                        <input type="number" id="tableCount" class="form-control" min="1" value="5" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancelStoreInfo">Batal</button>
                <button class="btn btn-success" id="saveStoreInfoBtn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Receipt Template (Hidden) -->
    <div id="receiptTemplate" style="display: none;">
        <div class="receipt">
            <div class="text-center mb-2">
                <h3 id="receiptStoreName">APLIKASI KASIR CAFE & RESTO</h3>
                <p id="receiptStoreAddress">Jl. Contoh No. 123, Kota</p>
                <p id="receiptStorePhone">Telp: 081234567890</p>
            </div>
            
            <div class="mb-2">
                <p>Tanggal: <span id="receiptDate">01/01/2023 10:00</span></p>
                <p>No. Transaksi: <span id="receiptId">TRX001</span></p>
                <p>Kasir: <span id="receiptCashier">Admin</span></p>
                <p>Pelanggan: <span id="receiptCustomer">Pelanggan Biasa</span></p>
                <p>Tipe: <span id="receiptOrderType">Makan di Tempat</span></p>
                <p id="receiptTableInfo">Meja: <span id="receiptTableNumber">1</span></p>
                <p id="receiptMemberInfo" style="display: none;">Member: <span id="receiptMemberName"></span></p>
                <p id="receiptDonationInfo" style="display: none;">Donasi LAZISNU: <span id="receiptDonationAmount"></span></p>
            </div>
            
            <hr>
            
            <div id="receiptItems">
                <!-- Items will be added here -->
            </div>
            
            <div id="receiptNote" style="margin: 8px 0; font-style: italic; display: none;">
                Catatan: <span id="receiptNoteText"></span>
            </div>
            
            <hr>
            
            <div class="summary-container">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="receiptSubtotal">Rp 0</span>
                </div>
                <div id="receiptDonationRow" class="summary-row" style="display: none;">
                    <span>Donasi LAZISNU:</span>
                    <span id="receiptDonation">Rp 0</span>
                </div>
                <div id="receiptDiscountRow" class="summary-row" style="display: none;">
                    <span>Diskon Member:</span>
                    <span id="receiptDiscount">-Rp 0</span>
                </div>
                <div class="summary-row total-row">
                    <span>TOTAL:</span>
                    <span id="receiptTotal">Rp 0</span>
                </div>
                <div class="summary-row">
                    <span id="receiptPaymentMethod">Tunai:</span>
                    <span id="receiptPaymentAmount">Rp 0</span>
                </div>
                <div class="summary-row">
                    <span>Kembali:</span>
                    <span id="receiptChange">Rp 0</span>
                </div>
            </div>
            
            <div class="text-center mt-3">
                <p>Terima kasih telah berkunjung</p>
                <p class="receipt-footer">&copy; <span id="receiptYear"></span> APLIKASI KASIR CAFE & RESTO - Hak Cipta oleh Lentera Karya Situbondo</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // Set locale to Indonesian
        moment.locale('id');

        // Data storage
        const STORAGE_KEYS = {
            MENUS: 'warungmakan_menus',
            CATEGORIES: 'warungmakan_categories',
            ORDERS: 'warungmakan_orders',
            USER: 'warungmakan_user',
            CURRENT_ORDER: 'warungmakan_current_order',
            SETTINGS: 'warungmakan_settings',
            USERS: 'warungmakan_users',
            MEMBERS: 'warungmakan_members'
        };
        
        // Default admin user (username: admin, password: Admin.123)
        const DEFAULT_ADMIN = {
            id: 'U001',
            username: 'admin',
            password: CryptoJS.SHA256('Admin.123').toString(),
            name: 'Administrator',
            role: 'admin'
        };
        
        // Default cashier user (username: kasir, password: kasir123)
        const DEFAULT_CASHIER = {
            id: 'U002',
            username: 'kasir',
            password: CryptoJS.SHA256('kasir123').toString(),
            name: 'Kasir',
            role: 'cashier'
        };
        
        // Initialize data
        function initializeData() {
            // Check if users exist, if not create default users
            let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS)) || [];
            
            if (!users.find(u => u.username === 'admin')) {
                users.push(DEFAULT_ADMIN);
            }
            
            if (!users.find(u => u.username === 'kasir')) {
                users.push(DEFAULT_CASHIER);
            }
            
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            
            // Initialize members if not exists
            if (!localStorage.getItem(STORAGE_KEYS.MEMBERS)) {
                localStorage.setItem(STORAGE_KEYS.MEMBERS, JSON.stringify([]));
            }
            
            // Initialize other data if not exists
            if (!localStorage.getItem(STORAGE_KEYS.MENUS)) {
                // Sample menu data for warung makan
                const sampleMenus = [
                    {
                        id: 'M001',
                        name: 'Nasi Goreng',
                        category: 'Makanan',
                        price: 15000,
                        image: 'https://via.placeholder.com/150?text=Nasi+Goreng',
                        description: 'Nasi goreng spesial dengan telur dan ayam'
                    },
                    {
                        id: 'M002',
                        name: 'Mie Goreng',
                        category: 'Makanan',
                        price: 12000,
                        image: 'https://via.placeholder.com/150?text=Mie+Goreng',
                        description: 'Mie goreng dengan sayuran dan telur'
                    },
                    {
                        id: 'M003',
                        name: 'Ayam Goreng',
                        category: 'Makanan',
                        price: 18000,
                        image: 'https://via.placeholder.com/150?text=Ayam+Goreng',
                        description: 'Ayam goreng krispi dengan sambal'
                    },
                    {
                        id: 'M004',
                        name: 'Es Teh',
                        category: 'Minuman',
                        price: 5000,
                        image: 'https://via.placeholder.com/150?text=Es+Teh',
                        description: 'Es teh manis segar'
                    },
                    {
                        id: 'M005',
                        name: 'Es Jeruk',
                        category: 'Minuman',
                        price: 7000,
                        image: 'https://via.placeholder.com/150?text=Es+Jeruk',
                        description: 'Es jeruk asli'
                    }
                ];
                
                localStorage.setItem(STORAGE_KEYS.MENUS, JSON.stringify(sampleMenus));
            }
            
            if (!localStorage.getItem(STORAGE_KEYS.CATEGORIES)) {
                // Sample categories for warung makan
                const sampleCategories = [
                    { id: 'C001', name: 'Makanan' },
                    { id: 'C002', name: 'Minuman' },
                    { id: 'C003', name: 'Snack' }
                ];
                
                localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(sampleCategories));
            }
            
            if (!localStorage.getItem(STORAGE_KEYS.ORDERS)) {
                localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify([]));
            }
            
            if (!localStorage.getItem(STORAGE_KEYS.SETTINGS)) {
                localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify({
                    storeName: 'WARUNG MAKAN SEDERHANA',
                    storeAddress: 'Jl. Contoh No. 123, Kota',
                    storePhone: '081234567890',
                    tableCount: 5
                }));
            }
        }
        
        // Load data
        let menus = JSON.parse(localStorage.getItem(STORAGE_KEYS.MENUS)) || [];
        let categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.CATEGORIES)) || [];
        let orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.ORDERS)) || [];
        let settings = JSON.parse(localStorage.getItem(STORAGE_KEYS.SETTINGS)) || {};
        let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS)) || [];
        let members = JSON.parse(localStorage.getItem(STORAGE_KEYS.MEMBERS)) || [];
        let currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.USER)) || null;
        let currentOrder = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_ORDER)) || {
            items: [],
            subtotal: 0,
            total: 0,
            discount: 0,
            donation: 0,
            type: 'dinein',
            tableNumber: '1',
            note: '',
            memberId: null
        };

        // Initialize the app
        $(document).ready(function() {
            // Initialize data
            initializeData();
            
            // Set current year in footer
            $('#currentYear, #receiptYear').text(new Date().getFullYear());
            
            // Check if user is logged in
            if (currentUser) {
                $('#loggedInUser').text(currentUser.name);
                $('#loginModal').hide();
                $('#mainApp').show();
                loadMenus();
                updateOrder();
                loadCategories();
                updateCurrentDate();
                updateStoreInfo();
                updateTableNumbers();
                loadMembersForSelect();
                
                // Show admin panel if user is admin
                if (currentUser.role === 'admin') {
                    $('#adminPanel').show();
                }
            }
            
            // Update date every minute
            setInterval(updateCurrentDate, 60000);
            
            // Login form handler with password hashing
            $('#loginForm').submit(function(e) {
                e.preventDefault();
                const username = $('#username').val().trim();
                const password = $('#password').val().trim();
                
                // Simple validation
                if (!username || !password) {
                    showToast('Username dan password harus diisi', 'error');
                    return;
                }
                
                // Find user
                const user = users.find(u => u.username === username);
                
                if (!user) {
                    showToast('Username tidak ditemukan', 'error');
                    return;
                }
                
                // Verify password (compare hashes)
                const hashedPassword = CryptoJS.SHA256(password).toString();
                
                if (hashedPassword !== user.password) {
                    showToast('Password salah', 'error');
                    return;
                }
                
                // Login successful
                currentUser = user;
                localStorage.setItem(STORAGE_KEYS.USER, JSON.stringify(currentUser));
                $('#loggedInUser').text(currentUser.name);
                $('#loginModal').hide();
                $('#mainApp').fadeIn();
                
                // Show admin panel if user is admin
                if (currentUser.role === 'admin') {
                    $('#adminPanel').show();
                }
                
                // Load data
                loadMenus();
                updateOrder();
                loadCategories();
                updateCurrentDate();
                updateStoreInfo();
                updateTableNumbers();
                loadMembersForSelect();
                
                showToast('Login berhasil', 'success');
            });
            
            // Logout handler
            $('#logoutBtn').click(function(e) {
                e.preventDefault();
                currentUser = null;
                localStorage.removeItem(STORAGE_KEYS.USER);
                $('#mainApp').fadeOut();
                $('#loginModal').fadeIn();
                $('#username').val('');
                $('#password').val('');
                
                showToast('Anda telah logout', 'info');
            });
            
            // Menu search
            $('#menuSearch').on('input', function() {
                loadMenus($(this).val());
            });
            
            // Add menu to order
            $(document).on('click', '.menu-card', function() {
                const menuId = $(this).data('id');
                const menu = menus.find(m => m.id === menuId);
                
                if (!menu) return;
                
                // Check if menu already in order
                const existingItem = currentOrder.items.find(item => item.menu.id === menuId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    currentOrder.items.push({
                        menu: menu,
                        quantity: 1,
                        status: 'pending'
                    });
                }
                
                updateOrder();
                showToast(`${menu.name} ditambahkan ke pesanan`, 'success');
            });
            
            // Edit menu button (admin only)
            $(document).on('click', '.edit-menu', function(e) {
                e.stopPropagation();
                const menuId = $(this).data('id');
                const menu = menus.find(m => m.id === menuId);
                
                if (!menu || currentUser.role !== 'admin') return;
                
                openEditMenuModal(menu);
            });
            
            // Delete menu button (admin only)
            $(document).on('click', '.delete-menu', function(e) {
                e.stopPropagation();
                const menuId = $(this).data('id');
                
                if (currentUser.role !== 'admin') return;
                
                if (confirm('Apakah Anda yakin ingin menghapus menu ini?')) {
                    menus = menus.filter(m => m.id !== menuId);
                    saveMenus();
                    loadMenus();
                    showToast('Menu berhasil dihapus', 'success');
                }
            });
            
            // Remove item from order
            $(document).on('click', '.remove-item', function() {
                const menuId = $(this).data('id');
                const menu = menus.find(m => m.id === menuId);
                
                currentOrder.items = currentOrder.items.filter(item => item.menu.id !== menuId);
                updateOrder();
                
                if (menu) {
                    showToast(`${menu.name} dihapus dari pesanan`, 'info');
                }
            });
            
            // Update item quantity
            $(document).on('change', '.item-qty', function() {
                const menuId = $(this).data('id');
                const quantity = parseInt($(this).val()) || 1;
                
                const item = currentOrder.items.find(item => item.menu.id === menuId);
                if (item) {
                    item.quantity = quantity;
                    updateOrder();
                }
            });
            
            // Order type change
            $(document).on('click', '.order-type-btn', function() {
                $('.order-type-btn').removeClass('active');
                $(this).addClass('active');
                currentOrder.type = $(this).data('type');
                
                // Show/hide table number based on order type
                if (currentOrder.type === 'dinein') {
                    $('#tableNumberContainer').show();
                } else {
                    $('#tableNumberContainer').hide();
                }
                
                updateOrder();
            });
            
            // Table number change
            $('#tableNumber').change(function() {
                currentOrder.tableNumber = $(this).val();
            });
            
            // Donation amount change
            $('#donationAmount').on('input', function() {
                const donation = parseFloat($(this).val()) || 0;
                currentOrder.donation = donation;
                updateOrder();
            });
            
            // Member search functionality
            $('#memberSearchInput').on('input', function() {
                const searchTerm = $(this).val().trim().toLowerCase();
                const $results = $('#memberSearchResults');
                
                if (searchTerm.length === 0) {
                    $results.hide();
                    currentOrder.memberId = null;
                    updateOrder();
                    return;
                }
                
                const filteredMembers = members.filter(member => 
                    member.name.toLowerCase().includes(searchTerm) || 
                    member.id.toLowerCase().includes(searchTerm)
                );
                
                $results.empty();
                
                if (filteredMembers.length > 0) {
                    filteredMembers.forEach(member => {
                        $results.append(`
                            <div class="member-search-item" data-id="${member.id}">
                                ${member.name} (${member.id})
                            </div>
                        `);
                    });
                    $results.show();
                } else {
                    $results.hide();
                }
            });
            
            // Member search item click
            $(document).on('click', '.member-search-item', function() {
                const memberId = $(this).data('id');
                const member = members.find(m => m.id === memberId);
                
                if (member) {
                    $('#memberSearchInput').val(member.name);
                    $('#customerMember').val(memberId);
                    currentOrder.memberId = memberId;
                    updateOrder();
                }
                
                $('#memberSearchResults').hide();
            });
            
            // Clear member search when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.member-search-container').length) {
                    $('#memberSearchResults').hide();
                }
            });
            
            // Order note change
            $('#orderNote').on('input', function() {
                currentOrder.note = $(this).val();
            });
            
            // Process order button
            $('#processOrderBtn').click(function() {
                if (currentOrder.items.length === 0) {
                    showToast('Pesanan kosong', 'warning');
                    return;
                }
                
                // For dine-in, ensure table number is selected
                if (currentOrder.type === 'dinein' && !currentOrder.tableNumber) {
                    showToast('Pilih nomor meja terlebih dahulu', 'warning');
                    return;
                }
                
                $('#processOrderModal').show();
                $('#customerName').val('');
                updateOrderSummary();
                $('#paymentMethod').val('cash');
                $('#paymentAmount').val('');
                $('#paymentChange').text('Rp 0');
                $('#changeContainer').hide();
                $('#nextTabBtn').show();
                $('#prevTabBtn').hide();
                $('#completePaymentBtn').hide();
                $('.tab').removeClass('active');
                $('[data-tab="customer"]').addClass('active');
                $('.tab-content').removeClass('active');
                $('#customerTab').addClass('active');
            });
            
            // Back to order button
            $('#backToOrderBtn').click(function() {
                $('#processOrderModal').hide();
            });
            
            // Previous tab button
            $('#prevTabBtn').click(function() {
                $('.tab').removeClass('active');
                $('[data-tab="customer"]').addClass('active');
                $('.tab-content').removeClass('active');
                $('#customerTab').addClass('active');
                $('#prevTabBtn').hide();
                $('#nextTabBtn').show();
                $('#completePaymentBtn').hide();
            });
            
            // Next tab button
            $('#nextTabBtn').click(function() {
                const customerName = $('#customerName').val().trim();
                
                if (!customerName) {
                    showToast('Nama pelanggan harus diisi', 'warning');
                    return;
                }
                
                currentOrder.customerName = customerName;
                
                // Update payment tab
                updatePaymentTab();
                
                // Switch to payment tab
                $('.tab').removeClass('active');
                $('[data-tab="payment"]').addClass('active');
                $('.tab-content').removeClass('active');
                $('#paymentTab').addClass('active');
                $('#prevTabBtn').show();
                $('#nextTabBtn').hide();
                $('#completePaymentBtn').show();
            });
            
            // Payment amount change
            $('#paymentAmount').on('input', function() {
                const amount = parseFloat($(this).val()) || 0;
                const change = amount - currentOrder.total;
                
                if (change >= 0) {
                    $('#changeContainer').show();
                    $('#paymentChange').text(formatCurrency(change));
                } else {
                    $('#changeContainer').hide();
                }
            });
            
            // Complete payment
            $('#completePaymentBtn').click(function() {
                const paymentAmount = parseFloat($('#paymentAmount').val()) || 0;
                
                if (paymentAmount < currentOrder.total) {
                    showToast('Jumlah pembayaran kurang', 'error');
                    return;
                }
                
                // Create order
                const order = {
                    id: 'ORD' + moment().format('YYYYMMDDHHmmss'),
                    date: new Date(),
                    items: currentOrder.items,
                    customerName: currentOrder.customerName,
                    subtotal: currentOrder.subtotal,
                    discount: currentOrder.discount,
                    donation: currentOrder.donation,
                    total: currentOrder.total,
                    paymentMethod: $('#paymentMethod').val(),
                    paymentAmount: paymentAmount,
                    change: paymentAmount - currentOrder.total,
                    cashier: currentUser,
                    type: currentOrder.type,
                    tableNumber: currentOrder.tableNumber,
                    note: currentOrder.note,
                    memberId: currentOrder.memberId,
                    status: currentOrder.type === 'dinein' ? 'preparing' : 'completed',
                    statusLocked: false
                };
                
                // Add order
                orders.unshift(order);
                saveOrders();
                
                // Update member transaction count if member order
                if (order.memberId) {
                    const member = members.find(m => m.id === order.memberId);
                    if (member) {
                        member.transactions = (member.transactions || 0) + 1;
                        member.totalSpent = (member.totalSpent || 0) + order.total;
                        saveMembers();
                    }
                }
                
                // Generate receipt
                generateReceipt(order);
                
                // Print receipt
                setTimeout(() => {
                    const printWindow = window.open('', '', 'width=600,height=600');
                    printWindow.document.write('<html><head><title>Struk Pembayaran</title>');
                    printWindow.document.write('<style>body { font-family: Arial; font-size: 14px; } .text-center { text-align: center; } .summary-row { display: flex; justify-content: space-between; } hr { border-top: 1px dashed #000; }</style>');
                    printWindow.document.write('</head><body>');
                    printWindow.document.write($('#receiptTemplate').html());
                    printWindow.document.write('</body></html>');
                    printWindow.document.close();
                    printWindow.focus();
                    setTimeout(() => {
                        printWindow.print();
                        printWindow.close();
                    }, 500);
                }, 500);
                
                // Reset order
                resetOrder();
                
                // Close modal
                $('#processOrderModal').hide();
                
                showToast('Pesanan berhasil diproses', 'success');
            });
            
            // Category filter
            $(document).on('click', '.filter-chip', function() {
                $('.filter-chip').removeClass('active');
                $(this).addClass('active');
                loadMenus($('#menuSearch').val(), $(this).data('category'));
            });
            
            // Admin panel buttons (only for admin)
            $('#addMenuBtn').click(function() {
                if (currentUser.role === 'admin') {
                    $('#menuModal .modal-title').text('Tambah Menu Baru');
                    $('#menuForm')[0].reset();
                    $('#menuId').val('');
                    loadCategoriesForSelect();
                    $('#menuModal').show();
                }
            });
            
            $('#manageCategoriesBtn').click(function() {
                if (currentUser.role === 'admin') {
                    $('#manageCategoriesModal').show();
                    loadCategoriesForManagement();
                }
            });
            
            $('#viewReportsBtn').click(function() {
                if (currentUser.role === 'admin') {
                    $('#reportsModal').show();
                    $('#reportPeriod').val('today');
                    $('#customDateRange').hide();
                }
            });
            
            $('#kitchenDisplayBtn').click(function() {
                $('#kitchenDisplayModal').show();
                loadKitchenOrders();
            });
            
            $('#manageMembersBtn').click(function() {
                $('#manageMembersModal').show();
                loadMembersForManagement();
                if (currentUser.role === 'admin') {
                    $('#memberAdminFields').show();
                } else {
                    $('#memberAdminFields').hide();
                }
                $('#memberForm')[0]?.reset();
                $('#saveMemberBtn').text('Tambah Member');
                $('#deleteMemberBtn').hide();
            });
            
            $('#manageStoreInfoBtn').click(function() {
                if (currentUser.role === 'admin') {
                    $('#manageStoreInfoModal').show();
                    loadStoreInfo();
                }
            });
            
            // Save menu
            $('#saveMenuBtn').click(function() {
                const id = $('#menuId').val();
                const name = $('#menuName').val().trim();
                const category = $('#menuCategory').val();
                const price = parseFloat($('#menuPrice').val()) || 0;
                const image = $('#menuImage').val().trim();
                const description = $('#menuDescription').val().trim();
                
                if (!name || !category || price <= 0) {
                    showToast('Nama, kategori, dan harga harus diisi dengan benar', 'error');
                    return;
                }
                
                if (id) {
                    // Update existing menu
                    const menuIndex = menus.findIndex(m => m.id === id);
                    if (menuIndex !== -1) {
                        menus[menuIndex] = {
                            ...menus[menuIndex],
                            name: name,
                            category: category,
                            price: price,
                            image: image || null,
                            description: description || null
                        };
                    }
                } else {
                    // Create new menu
                    const newMenu = {
                        id: 'M' + moment().format('YYYYMMDDHHmmss'),
                        name: name,
                        category: category,
                        price: price,
                        image: image || null,
                        description: description || null
                    };
                    
                    menus.unshift(newMenu);
                }
                
                saveMenus();
                loadMenus();
                
                $('#menuModal').hide();
                $('#menuForm')[0].reset();
                
                showToast('Menu berhasil disimpan', 'success');
            });
            
            // Cancel menu modal
            $('#cancelMenu').click(function() {
                $('#menuModal').hide();
            });
            
            // Add category
            $('#addCategoryBtn').click(function() {
                const name = $('#newCategoryName').val().trim();
                
                if (!name) {
                    showToast('Nama kategori harus diisi', 'error');
                    return;
                }
                
                // Check if category already exists
                if (categories.find(c => c.name.toLowerCase() === name.toLowerCase())) {
                    showToast('Kategori sudah ada', 'error');
                    return;
                }
                
                // Add new category
                const newCategory = {
                    id: 'C' + moment().format('YYYYMMDDHHmmss'),
                    name: name
                };
                
                categories.unshift(newCategory);
                saveCategories();
                loadCategories();
                loadCategoriesForSelect();
                loadCategoriesForManagement();
                
                $('#newCategoryName').val('');
                
                showToast('Kategori berhasil ditambahkan', 'success');
            });
            
            // Remove category
            $(document).on('click', '.remove-category', function() {
                const categoryId = $(this).data('id');
                
                // Check if category is used by menus
                const menusInCategory = menus.filter(m => m.category === categories.find(c => c.id === categoryId).name);
                
                if (menusInCategory.length > 0) {
                    showToast('Tidak bisa menghapus kategori yang sudah digunakan oleh menu', 'error');
                    return;
                }
                
                // Remove category
                categories = categories.filter(c => c.id !== categoryId);
                saveCategories();
                loadCategories();
                loadCategoriesForSelect();
                loadCategoriesForManagement();
                
                showToast('Kategori berhasil dihapus', 'success');
            });
            
            // Save member
            $('#saveMemberBtn').click(function() {
                const name = $('#memberName').val().trim();
                const phone = $('#memberPhone').val().trim();
                const address = $('#memberAddress').val().trim();
                
                if (!name || !phone) {
                    showToast('Nama dan nomor telepon harus diisi', 'error');
                    return;
                }
                
                // Generate member ID (6 characters: 3 letters + 3 numbers)
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const numbers = '0123456789';
                let id = '';
                
                for (let i = 0; i < 3; i++) {
                    id += letters.charAt(Math.floor(Math.random() * letters.length));
                }
                
                for (let i = 0; i < 3; i++) {
                    id += numbers.charAt(Math.floor(Math.random() * numbers.length));
                }
                
                // Create new member
                const newMember = {
                    id: id,
                    name: name,
                    phone: phone,
                    address: address,
                    joinDate: new Date(),
                    transactions: 0,
                    totalSpent: 0
                };
                
                members.unshift(newMember);
                saveMembers();
                loadMembersForSelect();
                loadMembersForManagement();
                
                $('#manageMembersModal').hide();
                $('#memberForm')[0].reset();
                
                showToast('Member berhasil ditambahkan', 'success');
            });
            
            // Edit member
            $(document).on('click', '.edit-member', function() {
                const memberId = $(this).data('id');
                const member = members.find(m => m.id === memberId);
                
                if (!member) return;
                
                $('#memberName').val(member.name);
                $('#memberPhone').val(member.phone);
                $('#memberAddress').val(member.address || '');
                $('#memberTransactions').val(member.transactions || 0);
                $('#memberTotalSpent').val(formatCurrency(member.totalSpent || 0));
                
                $('#saveMemberBtn').text('Simpan Perubahan');
                $('#deleteMemberBtn').show().data('id', memberId);
                $('#manageMembersModal').show();
            });
            
            // Delete member
            $('#deleteMemberBtn').click(function() {
                const memberId = $(this).data('id');
                
                if (currentUser.role !== 'admin') {
                    showToast('Hanya admin yang dapat menghapus member', 'error');
                    return;
                }
                
                if (confirm('Apakah Anda yakin ingin menghapus member ini?')) {
                    members = members.filter(m => m.id !== memberId);
                    saveMembers();
                    loadMembersForSelect();
                    loadMembersForManagement();
                    
                    $('#manageMembersModal').hide();
                    $('#memberForm')[0].reset();
                    
                    showToast('Member berhasil dihapus', 'success');
                }
            });
            
            // Generate report
            $('#generateReportBtn').click(function() {
                const period = $('#reportPeriod').val();
                let startDate, endDate;
                
                // Set date range based on period
                if (period === 'today') {
                    startDate = moment().startOf('day');
                    endDate = moment().endOf('day');
                } else if (period === 'week') {
                    startDate = moment().startOf('week');
                    endDate = moment().endOf('week');
                } else if (period === 'month') {
                    startDate = moment().startOf('month');
                    endDate = moment().endOf('month');
                } else if (period === 'custom') {
                    startDate = moment($('#reportStartDate').val());
                    endDate = moment($('#reportEndDate').val());
                    
                    if (!startDate.isValid() || !endDate.isValid()) {
                        showToast('Tanggal tidak valid', 'error');
                        return;
                    }
                    
                    // Ensure end date is after start date
                    if (endDate.isBefore(startDate)) {
                        showToast('Tanggal akhir harus setelah tanggal awal', 'error');
                        return;
                    }
                }
                
                // Filter orders by date range
                const filteredOrders = orders.filter(o => {
                    const orderDate = moment(o.date);
                    return orderDate.isBetween(startDate, endDate, null, '[]');
                });
                
                // Calculate report data
                const totalOrders = filteredOrders.length;
                const totalRevenue = filteredOrders.reduce((sum, o) => sum + o.total, 0);
                const totalItemsSold = filteredOrders.reduce((sum, o) => {
                    return sum + o.items.reduce((itemSum, item) => itemSum + item.quantity, 0);
                }, 0);
                const totalDiscount = filteredOrders.reduce((sum, o) => sum + (o.discount || 0), 0);
                const totalDonation = filteredOrders.reduce((sum, o) => sum + (o.donation || 0), 0);
                
                // Group by order type
                const orderTypes = {};
                filteredOrders.forEach(o => {
                    const type = o.type;
                    if (!orderTypes[type]) {
                        orderTypes[type] = {
                            count: 0,
                            total: 0
                        };
                    }
                    orderTypes[type].count++;
                    orderTypes[type].total += o.total;
                });
                
                // Group by menu
                const menuSales = {};
                filteredOrders.forEach(o => {
                    o.items.forEach(item => {
                        const menuId = item.menu.id;
                        if (!menuSales[menuId]) {
                            menuSales[menuId] = {
                                name: item.menu.name,
                                quantity: 0,
                                total: 0
                            };
                        }
                        menuSales[menuId].quantity += item.quantity;
                        menuSales[menuId].total += item.quantity * item.menu.price;
                    });
                });
                
                // Convert to array and sort by total sales
                const topMenus = Object.values(menuSales)
                    .sort((a, b) => b.total - a.total)
                    .slice(0, 5);
                
                // Group by member
                const memberOrders = {};
                filteredOrders.forEach(o => {
                    if (o.memberId) {
                        if (!memberOrders[o.memberId]) {
                            const member = members.find(m => m.id === o.memberId);
                            memberOrders[o.memberId] = {
                                name: member?.name || 'Unknown',
                                count: 0,
                                total: 0
                            };
                        }
                        memberOrders[o.memberId].count++;
                        memberOrders[o.memberId].total += o.total;
                    }
                });
                
                // Convert to array and sort by total spent
                const topMembers = Object.values(memberOrders)
                    .sort((a, b) => b.total - a.total)
                    .slice(0, 5);
                
                // Create report HTML
                const reportHTML = `
                    <div class="panel">
                        <h4>Ringkasan Laporan</h4>
                        <div class="summary-row">
                            <span>Periode:</span>
                            <span>${startDate.format('DD/MM/YYYY')} - ${endDate.format('DD/MM/YYYY')}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Pesanan:</span>
                            <span>${totalOrders}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Pendapatan:</span>
                            <span>${formatCurrency(totalRevenue)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Diskon:</span>
                            <span>${formatCurrency(totalDiscount)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Donasi:</span>
                            <span>${formatCurrency(totalDonation)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Item Terjual:</span>
                            <span>${totalItemsSold}</span>
                        </div>
                    </div>
                    
                    ${Object.keys(orderTypes).length > 0 ? `
                    <div class="panel mt-3">
                        <h4>Tipe Pesanan</h4>
                        ${Object.entries(orderTypes).map(([type, data]) => `
                            <div class="summary-row">
                                <span>${type === 'dinein' ? 'Makan di Tempat' : 'Bungkus'}:</span>
                                <span>${data.count} pesanan (${formatCurrency(data.total)})</span>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    ${topMenus.length > 0 ? `
                    <div class="panel mt-3">
                        <h4>Menu Terlaris</h4>
                        ${topMenus.map(menu => `
                            <div class="summary-row">
                                <span>${menu.name}:</span>
                                <span>${menu.quantity} terjual (${formatCurrency(menu.total)})</span>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    ${topMembers.length > 0 ? `
                    <div class="panel mt-3">
                        <h4>Member Teraktif</h4>
                        ${topMembers.map(member => `
                            <div class="summary-row">
                                <span>${member.name}:</span>
                                <span>${member.count} pesanan (${formatCurrency(member.total)})</span>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    ${filteredOrders.length > 0 ? `
                    <div class="panel mt-3">
                        <h4>Detail Pesanan</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>No. Pesanan</th>
                                    <th>Tanggal</th>
                                    <th>Total</th>
                                    <th>Tipe</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredOrders.map(o => `
                                    <tr>
                                        <td>${o.id}</td>
                                        <td>${moment(o.date).format('DD/MM/YY HH:mm')}</td>
                                        <td>${formatCurrency(o.total)}</td>
                                        <td>${o.type === 'dinein' ? 'Makan di Tempat' : 'Bungkus'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ` : ''}
                `;
                
                // Display report
                $('#reportResults').html(reportHTML);
                $('#printReportBtn').show();
            });
            
            // Print report
            $('#printReportBtn').click(function() {
                const printWindow = window.open('', '', 'width=800,height=600');
                printWindow.document.write('<html><head><title>Laporan Penjualan</title>');
                printWindow.document.write('<style>body { font-family: Arial; font-size: 14px; } .panel { margin-bottom: 20px; } .summary-row { display: flex; justify-content: space-between; margin-bottom: 5px; } h3, h4 { margin-bottom: 10px; } table { width: 100%; border-collapse: collapse; margin-bottom: 15px; } th, td { border: 1px solid #ddd; padding: 8px; text-align: left; } th { background-color: #f2f2f2; }</style>');
                printWindow.document.write('</head><body>');
                printWindow.document.write($('#reportResults').html());
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.focus();
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 500);
            });
            
            // Load kitchen orders
            function loadKitchenOrders() {
                const kitchenOrders = orders.filter(o => o.type === 'dinein' && o.status !== 'completed');
                
                $('#kitchenOrders').empty();
                
                if (kitchenOrders.length === 0) {
                    $('#kitchenOrders').html(`
                        <div class="empty-state">
                            <i class="fas fa-check-circle"></i>
                            <p>Tidak ada pesanan</p>
                        </div>
                    `);
                } else {
                    kitchenOrders.forEach(order => {
                        const statusClass = order.status === 'ready' ? 
                            (order.statusLocked ? 'status-locked' : 'status-ready') : 
                            'status-preparing';
                            
                        $('#kitchenOrders').append(`
                            <div class="status-item ${statusClass}" data-id="${order.id}">
                                <div>
                                    <strong>${order.id}</strong>
                                    <div>Meja ${order.tableNumber}</div>
                                    <div class="order-items-summary">
                                        ${order.items.slice(0, 2).map(item => `${item.menu.name} (${item.quantity}x)`).join(', ')}
                                        ${order.items.length > 2 ? ` + ${order.items.length - 2} item lainnya` : ''}
                                    </div>
                                </div>
                                <div>
                                    ${order.status === 'ready' ? 'Siap' : 'Sedang diproses'}
                                </div>
                            </div>
                        `);
                    });
                }
            }
            
            // Change kitchen order status
            $(document).on('click', '.status-item.status-preparing, .status-item.status-ready', function() {
                if (currentUser.role !== 'admin' && currentUser.role !== 'cashier') return;
                
                const orderId = $(this).data('id');
                const order = orders.find(o => o.id === orderId);
                
                if (!order || order.statusLocked) return;
                
                // Toggle status between preparing and ready
                order.status = order.status === 'preparing' ? 'ready' : 'preparing';
                
                // Lock the status if changed to ready
                if (order.status === 'ready') {
                    order.statusLocked = true;
                }
                
                saveOrders();
                loadKitchenOrders();
                
                showToast(`Status pesanan ${orderId} diperbarui`, 'success');
            });
            
            // Refresh kitchen display
            $('#refreshKitchenBtn').click(function() {
                loadKitchenOrders();
                showToast('Info pesanan diperbarui', 'success');
            });
            
            // Load store info
            function loadStoreInfo() {
                $('#storeName').val(settings.storeName);
                $('#storeAddress').val(settings.storeAddress);
                $('#storePhone').val(settings.storePhone);
                $('#tableCount').val(settings.tableCount || 5);
            }
            
            // Save store info
            $('#saveStoreInfoBtn').click(function() {
                const storeName = $('#storeName').val().trim();
                const storeAddress = $('#storeAddress').val().trim();
                const storePhone = $('#storePhone').val().trim();
                const tableCount = parseInt($('#tableCount').val()) || 5;
                
                if (!storeName || !storeAddress || !storePhone) {
                    showToast('Nama restoran, alamat, dan nomor telepon harus diisi', 'error');
                    return;
                }
                
                // Update settings
                settings.storeName = storeName;
                settings.storeAddress = storeAddress;
                settings.storePhone = storePhone;
                settings.tableCount = tableCount;
                
                saveSettings();
                updateStoreInfo();
                updateTableNumbers();
                
                $('#manageStoreInfoModal').hide();
                
                showToast('Info restoran berhasil diperbarui', 'success');
            });
            
            // Cancel buttons
            $('#cancelManageCategories').click(function() {
                $('#manageCategoriesModal').hide();
            });
            
            $('#cancelReports').click(function() {
                $('#reportsModal').hide();
            });
            
            $('#cancelKitchenDisplay').click(function() {
                $('#kitchenDisplayModal').hide();
            });
            
            $('#cancelManageMembers').click(function() {
                $('#manageMembersModal').hide();
            });
            
            $('#cancelStoreInfo').click(function() {
                $('#manageStoreInfoModal').hide();
            });
            
            // Report period change
            $('#reportPeriod').change(function() {
                if ($(this).val() === 'custom') {
                    $('#customDateRange').show();
                } else {
                    $('#customDateRange').hide();
                }
            });
        });
        
        // Open edit menu modal
        function openEditMenuModal(menu) {
            $('#menuModal .modal-title').text('Edit Menu');
            $('#menuId').val(menu.id);
            $('#menuName').val(menu.name);
            $('#menuPrice').val(menu.price);
            $('#menuImage').val(menu.image || '');
            $('#menuDescription').val(menu.description || '');
            loadCategoriesForSelect();
            $('#menuCategory').val(menu.category);
            $('#menuModal').show();
        }
        
        // Load menus
        function loadMenus(searchTerm = '', category = 'all') {
            let filteredMenus = [...menus];
            
            // Apply search filter
            if (searchTerm) {
                filteredMenus = filteredMenus.filter(m => 
                    m.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            // Apply category filter
            if (category !== 'all') {
                filteredMenus = filteredMenus.filter(m => m.category === category);
            }
            
            // Update menu count
            $('#menuCount').text(`(${filteredMenus.length} menu)`);
            
            // Display menus
            $('#menuGrid').empty();
            
            if (filteredMenus.length === 0) {
                $('#menuGrid').html(`
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <p>Tidak ada menu ditemukan</p>
                    </div>
                `);
            } else {
                filteredMenus.forEach(menu => {
                    $('#menuGrid').append(`
                        <div class="menu-card" data-id="${menu.id}">
                            ${currentUser.role === 'admin' ? `
                            <div class="menu-actions">
                                <div class="action-btn edit-btn edit-menu" data-id="${menu.id}">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="action-btn delete-btn delete-menu" data-id="${menu.id}">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                            ` : ''}
                            <div class="menu-image">
                                ${menu.image ? `<img src="${menu.image}" alt="${menu.name}">` : `<i class="fas fa-utensils"></i>`}
                            </div>
                            <div class="menu-name">${menu.name}</div>
                            <div class="menu-price">${formatCurrency(menu.price)}</div>
                            <div class="menu-category">${menu.category}</div>
                        </div>
                    `);
                });
            }
        }
        
        // Load categories
        function loadCategories() {
            // Add category filters
            const $filterRow = $('.filter-row');
            $filterRow.empty();
            
            $filterRow.append(`
                <div class="filter-chip active" data-category="all">Semua</div>
            `);
            
            categories.forEach(category => {
                $filterRow.append(`
                    <div class="filter-chip" data-category="${category.name}">${category.name}</div>
                `);
            });
        }
        
        // Load categories for select input
        function loadCategoriesForSelect() {
            const $select = $('#menuCategory');
            $select.empty();
            
            if (categories.length === 0) {
                $select.append('<option value="" disabled selected>Tidak ada kategori</option>');
            } else {
                categories.forEach(category => {
                    $select.append(`<option value="${category.name}">${category.name}</option>`);
                });
            }
        }
        
        // Load categories for management
        function loadCategoriesForManagement() {
            const $categoriesList = $('#categoriesList');
            $categoriesList.empty();
            
            if (categories.length === 0) {
                $categoriesList.html(`
                    <div class="empty-state">
                        <i class="fas fa-tags"></i>
                        <p>Tidak ada kategori</p>
                    </div>
                `);
            } else {
                categories.forEach(category => {
                    // Count menus in this category
                    const menuCount = menus.filter(m => m.category === category.name).length;
                    
                    $categoriesList.append(`
                        <div class="order-item">
                            <div class="order-item-info">
                                <div class="order-item-name">${category.name}</div>
                                <div class="order-item-price">${menuCount} menu</div>
                            </div>
                            <div class="order-item-qty">
                                <i class="fas fa-trash remove-item remove-category" data-id="${category.id}"></i>
                            </div>
                        </div>
                    `);
                });
            }
        }
        
        // Load members for select input
        function loadMembersForSelect() {
            const $select = $('#customerMember');
            $select.empty();
            
            $select.append('<option value="">Bukan Member</option>');
            
            if (members.length > 0) {
                members.forEach(member => {
                    $select.append(`<option value="${member.id}">${member.name}</option>`);
                });
            }
        }
        
        // Load members for management
        function loadMembersForManagement() {
            const $membersList = $('#membersList');
            $membersList.empty();
            
            if (members.length === 0) {
                $membersList.html(`
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>Tidak ada member</p>
                    </div>
                `);
            } else {
                members.forEach(member => {
                    $membersList.append(`
                        <div class="order-item">
                            <div class="order-item-info">
                                <div class="order-item-name">${member.name}</div>
                                <div class="order-item-price">
                                    ${member.phone}
                                    <span class="member-badge">${member.id}</span>
                                    <span class="member-badge">${member.transactions || 0} transaksi</span>
                                </div>
                            </div>
                            <div class="order-item-qty">
                                <i class="fas fa-edit edit-member" data-id="${member.id}"></i>
                            </div>
                        </div>
                    `);
                });
            }
        }
        
        // Update order
        function updateOrder() {
            // Calculate subtotal
            currentOrder.subtotal = currentOrder.items.reduce((total, item) => {
                return total + (item.menu.price * item.quantity);
            }, 0);
            
            // Get donation amount
            currentOrder.donation = parseFloat($('#donationAmount').val()) || 0;
            
            // Calculate discount (2% if member and more than 5 items)
            currentOrder.discount = 0;
            if (currentOrder.memberId && currentOrder.items.length > 5) {
                currentOrder.discount = currentOrder.subtotal * 0.02;
            }
            
            // Calculate total
            currentOrder.total = currentOrder.subtotal - currentOrder.discount + currentOrder.donation;
            
            // Save order
            localStorage.setItem(STORAGE_KEYS.CURRENT_ORDER, JSON.stringify(currentOrder));
            
            // Update order UI
            $('#orderItems').empty();
            $('#orderCount').text(`(${currentOrder.items.length} item)`);
            
            // Show donation row
            $('#donationRow').show();
            $('#orderDonation').text(formatCurrency(currentOrder.donation));
            
            // Show/hide discount row
            if (currentOrder.discount > 0) {
                $('#discountRow').show();
                $('#orderDiscount').text(`-${formatCurrency(currentOrder.discount)}`);
            } else {
                $('#discountRow').hide();
            }
            
            if (currentOrder.items.length === 0) {
                $('#orderItems').html(`
                    <div class="empty-state">
                        <i class="fas fa-shopping-basket"></i>
                        <p>Pesanan kosong</p>
                    </div>
                `);
            } else {
                currentOrder.items.forEach(item => {
                    const itemTotal = item.menu.price * item.quantity;
                    
                    $('#orderItems').append(`
                        <div class="order-item">
                            <div class="order-item-info">
                                <div class="order-item-name">${item.menu.name}</div>
                                <div class="order-item-price">${formatCurrency(item.menu.price)} x ${item.quantity}</div>
                            </div>
                            <div class="order-item-qty">
                                <input type="number" value="${item.quantity}" min="1" 
                                    class="item-qty" data-id="${item.menu.id}">
                                <i class="fas fa-trash remove-item" data-id="${item.menu.id}"></i>
                            </div>
                        </div>
                    `);
                });
            }
            
            // Update summary
            $('#orderSubtotal').text(formatCurrency(currentOrder.subtotal));
            $('#orderTotal').text(formatCurrency(currentOrder.total));
        }
        
        // Update order summary in modal
        function updateOrderSummary() {
            let summaryHTML = '';
            
            currentOrder.items.forEach(item => {
                const itemTotal = item.menu.price * item.quantity;
                
                summaryHTML += `
                    <div class="summary-row">
                        <span>${item.menu.name} (${item.quantity}x)</span>
                        <span>${formatCurrency(itemTotal)}</span>
                    </div>
                `;
            });
            
            summaryHTML += `
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>${formatCurrency(currentOrder.subtotal)}</span>
                </div>
            `;
            
            if (currentOrder.donation > 0) {
                summaryHTML += `
                    <div class="summary-row">
                        <span>Donasi LAZISNU:</span>
                        <span>${formatCurrency(currentOrder.donation)}</span>
                    </div>
                `;
            }
            
            if (currentOrder.discount > 0) {
                summaryHTML += `
                    <div class="summary-row">
                        <span>Diskon Member:</span>
                        <span>-${formatCurrency(currentOrder.discount)}</span>
                    </div>
                `;
            }
            
            summaryHTML += `
                <div class="summary-row total-row">
                    <span>Total:</span>
                    <span>${formatCurrency(currentOrder.total)}</span>
                </div>
            `;
            
            $('#orderSummary').html(summaryHTML);
        }
        
        // Update payment tab
        function updatePaymentTab() {
            $('#paymentSubtotal').text(formatCurrency(currentOrder.subtotal));
            
            if (currentOrder.donation > 0) {
                $('#paymentDonationRow').show();
                $('#paymentDonation').text(formatCurrency(currentOrder.donation));
            } else {
                $('#paymentDonationRow').hide();
            }
            
            if (currentOrder.discount > 0) {
                $('#paymentDiscountRow').show();
                $('#paymentDiscount').text(`-${formatCurrency(currentOrder.discount)}`);
            } else {
                $('#paymentDiscountRow').hide();
            }
            
            $('#paymentTotal').text(formatCurrency(currentOrder.total));
            $('#paymentAmount').val('');
            $('#paymentChange').text('Rp 0');
            $('#changeContainer').hide();
        }
        
        // Generate receipt
        function generateReceipt(order) {
            const receiptDate = moment(order.date).format('DD/MM/YYYY HH:mm');
            const paymentMethod = 
                order.paymentMethod === 'cash' ? 'Tunai' :
                order.paymentMethod === 'transfer' ? 'Transfer Bank' : 'E-Wallet';
            
            // Update receipt info
            $('#receiptDate').text(receiptDate);
            $('#receiptId').text(order.id);
            $('#receiptCashier').text(order.cashier.name);
            $('#receiptCustomer').text(order.customerName || 'Pelanggan Biasa');
            $('#receiptOrderType').text(order.type === 'dinein' ? 'Makan di Tempat' : 'Bungkus');
            
            if (order.type === 'dinein') {
                $('#receiptTableInfo').show();
                $('#receiptTableNumber').text(order.tableNumber);
            } else {
                $('#receiptTableInfo').hide();
            }
            
            // Show member info if member order
            if (order.memberId) {
                const member = members.find(m => m.id === order.memberId);
                if (member) {
                    $('#receiptMemberInfo').show();
                    $('#receiptMemberName').text(member.name);
                } else {
                    $('#receiptMemberInfo').hide();
                }
            } else {
                $('#receiptMemberInfo').hide();
            }
            
            // Show donation info if donation exists
            if (order.donation > 0) {
                $('#receiptDonationInfo').show();
                $('#receiptDonationAmount').text(formatCurrency(order.donation));
            } else {
                $('#receiptDonationInfo').hide();
            }
            
            // Add items
            $('#receiptItems').empty();
            order.items.forEach(item => {
                const itemTotal = item.menu.price * item.quantity;
                
                $('#receiptItems').append(`
                    <div class="summary-row">
                        <span>${item.menu.name} (${item.quantity}x)</span>
                        <span>${formatCurrency(itemTotal)}</span>
                    </div>
                `);
            });
            
            // Add note if exists
            if (order.note) {
                $('#receiptNote').show();
                $('#receiptNoteText').text(order.note);
            } else {
                $('#receiptNote').hide();
            }
            
            // Update totals
            $('#receiptSubtotal').text(formatCurrency(order.subtotal));
            
            if (order.donation > 0) {
                $('#receiptDonationRow').show();
                $('#receiptDonation').text(formatCurrency(order.donation));
            } else {
                $('#receiptDonationRow').hide();
            }
            
            if (order.discount > 0) {
                $('#receiptDiscountRow').show();
                $('#receiptDiscount').text(`-${formatCurrency(order.discount)}`);
            } else {
                $('#receiptDiscountRow').hide();
            }
            
            $('#receiptTotal').text(formatCurrency(order.total));
            $('#receiptPaymentMethod').text(paymentMethod + ':');
            $('#receiptPaymentAmount').text(formatCurrency(order.paymentAmount));
            $('#receiptChange').text(formatCurrency(order.change));
        }
        
        // Update store info in UI
        function updateStoreInfo() {
            $('#storeNameHeader').text(settings.storeName);
            $('#receiptStoreName').text(settings.storeName);
            $('#receiptStoreAddress').text(settings.storeAddress);
            $('#receiptStorePhone').text('Telp: ' + settings.storePhone);
        }
        
        // Update table numbers based on settings
        function updateTableNumbers() {
            const $tableSelect = $('#tableNumber');
            $tableSelect.empty();
            
            for (let i = 1; i <= settings.tableCount; i++) {
                $tableSelect.append(`<option value="${i}">Meja ${i}</option>`);
            }
            
            // Set current table number if it exists
            if (currentOrder.tableNumber) {
                $tableSelect.val(currentOrder.tableNumber);
            }
        }
        
        // Reset order
        function resetOrder() {
            currentOrder = {
                items: [],
                subtotal: 0,
                total: 0,
                discount: 0,
                donation: 0,
                type: 'dinein',
                tableNumber: '1',
                note: '',
                memberId: null
            };
            
            localStorage.setItem(STORAGE_KEYS.CURRENT_ORDER, JSON.stringify(currentOrder));
            updateOrder();
            $('.order-type-btn').removeClass('active');
            $('[data-type="dinein"]').addClass('active');
            $('#orderNote').val('');
            $('#tableNumberContainer').show();
            $('#memberSearchInput').val('');
            $('#customerMember').val('');
            $('#donationAmount').val('0');
        }
        
        // Save data functions
        function saveMenus() {
            localStorage.setItem(STORAGE_KEYS.MENUS, JSON.stringify(menus));
        }
        
        function saveCategories() {
            localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
        }
        
        function saveOrders() {
            localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(orders));
        }
        
        function saveSettings() {
            localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
        }
        
        function saveMembers() {
            localStorage.setItem(STORAGE_KEYS.MEMBERS, JSON.stringify(members));
        }
        
        // Format currency
        function formatCurrency(amount) {
            return 'Rp ' + (amount || 0).toLocaleString('id-ID');
        }
        
        // Show toast notification
        function showToast(message, type = 'info', duration = 3000) {
            const toast = $('#toast');
            const toastMessage = $('#toast-message');
            
            toast.removeClass('success error warning info').addClass(type);
            toastMessage.text(message);
            toast.addClass('show');
            
            setTimeout(() => {
                toast.removeClass('show');
            }, duration);
        }
        
        // Update current date
        function updateCurrentDate() {
            $('#currentDate').text(moment().format('dddd, D MMMM YYYY, HH:mm'));
        }
    </script>
</body>
</html>
