<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium POS System - Geraiku</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #eef2ff;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --success-color: #10b981;
            --success-light: #d1fae5;
            --danger-color: #ef4444;
            --danger-light: #fee2e2;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --info-color: #3b82f6;
            --info-light: #dbeafe;
            --gray-color: #6b7280;
            --gray-light: #f3f4f6;
            --profit-color: #8b5cf6;
            --profit-light: #f5f3ff;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --rounded-sm: 0.25rem;
            --rounded: 0.5rem;
            --rounded-lg: 0.75rem;
            --rounded-xl: 1rem;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 20px;
            border-radius: var(--rounded-lg);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all .3s ease;
        }
        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        .header-info {
            text-align: right;
        }
        .header-info p {
            margin: 2px 0;
            font-size: .9rem;
        }
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            transition: all .3s ease;
        }
        .left-panel {
            flex: 1;
            min-width: 300px;
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: all .3s ease;
        }
        .right-panel {
            flex: 2;
            min-width: 400px;
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            transition: all .3s ease;
        }
        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
            transition: all .3s;
        }
        .form-control:focus {
            border-color: var(--accent-color);
            outline: 0;
            box-shadow: 0 0 0 2px rgba(67,97,238,.2);
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: var(--rounded-sm);
            cursor: pointer;
            font-size: 1rem;
            transition: all .3s;
            text-align: center;
            font-weight: 500;
        }
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-block {
            display: block;
            width: 100%;
        }
        .btn-success {
            background-color: var(--success-color);
        }
        .btn-success:hover {
            background-color: #0d9b6c;
        }
        .btn-danger {
            background-color: var(--danger-color);
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .btn-warning {
            background-color: var(--warning-color);
        }
        .btn-warning:hover {
            background-color: #e69007;
        }
        .btn-info {
            background-color: var(--info-color);
        }
        .btn-info:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: var(--gray-color);
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-sm {
            padding: 5px 10px;
            font-size: .85rem;
        }
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        .btn-outline:hover {
            background-color: var(--primary-light);
        }
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }
        .table td, .table th {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .table th {
            background-color: #f1f3f5;
            font-weight: 500;
            color: #555;
            position: sticky;
            top: 0;
        }
        .table tr:hover {
            background-color: #f8f9fa;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: .75rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        .badge-success {
            background-color: var(--success-light);
            color: #065f46;
        }
        .badge-danger {
            background-color: var(--danger-light);
            color: #b91c1c;
        }
        .badge-warning {
            background-color: var(--warning-light);
            color: #92400e;
        }
        .badge-info {
            background-color: var(--info-light);
            color: #1e40af;
        }
        .badge-primary {
            background-color: #eef2ff;
            color: var(--primary-color);
        }
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        .search-box input {
            padding-left: 40px;
        }
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            transition: all .2s ease;
        }
        .cart-item:hover {
            background-color: #f9f9f9;
        }
        .cart-item:last-child {
            border-bottom: none;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-name {
            font-weight: 500;
            margin-bottom: 3px;
        }
        .cart-item-price {
            color: #666;
            font-size: .9rem;
        }
        .cart-item-qty {
            display: flex;
            align-items: center;
        }
        .cart-item-qty button {
            width: 25px;
            height: 25px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            cursor: pointer;
            border-radius: 3px;
            transition: all .2s;
        }
        .cart-item-qty button:hover {
            background-color: #e9ecef;
        }
        .cart-item-qty input {
            width: 40px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 3px;
        }
        .cart-summary {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #ddd;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .summary-label {
            font-weight: 500;
        }
        .summary-value {
            font-weight: 500;
        }
        .total-row {
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        .payment-methods {
            margin-top: 20px;
        }
        .payment-method {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: all .2s;
        }
        .payment-method:hover {
            background-color: #f8f9fa;
        }
        .payment-method input {
            margin-right: 10px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all .3s;
        }
        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        .tab-content {
            display: none;
            animation: fadeIn .3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn .3s ease;
        }
        .modal-content {
            background-color: #fff;
            border-radius: var(--rounded-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn .3s;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .admin-modal .modal-content {
            max-width: 95%;
            width: 95%;
        }
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .modal-close {
            background: 0 0;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            transition: all .2s;
        }
        .modal-close:hover {
            color: #333;
            transform: rotate(90deg);
        }
        .modal-body {
            padding: 20px;
        }
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: #fff;
            border-radius: var(--rounded-xl);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            animation: slideUp .4s ease;
            position: relative;
            overflow: hidden;
        }
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 600;
        }
        .form-floating {
            position: relative;
            margin-bottom: 20px;
        }
        .form-floating input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            font-size: 1rem;
            transition: all .3s;
        }
        .form-floating input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67,97,238,.2);
        }
        .form-floating label {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #999;
            transition: all .3s;
            pointer-events: none;
            background-color: #fff;
            padding: 0 5px;
        }
        .form-floating input:focus + label,
        .form-floating input:not(:placeholder-shown) + label {
            top: -10px;
            left: 10px;
            font-size: .8rem;
            color: var(--primary-color);
            font-weight: 500;
        }
        .login-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        .login-logo i {
            font-size: 3rem;
            color: var(--primary-color);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .receipt {
            background-color: #fff;
            padding: 20px;
            font-family: 'Courier New', monospace;
            max-width: 300px;
            margin: 0 auto;
            box-shadow: var(--shadow-sm);
            position: relative;
            font-size: 14px;
        }
        .receipt::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url(https://raw.githubusercontent.com/LenteraKarya/transaksi/main/watermak-struk.png);
            background-repeat: no-repeat;
            background-position: center;
            background-size: 60%;
            opacity: .1;
            pointer-events: none;
            z-index: 0;
        }
        .receipt > * {
            position: relative;
            z-index: 1;
        }
        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
        }
        .receipt-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .receipt-address {
            font-size: .8rem;
            margin-bottom: 5px;
        }
        .receipt-date {
            font-size: .8rem;
            margin-bottom: 10px;
        }
        .receipt-items {
            margin-bottom: 15px;
        }
        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: .9rem;
        }
        .receipt-total {
            border-top: 1px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: 700;
        }
        .receipt-footer {
            text-align: center;
            margin-top: 15px;
            font-size: .8rem;
        }
        .float-right {
            float: right;
        }
        .ml-2 {
            margin-left: 10px;
        }
        .mt-2 {
            margin-top: 10px;
        }
        .mt-3 {
            margin-top: 15px;
        }
        .mt-4 {
            margin-top: 20px;
        }
        .mb-3 {
            margin-bottom: 15px;
        }
        .admin-password-modal {
            max-width: 400px;
        }
        .admin-password-modal .modal-content {
            max-width: 400px;
        }
        .password-input-container {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #999;
            transition: all .2s;
        }
        .password-toggle:hover {
            color: #333;
        }
        .error-message {
            color: var(--danger-color);
            font-size: .8rem;
            margin-top: 5px;
            display: none;
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid hsla(0,0%,100%,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #333;
            color: #fff;
            border-radius: var(--rounded-sm);
            box-shadow: var(--shadow-md);
            z-index: 1100;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform .3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background-color: var(--success-color);
        }
        .toast.error {
            background-color: var(--danger-color);
        }
        .toast.warning {
            background-color: var(--warning-color);
        }
        .toast.info {
            background-color: var(--info-color);
        }
        .toast i {
            margin-right: 10px;
        }
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,.5);
            z-index: 1200;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn .3s ease;
        }
        .confirmation-content {
            background-color: #fff;
            padding: 20px;
            border-radius: var(--rounded-lg);
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }
        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt, .receipt * {
                visibility: visible;
            }
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                box-shadow: none;
                padding: 20px;
                margin: 0;
                font-size: 14px;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            @page {
                size: auto;
                margin: 0;
            }
            .no-print {
                display: none !important;
            }
        }
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                min-width: 100%;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header-info {
                text-align: center;
                margin-top: 10px;
            }
            .modal-content {
                width: 95%;
            }
            .admin-modal .modal-content {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            .login-container {
                padding: 30px 20px;
                margin: 20px auto;
            }
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            .tab {
                padding: 10px 15px;
            }
            .receipt {
                max-width: 100%;
                padding: 15px;
                font-size: 12px;
            }
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity .3s;
            font-size: .8rem;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        .empty-state i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        .data-backup {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .backup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .sales-report {
            margin-top: 20px;
        }
        .report-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .report-card {
            flex: 1;
            min-width: 200px;
            background: #fff;
            border-radius: var(--rounded-sm);
            padding: 15px;
            box-shadow: var(--shadow-sm);
        }
        .report-card-title {
            font-size: .9rem;
            color: #666;
            margin-bottom: 10px;
        }
        .report-card-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all .3s;
            z-index: 100;
        }
        .fab:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        .fab i {
            font-size: 1.5rem;
        }
        .input-group {
            display: flex;
            margin-bottom: 15px;
        }
        .input-group input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-group button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .fade-in {
            animation: fadeIn .3s ease;
        }
        .slide-up {
            animation: slideUp .3s ease;
        }
        .print-btn {
            background-color: var(--gray-color);
        }
        .print-btn:hover {
            background-color: #4b5563;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-active {
            background-color: var(--success-color);
        }
        .status-inactive {
            background-color: var(--danger-color);
        }
        .qr-container {
            text-align: center;
            margin: 20px 0;
        }
        .qr-container canvas {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fff;
        }
        .barcode-container {
            text-align: center;
            margin: 20px 0;
        }
        .barcode-container svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fff;
        }
        .product-brand-unit {
            font-size: .8rem;
            color: #666;
            margin-top: 3px;
        }
        .stock-opname-container {
            margin-top: 20px;
            border: 1px solid #eee;
            border-radius: var(--rounded);
            padding: 15px;
        }
        .stock-opname-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .stock-opname-item:last-child {
            border-bottom: none;
        }
        .stock-opname-actions {
            display: flex;
            gap: 10px;
        }
        .return-reason {
            margin-top: 15px;
        }
        .return-reason textarea {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: var(--rounded-sm);
            padding: 10px;
        }
        .promo-card {
            background-color: var(--primary-light);
            border-radius: var(--rounded);
            padding: 15px;
            margin-bottom: 15px;
        }
        .promo-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .promo-card-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        .promo-card-dates {
            font-size: .8rem;
            color: var(--gray-color);
        }
        .promo-card-products {
            margin-top: 10px;
            font-size: .9rem;
        }
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .dashboard-card {
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            transition: all .3s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        .dashboard-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }
        .dashboard-card-icon.icon-sales {
            background: linear-gradient(45deg, var(--success-color), #0d9488);
        }
        .dashboard-card-icon.icon-profit {
            background: linear-gradient(45deg, var(--profit-color), #7c3aed);
        }
        .dashboard-card-icon.icon-transactions {
            background: linear-gradient(45deg, var(--info-color), #1d4ed8);
        }
        .dashboard-card-icon.icon-low-stock {
            background: linear-gradient(45deg, var(--warning-color), #d97706);
        }
        .dashboard-card-content {
            flex: 1;
        }
        .dashboard-card-label {
            font-size: .9rem;
            color: var(--gray-color);
            margin-bottom: 5px;
        }
        .dashboard-card-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        /* Stock Alert */
        .stock-alert {
            background-color: var(--danger-light);
            border-left: 4px solid var(--danger-color);
            padding: 10px;
            border-radius: var(--rounded-sm);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .stock-alert i {
            color: var(--danger-color);
            margin-right: 10px;
            font-size: 1.2rem;
        }
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .quick-action-btn {
            flex: 1;
            min-width: 120px;
            background: #fff;
            border-radius: var(--rounded);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all .3s;
            box-shadow: var(--shadow-sm);
        }
        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        .quick-action-btn i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        .quick-action-btn span {
            display: block;
            font-size: .9rem;
            font-weight: 500;
        }
        /* Recent Transactions */
        .recent-transactions {
            background: #fff;
            border-radius: var(--rounded-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
        }
        .recent-transactions h3 {
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            font-weight: 600;
        }
        /* Dark Mode */
        .dark-mode {
            background-color: #1a1a2e;
            color: #f8f9fa;
        }
        .dark-mode .header {
            background: linear-gradient(135deg, #3a0ca3, #4cc9f0);
        }
        .dark-mode .left-panel,
        .dark-mode .right-panel,
        .dark-mode .dashboard-card,
        .dark-mode .recent-transactions,
        .dark-mode .modal-content,
        .dark-mode .receipt {
            background-color: #16213e;
            color: #f8f9fa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .dark-mode .table th {
            background-color: #0f3460;
            color: #f8f9fa;
        }
        .dark-mode .table tr:hover {
            background-color: #0f3460;
        }
        .dark-mode .form-control {
            background-color: #0f3460;
            border-color: #1a1a2e;
            color: #f8f9fa;
        }
        .dark-mode .form-control:focus {
            background-color: #0f3460;
            color: #f8f9fa;
        }
        .dark-mode .panel-title,
        .dark-mode .dashboard-card-value,
        .dark-mode .summary-value,
        .dark-mode .summary-label,
        .dark-mode .cart-item-name,
        .dark-mode .cart-item-price {
            color: #f8f9fa;
        }
        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--warning-color);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all .3s;
            z-index: 100;
        }
        .theme-toggle:hover {
            background-color: #e69007;
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        /* Responsive Adjustments */
        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            .quick-action-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>
    
    <!-- Confirmation Dialog -->
    <div id="confirmationDialog" class="confirmation-dialog" style="display: none;">
        <div class="confirmation-content">
            <h4 id="confirmationMessage">Apakah Anda yakin?</h4>
            <div class="confirmation-buttons">
                <button id="confirmCancel" class="btn btn-secondary">Batal</button>
                <button id="confirmOk" class="btn btn-danger">Ya, Lanjutkan</button>
            </div>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: flex;">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-cash-register"></i>
            </div>
            <h2 class="login-title">Premium POS - Geraiku</h2>
            <form id="loginForm">
                <div class="form-floating">
                    <input type="text" id="cashierId" placeholder="ID Kasir" required>
                    <label for="cashierId">ID Kasir</label>
                    <div class="error-message" id="cashierIdError"></div>
                </div>
                <div class="form-floating">
                    <input type="password" id="cashierPin" placeholder="PIN" required maxlength="4" inputmode="numeric">
                    <label for="cashierPin">PIN</label>
                    <div class="error-message" id="cashierPinError"></div>
                </div>
                <button type="submit" class="btn btn-block" id="loginBtn">
                    <span id="loginBtnText">Login</span>
                </button>
            </form>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <!-- Dashboard Cards -->
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-sales"><i class="fas fa-dollar-sign"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Penjualan Hari Ini</div>
                    <div class="dashboard-card-value" id="todaySales">Rp 0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-profit"><i class="fas fa-chart-line"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Laba Hari Ini</div>
                    <div class="dashboard-card-value" id="todayProfit">Rp 0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-transactions"><i class="fas fa-shopping-cart"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Transaksi Hari Ini</div>
                    <div class="dashboard-card-value" id="todayTransactions">0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="dashboard-card-icon icon-low-stock"><i class="fas fa-box-open"></i></div>
                <div class="dashboard-card-content">
                    <div class="dashboard-card-label">Stok Rendah</div>
                    <div class="dashboard-card-value" id="lowStockItems">0</div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action-btn" id="quickNewTransaction">
                <i class="fas fa-plus-circle"></i>
                <span>Transaksi Baru</span>
            </div>
            <div class="quick-action-btn" id="quickHoldTransaction">
                <i class="fas fa-pause"></i>
                <span>Tahan Transaksi</span>
            </div>
            <div class="quick-action-btn" id="quickPrintReceipt">
                <i class="fas fa-print"></i>
                <span>Cetak Ulang</span>
            </div>
            <div class="quick-action-btn" id="quickStockCheck">
                <i class="fas fa-search"></i>
                <span>Cek Stok</span>
            </div>
        </div>
        
        <!-- Stock Alerts -->
        <div id="stockAlerts" style="display: none;">
            <div class="stock-alert">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Peringatan Stok Rendah!</strong>
                    <p id="stockAlertMessage">Anda memiliki 5 produk dengan stok rendah</p>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div class="header">
                <div>
                    <h1 id="storeName">Premium POS System</h1>
                    <p id="storeAddress">Jl. Contoh No. 123, Kota Contoh</p>
                </div>
                <div class="header-info">
                    <p id="currentDate">Senin, 1 Januari 2023</p>
                    <p>Kasir: <span id="loggedInCashier">John Doe</span> | <a href="#" id="logoutBtn" style="color: white; text-decoration: none;">Logout</a></p>
                    <p>Shift: <span id="shiftStatus" class="badge badge-danger">Belum Dimulai</span></p>
                </div>
            </div>
            <div class="main-content">
                <div class="left-panel">
                    <h2 class="panel-title">Produk</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="productSearch" class="form-control" placeholder="Cari produk (nama/barcode)...">
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Kategori</label>
                        <select id="productCategory" class="form-control">
                            <option value="all">Semua Kategori</option>
                        </select>
                    </div>
                    <div id="productList" class="table-responsive" style="max-height: 50vh; overflow-y: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productListBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="right-panel">
                    <h2 class="panel-title">Transaksi</h2>
                    <div class="tabs">
                        <div class="tab active" data-tab="cart">Keranjang</div>
                        <div class="tab" data-tab="customer">Pelanggan</div>
                        <div class="tab" data-tab="payment">Pembayaran</div>
                    </div>
                    <div class="tab-content active" id="cartTab">
                        <div id="cartItems"></div>
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value" id="cartSubtotal">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Diskon:</span>
                                <span class="summary-value" id="cartDiscount">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Pajak:</span>
                                <span class="summary-value" id="cartTax">Rp 0</span>
                            </div>
                            <div class="summary-row total-row">
                                <span class="summary-label">Total:</span>
                                <span class="summary-value" id="cartTotal">Rp 0</span>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button id="holdSaleBtn" class="btn btn-warning"><i class="fas fa-pause"></i> Tahan</button>
                            <button id="nextToCustomer" class="btn btn-primary" style="flex-grow: 1;">Lanjut <i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div id="heldSalesSection">
                            <h4 class="mt-4">Transaksi Ditahan</h4>
                            <div id="heldSalesList">
                                <div class="empty-state">
                                    <p>Tidak ada transaksi yang ditahan.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="customerTab">
                        <div class="form-group">
                            <label for="customerType">Tipe Pelanggan</label>
                            <select id="customerType" class="form-control">
                                <option value="walkin">Pelanggan Biasa</option>
                                <option value="member">Member</option>
                            </select>
                        </div>
                        <div id="memberFields" style="display:none">
                            <div class="form-group">
                                <label for="memberId">ID Member</label>
                                <div class="input-group">
                                    <input type="text" id="memberId" class="form-control" placeholder="Masukkan ID Member">
                                    <button id="searchMember" class="btn btn-info">Cari</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="memberDiscount">Diskon Member (%)</label>
                                <input type="number" id="memberDiscount" class="form-control" value="10" min="0" max="100">
                            </div>
                        </div>
                        <div id="customerFields" style="display:none">
                            <div class="form-group">
                                <label for="customerName">Nama Pelanggan</label>
                                <input type="text" id="customerName" class="form-control" placeholder="Masukkan nama pelanggan">
                            </div>
                            <div class="form-group">
                                <label for="customerPhone">No. Telepon</label>
                                <input type="tel" id="customerPhone" class="form-control" placeholder="Masukkan nomor telepon">
                            </div>
                            <div class="form-group">
                                <label for="customerEmail">Email (opsional)</label>
                                <input type="email" id="customerEmail" class="form-control" placeholder="Masukkan email">
                            </div>
                        </div>
                        <div class="buttons">
                            <button id="backToCart" class="btn btn-warning">Kembali ke Keranjang</button>
                            <button id="nextToPayment" class="btn btn-primary float-right">Lanjut ke Pembayaran</button>
                        </div>
                    </div>
                    <div class="tab-content" id="paymentTab">
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value" id="paymentSubtotal">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Diskon:</span>
                                <span class="summary-value" id="paymentDiscount">Rp 0</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Pajak:</span>
                                <span class="summary-value" id="paymentTax">Rp 0</span>
                            </div>
                            <div class="summary-row total-row">
                                <span class="summary-label">Total:</span>
                                <span class="summary-value" id="paymentTotal">Rp 0</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="paymentAmount">Jumlah Pembayaran</label>
                            <input type="number" id="paymentAmount" class="form-control" placeholder="Masukkan jumlah pembayaran">
                        </div>
                        <div class="payment-methods">
                            <label>Metode Pembayaran:</label>
                            <div class="payment-method">
                                <input type="radio" id="cash" name="paymentMethod" value="cash" checked="">
                                <label for="cash">Tunai</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="transfer" name="paymentMethod" value="transfer">
                                <label for="transfer">Transfer Bank</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="ewallet" name="paymentMethod" value="ewallet">
                                <label for="ewallet">E-Wallet</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="credit" name="paymentMethod" value="credit">
                                <label for="credit">Kredit</label>
                            </div>
                        </div>
                        <div class="buttons">
                            <button id="backToCustomer" class="btn btn-warning">Kembali ke Pelanggan</button>
                            <button id="completePayment" class="btn btn-success float-right"><i class="fas fa-print"></i> Selesaikan & Cetak</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Transactions -->
        <div class="recent-transactions">
            <h3>Transaksi Terakhir</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tanggal</th>
                            <th>Pelanggan</th>
                            <th>Total</th>
                            <th>Metode</th>
                        </tr>
                    </thead>
                    <tbody id="recentTransactionsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="receiptTemplate" style="display: none;"></div>
    
    <!-- Admin Password Modal -->
    <div id="adminPasswordModal" class="modal admin-password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Akses Admin</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="adminPassword">Masukkan Password Admin</label>
                    <div class="password-input-container">
                        <input type="password" id="adminPassword" class="form-control" placeholder="Password Admin">
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                    <div class="error-message" id="adminPasswordError"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-admin-password-modal">Batal</button>
                <button class="btn btn-primary verify-admin-password">Masuk</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Modal -->
    <div id="adminModal" class="modal admin-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Admin Dashboard</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab admin-tab active" data-tab="reports">Laporan</div>
                    <div class="tab admin-tab" data-tab="products">Produk</div>
                    <div class="tab admin-tab" data-tab="stockIn">Stok Masuk</div>
                    <div class="tab admin-tab" data-tab="categories">Kategori</div>
                    <div class="tab admin-tab" data-tab="customers">Pelanggan</div>
                    <div class="tab admin-tab" data-tab="transactions">Transaksi</div>
                    <div class="tab admin-tab" data-tab="settings">Pengaturan</div>
                    <div class="tab admin-tab" data-tab="cashiers">Kasir</div>
                </div>
                
                <!-- Reports Tab -->
                <div class="tab-content admin-tab-content active" id="reportsTab">
                    <div class="form-group">
                        <label for="reportDateRange">Rentang Tanggal</label>
                        <input type="text" id="reportDateRange" class="form-control" placeholder="Pilih rentang tanggal">
                    </div>
                    <div class="report-summary">
                        <div class="report-card">
                            <div class="report-card-title">Total Pendapatan</div>
                            <div class="report-card-value" id="reportTotalRevenue">Rp 0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Total Laba</div>
                            <div class="report-card-value" id="reportTotalProfit" style="color: var(--profit-color);">Rp 0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Total Transaksi</div>
                            <div class="report-card-value" id="reportTotalTransactions">0</div>
                        </div>
                        <div class="report-card">
                            <div class="report-card-title">Produk Terlaris</div>
                            <div class="report-card-value" id="reportBestSeller">-</div>
                        </div>
                    </div>
                    <div class="sales-report">
                        <canvas id="salesChart" height="150"></canvas>
                    </div>
                    <div class="mt-3">
                        <button id="exportReportPDF" class="btn btn-info"><i class="fas fa-file-pdf"></i> Ekspor ke PDF</button>
                        <button id="exportReportExcel" class="btn btn-success ml-2"><i class="fas fa-file-excel"></i> Ekspor ke Excel</button>
                        <button id="exportReportCSV" class="btn btn-secondary ml-2"><i class="fas fa-file-csv"></i> Ekspor ke CSV</button>
                    </div>
                </div>
                
                <!-- Products Tab -->
                <div class="tab-content admin-tab-content" id="productsTab">
                    <div class="form-group">
                        <div class="input-group">
                            <input type="text" id="adminProductSearch" class="form-control" placeholder="Cari produk...">
                            <button class="btn btn-info" id="searchAdminProductBtn"><i class="fas fa-search"></i> Cari</button>
                        </div>
                    </div>
                    <button id="addProduct" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Produk</button>
                    <button id="importProducts" class="btn btn-warning mb-3 ml-2"><i class="fas fa-file-import"></i> Impor Produk</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Barcode</th>
                                    <th>Nama</th>
                                    <th>Kategori</th>
                                    <th>Modal</th>
                                    <th>Harga Jual</th>
                                    <th>Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminProductsTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Stock In Tab -->
                <div class="tab-content admin-tab-content" id="stockInTab">
                    <button id="addStockIn" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Catat Stok Masuk</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Nota</th>
                                    <th>Pemasok</th>
                                    <th>Total Item</th>
                                    <th>Total Biaya</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminStockInTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Categories Tab -->
                <div class="tab-content admin-tab-content" id="categoriesTab">
                    <button id="addCategory" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Kategori</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Deskripsi</th>
                                    <th>Jumlah Produk</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCategoriesTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Customers Tab -->
                <div class="tab-content admin-tab-content" id="customersTab">
                    <button id="addCustomer" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Pelanggan</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Telepon</th>
                                    <th>Email</th>
                                    <th>Tipe</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCustomersTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Transactions Tab -->
                <div class="tab-content admin-tab-content" id="transactionsTab">
                    <div class="form-group">
                        <label for="transactionDateRange">Rentang Tanggal</label>
                        <input type="text" id="transactionDateRange" class="form-control" placeholder="Pilih rentang tanggal">
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tanggal</th>
                                    <th>Pelanggan</th>
                                    <th>Total</th>
                                    <th>Kasir</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminTransactionsTable"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="tab-content admin-tab-content" id="settingsTab">
                    <div class="form-group">
                        <label for="settingStoreName">Nama Toko</label>
                        <input type="text" id="settingStoreName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="settingStoreAddress">Alamat Toko</label>
                        <textarea id="settingStoreAddress" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="settingStorePhone">Telepon Toko</label>
                        <input type="tel" id="settingStorePhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="settingTaxRate">Pajak (%)</label>
                        <input type="number" id="settingTaxRate" class="form-control" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label for="settingAdminPassword">Password Admin Baru</label>
                        <input type="password" id="settingAdminPassword" class="form-control" placeholder="Biarkan kosong jika tidak diganti">
                    </div>
                    <div class="form-group">
                        <label for="settingReceiptFooter">Footer Struk</label>
                        <textarea id="settingReceiptFooter" class="form-control" rows="2" placeholder="Pesan yang muncul di bagian bawah struk"></textarea>
                    </div>
                    <button id="saveSettings" class="btn btn-success mt-3">Simpan Pengaturan</button>
                    <div class="data-backup mt-4">
                        <h4>Data Backup</h4>
                        <p>Gunakan fitur ini untuk menyimpan atau memulihkan data.</p>
                        <div class="backup-actions">
                            <button id="exportData" class="btn btn-info">Ekspor Semua Data</button>
                            <button id="importData" class="btn btn-warning">Impor Data</button>
                            <button id="resetData" class="btn btn-danger">Reset Data</button>
                        </div>
                    </div>
                </div>
                
                <!-- Cashiers Tab -->
                <div class="tab-content admin-tab-content" id="cashiersTab">
                    <button id="addCashier" class="btn btn-success mb-3"><i class="fas fa-plus"></i> Tambah Kasir</button>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>PIN</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminCashiersTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-admin-modal">Tutup</button>
            </div>
        </div>
    </div>
    
    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Tambah Produk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label for="productBarcode">Barcode</label>
                    <input type="text" id="productBarcode" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productName">Nama Produk</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productCategoryModal">Kategori</label>
                    <select id="productCategoryModal" class="form-control" required></select>
                </div>
                <div class="form-group">
                    <label for="productBrand">Merek</label>
                    <input type="text" id="productBrand" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productUnit">Satuan</label>
                    <input type="text" id="productUnit" class="form-control" placeholder="pcs, kg, liter, etc">
                </div>
                <div class="form-group">
                    <label for="productCostPrice">Harga Modal</label>
                    <input type="number" id="productCostPrice" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label for="productPrice">Harga Jual</label>
                    <input type="number" id="productPrice" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label for="productStock">Stok Awal</label>
                    <input type="number" id="productStock" class="form-control" min="0" required>
                </div>
                <div class="form-group">
                    <label for="productMinStock">Stok Minimum</label>
                    <input type="number" id="productMinStock" class="form-control" min="0" value="5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-product-modal">Batal</button>
                <button class="btn btn-success" id="saveProductBtn">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Kategori</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="categoryName">Nama Kategori</label>
                    <input type="text" id="categoryName" class="form-control" placeholder="Masukkan nama kategori" required>
                </div>
                <div class="form-group">
                    <label for="categoryDescription">Deskripsi</label>
                    <textarea id="categoryDescription" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-category-modal">Batal</button>
                <button class="btn btn-success save-category">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Category Modal -->
    <div id="editCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Kategori</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCategoryId">
                <div class="form-group">
                    <label for="editCategoryName">Nama Kategori</label>
                    <input type="text" id="editCategoryName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editCategoryDescription">Deskripsi</label>
                    <textarea id="editCategoryDescription" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-edit-category-modal">Batal</button>
                <button class="btn btn-success update-category">Update</button>
            </div>
        </div>
    </div>
    
    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Pelanggan</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="customerTypeModal">Tipe Pelanggan</label>
                    <select id="customerTypeModal" class="form-control">
                        <option value="walkin">Pelanggan Biasa</option>
                        <option value="member">Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customerNameModal">Nama Lengkap</label>
                    <input type="text" id="customerNameModal" class="form-control" placeholder="Masukkan nama lengkap" required>
                </div>
                <div class="form-group">
                    <label for="customerPhoneModal">No. Telepon</label>
                    <input type="tel" id="customerPhoneModal" class="form-control" placeholder="Masukkan nomor telepon" required>
                </div>
                <div class="form-group">
                    <label for="customerEmailModal">Email</label>
                    <input type="email" id="customerEmailModal" class="form-control" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label for="customerAddressModal">Alamat</label>
                    <textarea id="customerAddressModal" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-customer-modal">Batal</button>
                <button class="btn btn-success save-customer">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Pelanggan</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editCustomerId">
                <div class="form-group">
                    <label for="editCustomerType">Tipe Pelanggan</label>
                    <select id="editCustomerType" class="form-control">
                        <option value="walkin">Pelanggan Biasa</option>
                        <option value="member">Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCustomerName">Nama Lengkap</label>
                    <input type="text" id="editCustomerName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editCustomerPhone">No. Telepon</label>
                    <input type="tel" id="editCustomerPhone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="editCustomerEmail">Email</label>
                    <input type="email" id="editCustomerEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editCustomerAddress">Alamat</label>
                    <textarea id="editCustomerAddress" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-edit-customer-modal">Batal</button>
                <button class="btn btn-success update-customer">Update</button>
            </div>
        </div>
    </div>
    
    <!-- Cashier Modal -->
    <div id="cashierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="cashierModalTitle">Tambah Kasir</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="cashierIdModal">
                <div class="form-group">
                    <label for="cashierNameModal">Nama Kasir</label>
                    <input type="text" id="cashierNameModal" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="cashierPinModal">PIN (4 digit)</label>
                    <input type="password" id="cashierPinModal" class="form-control" maxlength="4" inputmode="numeric" required>
                </div>
                <div class="form-group">
                    <label for="cashierStatusModal">Status</label>
                    <select id="cashierStatusModal" class="form-control">
                        <option value="active">Aktif</option>
                        <option value="inactive">Nonaktif</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-cashier-modal">Batal</button>
                <button class="btn btn-success save-cashier">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Other modals -->
    <div id="shiftModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="shiftModalTitle"></h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="shiftModalBody"></div>
            <div class="modal-footer" id="shiftModalFooter"></div>
        </div>
    </div>
    
    <div id="stockInModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="stockInModalTitle">Catat Stok Masuk</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="stockInId">
                <div class="row" style="display:flex; gap: 20px;">
                    <div style="flex:1;">
                        <label for="stockInDate">Tanggal</label>
                        <input type="date" id="stockInDate" class="form-control">
                    </div>
                    <div style="flex:1;">
                        <label for="stockInRef">No. Nota/Referensi</label>
                        <input type="text" id="stockInRef" class="form-control">
                    </div>
                    <div style="flex:1;">
                        <label for="stockInSupplier">Pemasok</label>
                        <input type="text" id="stockInSupplier" class="form-control">
                    </div>
                </div>
                <hr class="my-3">
                <div class="input-group">
                    <input type="text" id="stockInProductSearch" class="form-control" placeholder="Cari produk untuk ditambahkan...">
                    <button class="btn btn-info" id="searchStockProductBtn"><i class="fas fa-search"></i> Cari</button>
                </div>
                <div class="table-responsive" style="max-height: 250px; overflow-y:auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Jml</th>
                                <th>Harga Beli</th>
                                <th>Subtotal</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="stockInItemsTable"></tbody>
                    </table>
                </div>
                <div class="cart-summary">
                    <div class="summary-row total-row">
                        <span class="summary-label">Total Biaya:</span>
                        <span class="summary-value" id="stockInTotalCost">Rp 0</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-stock-in-modal">Batal</button>
                <button class="btn btn-success" id="saveStockInBtn">Simpan Stok Masuk</button>
            </div>
        </div>
    </div>
    
    <div id="codeGeneratorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Barcode & QR Code</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <h4 id="codeGeneratorProductName" class="text-center"></h4>
                <div class="barcode-container">
                    <svg id="barcode"></svg>
                </div>
                <div class="qr-container" id="qrcode"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-code-generator-modal">Tutup</button>
                <button class="btn btn-primary print-codes"><i class="fas fa-print"></i> Cetak</button>
            </div>
        </div>
    </div>
    
    <div id="transactionDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail Transaksi</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="receipt" id="transactionDetailReceipt"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary print-receipt"><i class="fas fa-print"></i> Cetak Ulang</button>
                <button class="btn btn-secondary close-detail-modal">Tutup</button>
            </div>
        </div>
    </div>
    
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Impor Data</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Pilih Jenis Data</label>
                    <select id="importDataType" class="form-control">
                        <option value="products">Produk</option>
                        <option value="customers">Pelanggan</option>
                        <option value="categories">Kategori</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pilih File (Excel/CSV/JSON)</label>
                    <input type="file" id="importFile" class="form-control">
                </div>
                <div id="importPreview" class="mt-3" style="display: none;">
                    <h5>Pratinjau Data</h5>
                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                        <table class="table" id="importPreviewTable"></table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-import-modal">Batal</button>
                <button class="btn btn-success" id="confirmImport">Impor Data</button>
            </div>
        </div>
    </div>
    
    <!-- Floating Action Buttons -->
    <div id="adminAccess" class="fab" title="Akses Admin">
        <i class="fas fa-lock"></i>
    </div>
    <div id="shiftAccess" class="fab" title="Manajemen Shift" style="bottom: 90px; background-color: var(--warning-color);">
        <i class="fas fa-clock"></i>
    </div>
    <div id="themeToggle" class="theme-toggle" title="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <script>
        moment.locale('id');
        const ADMIN_PASSWORD = "Geraiku.12345";
        const STORAGE_KEYS = {
            PRODUCTS: 'pos_premium_products',
            CATEGORIES: 'pos_premium_categories',
            CUSTOMERS: 'pos_premium_customers',
            CASHIERS: 'pos_premium_cashiers',
            TRANSACTIONS: 'pos_premium_transactions',
            SETTINGS: 'pos_premium_settings',
            CURRENT_CASHIER: 'pos_premium_current_cashier',
            HELD_SALES: 'pos_premium_held_sales',
            STOCK_IN: 'pos_premium_stock_in',
            CURRENT_SHIFT: 'pos_premium_current_shift',
        };
        
        let products = [], categories = [], customers = [], cashiers = [], transactions = [], settings = {}, heldSales = [], stockInRecords = [], currentShift = null;
        let currentCashier = null;
        let currentCart = { items: [], customer: null, discount: 0, tax: 0, subtotal: 0, total: 0, totalCost: 0, profit: 0 };
        let salesChart = null;
        let currentStockInItems = [];
        let darkMode = false;
        
        // --- Utility Functions ---
        function showToast(message, type = 'info', duration = 3000) {
            const t = $("#toast");
            const s = $("#toast-message");
            t.removeClass("success error warning info").addClass(type);
            s.text(message);
            t.addClass("show");
            setTimeout(() => t.removeClass("show"), duration);
        }
        
        function showConfirmation(message, callback, btnText = "Ya, Lanjutkan") {
            const t = $("#confirmationMessage");
            const o = $("#confirmationDialog");
            const n = $("#confirmOk");
            const a = $("#confirmCancel");
            t.text(message);
            n.text(btnText);
            o.css("display", "flex");
            n.off("click").on("click", () => { o.hide(); callback && callback(true); });
            a.off("click").on("click", () => { o.hide(); callback && callback(false); });
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat("id-ID", { style: "currency", currency: "IDR", minimumFractionDigits: 0 }).format(amount || 0);
        }
        
        function exportToExcel(data, filename) {
            try {
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Data");
                XLSX.writeFile(wb, filename || "export.xlsx");
                showToast("Excel berhasil diekspor", "success");
            } catch (e) {
                showToast("Gagal ekspor Excel", "error");
            }
        }
        
        function exportToCSV(data, filename) {
            try {
                const csv = XLSX.utils.sheet_to_csv(XLSX.utils.json_to_sheet(data));
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename || "export.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast("CSV berhasil diekspor", "success");
            } catch (e) {
                showToast("Gagal ekspor CSV", "error");
            }
        }
        
        function exportToPDF(elementId, filename) {
            const element = document.getElementById(elementId);
            const opt = {
                margin: 10,
                filename: filename || 'laporan.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
            showToast("PDF berhasil diekspor", "success");
        }
        
        function saveData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                showToast("Storage penuh atau error.", "error");
            }
        }
        
        function loadData() {
            try {
                products = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS)) || [];
                categories = JSON.parse(localStorage.getItem(STORAGE_KEYS.CATEGORIES)) || [];
                customers = JSON.parse(localStorage.getItem(STORAGE_KEYS.CUSTOMERS)) || [];
                cashiers = JSON.parse(localStorage.getItem(STORAGE_KEYS.CASHIERS)) || [];
                transactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS)) || [];
                settings = JSON.parse(localStorage.getItem(STORAGE_KEYS.SETTINGS)) || {};
                heldSales = JSON.parse(localStorage.getItem(STORAGE_KEYS.HELD_SALES)) || [];
                stockInRecords = JSON.parse(localStorage.getItem(STORAGE_KEYS.STOCK_IN)) || [];
                currentCashier = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_CASHIER)) || null;
                currentShift = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_SHIFT)) || null;
            } catch (e) {
                showToast("Gagal memuat data.", "error");
            }
        }
        
        function initializeDefaultData() {
            loadData();
            
            if (cashiers.length === 0) {
                cashiers = [
                    { id: 'K001', name: 'Admin', pin: '1234', status: 'active' },
                    { id: 'K002', name: 'Kasir 1', pin: '1111', status: 'active' },
                ];
                saveData(STORAGE_KEYS.CASHIERS, cashiers);
            }
            
            if (Object.keys(settings).length === 0) {
                settings = {
                    storeName: "Toko Geraiku",
                    storeAddress: "Jl. Digital Raya No. 1",
                    storePhone: "081234567890",
                    taxRate: 10,
                    receiptFooter: "Terima kasih atas kunjungan Anda!",
                    darkMode: false
                };
                saveData(STORAGE_KEYS.SETTINGS, settings);
            }
            
            if (categories.length === 0) {
                categories = [
                    { id: 'C001', name: 'Makanan Ringan', description: '' },
                    { id: 'C002', name: 'Minuman Dingin', description: '' },
                ];
                saveData(STORAGE_KEYS.CATEGORIES, categories);
            }
            
            if (products.length === 0) {
                products = [
                    { 
                        id: 'P001', 
                        barcode: '8992761134015', 
                        name: 'Chitato Sapi Panggang', 
                        categoryId: 'C001', 
                        brand: 'Indofood', 
                        unit: 'pcs',
                        costPrice: 7500, 
                        price: 10000, 
                        stock: 50,
                        minStock: 5
                    },
                    { 
                        id: 'P002', 
                        barcode: '8996001300032', 
                        name: 'Coca-Cola 390ml', 
                        categoryId: 'C002', 
                        brand: 'Coca-Cola', 
                        unit: 'botol',
                        costPrice: 3500, 
                        price: 5000, 
                        stock: 100,
                        minStock: 10
                    },
                ];
                saveData(STORAGE_KEYS.PRODUCTS, products);
            }
            
            // Set dark mode if enabled in settings
            if (settings.darkMode) {
                toggleDarkMode(true);
            }
        }
        
        function toggleDarkMode(enable) {
            darkMode = enable;
            if (enable) {
                $('body').addClass('dark-mode');
                $('#themeToggle i').removeClass('fa-moon').addClass('fa-sun');
            } else {
                $('body').removeClass('dark-mode');
                $('#themeToggle i').removeClass('fa-sun').addClass('fa-moon');
            }
            settings.darkMode = enable;
            saveData(STORAGE_KEYS.SETTINGS, settings);
        }
        
        function updateAllUI() {
            updateCurrentDate();
            updateDashboard();
            loadProducts();
            updateCategoryDropdowns();
            updateCart();
            updateHeldSalesList();
            updateShiftStatus();
            updateRecentTransactions();
            checkLowStock();
            
            $('#storeName').text(settings.storeName);
            $('#storeAddress').text(settings.storeAddress);
        }
        
        function updateCurrentDate() {
            $('#currentDate').text(moment().format('dddd, D MMMM YYYY, HH:mm'));
        }
        
        function updateDashboard() {
            const today = moment().startOf('day');
            const todayTransactions = transactions.filter(t => moment(t.date).isSameOrAfter(today));
            const todaySales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            const todayProfit = todayTransactions.reduce((sum, t) => sum + t.profit, 0);
            const lowStockItems = products.filter(p => p.stock <= p.minStock && p.stock > 0).length;
            
            $('#todaySales').text(formatCurrency(todaySales));
            $('#todayProfit').text(formatCurrency(todayProfit));
            $('#todayTransactions').text(todayTransactions.length);
            $('#lowStockItems').text(lowStockItems);
        }
        
        function updateRecentTransactions() {
            const recent = transactions.slice(0, 5);
            const table = $('#recentTransactionsTable');
            table.empty();
            
            if (recent.length === 0) {
                table.html('<tr><td colspan="5" class="text-center">Tidak ada transaksi terakhir</td></tr>');
            } else {
                recent.forEach(t => {
                    table.append(`
                        <tr>
                            <td>${t.id}</td>
                            <td>${moment(t.date).format('DD/MM HH:mm')}</td>
                            <td>${t.customer?.name || 'Walk-in'}</td>
                            <td>${formatCurrency(t.total)}</td>
                            <td>${t.paymentMethod}</td>
                        </tr>
                    `);
                });
            }
        }
        
        function checkLowStock() {
            const lowStockProducts = products.filter(p => p.stock <= p.minStock && p.stock > 0);
            const alert = $('#stockAlerts');
            
            if (lowStockProducts.length > 0) {
                alert.show();
                $('#stockAlertMessage').text(`Anda memiliki ${lowStockProducts.length} produk dengan stok rendah`);
            } else {
                alert.hide();
            }
        }
        
        function updateCart() {
            currentCart.subtotal = currentCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            currentCart.totalCost = currentCart.items.reduce((sum, item) => sum + (item.costPrice * item.quantity), 0);
            
            const discountPercentage = currentCart.customer?.type === 'member' ? (parseInt($('#memberDiscount').val()) || 0) : 0;
            currentCart.discount = (currentCart.subtotal * discountPercentage) / 100;
            currentCart.tax = ((currentCart.subtotal - currentCart.discount) * settings.taxRate) / 100;
            currentCart.total = currentCart.subtotal - currentCart.discount + currentCart.tax;
            currentCart.profit = (currentCart.subtotal - currentCart.discount) - currentCart.totalCost;
            
            $('#cartItems').empty();
            if (currentCart.items.length === 0) {
                $('#cartItems').html('<div class="empty-state"><i class="fas fa-shopping-cart"></i><p>Keranjang belanja kosong</p></div>');
            } else {
                currentCart.items.forEach(item => {
                    $('#cartItems').append(`
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">${formatCurrency(item.price)}</div>
                                <div class="product-brand-unit">${item.brand || ''} ${item.unit ? `(${item.unit})` : ''}</div>
                            </div>
                            <div class="cart-item-qty">
                                <input type="number" value="${item.quantity}" min="1" max="${item.stock}" class="cart-item-quantity" data-id="${item.productId}">
                                <button class="btn btn-danger btn-sm ml-2 remove-from-cart" data-id="${item.productId}"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `);
                });
            }
            
            $('#cartSubtotal, #paymentSubtotal').text(formatCurrency(currentCart.subtotal));
            $('#cartDiscount, #paymentDiscount').text(formatCurrency(currentCart.discount));
            $('#cartTax, #paymentTax').text(formatCurrency(currentCart.tax));
            $('#cartTotal, #paymentTotal').text(formatCurrency(currentCart.total));
        }
        
        function resetCart() {
            currentCart = { items: [], customer: null, discount: 0, tax: 0, subtotal: 0, total: 0, totalCost: 0, profit: 0 };
            updateCart();
            $('#customerType').val('walkin').trigger('change');
            $('#memberId, #customerName, #customerPhone, #customerEmail').val('');
            $('#paymentAmount').val('');
        }
        
        function loadProducts(searchTerm = '', categoryId = 'all') {
            let filteredProducts = products;
            if (searchTerm) {
                searchTerm = searchTerm.toLowerCase();
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.barcode.includes(searchTerm) ||
                    (p.brand && p.brand.toLowerCase().includes(searchTerm))
                );
            }
            if (categoryId !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.categoryId === categoryId);
            }
            
            const productListBody = $('#productListBody');
            productListBody.empty();
            
            if (filteredProducts.length === 0) {
                productListBody.html('<tr><td colspan="4"><div class="empty-state"><p>Produk tidak ditemukan</p></div></td></tr>');
            } else {
                filteredProducts.forEach(product => {
                    const category = categories.find(c => c.id === product.categoryId);
                    const stockClass = product.stock <= product.minStock ? 'text-danger' : product.stock <= (product.minStock * 2) ? 'text-warning' : '';
                    
                    productListBody.append(`
                        <tr>
                            <td>
                                <div>${product.name}</div>
                                <small class="text-muted">${product.brand || ''} ${product.unit ? `(${product.unit})` : ''}</small>
                            </td>
                            <td>${formatCurrency(product.price)}</td>
                            <td class="${stockClass}">${product.stock} ${product.unit || ''}</td>
                            <td>
                                <button class="btn btn-success btn-sm add-to-cart" data-id="${product.id}" ${product.stock <= 0 ? 'disabled' : ''}>
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        function updateCategoryDropdowns() {
            const selects = $('#productCategory, #productCategoryModal');
            selects.empty().append('<option value="all">Semua Kategori</option>');
            categories.forEach(c => selects.append(`<option value="${c.id}">${c.name}</option>`));
        }
        
        // --- Hold & Resume Sales ---
        function holdSale() {
            if (currentCart.items.length === 0) {
                showToast('Keranjang kosong.', 'warning');
                return;
            }
            
            const saleName = `Pelanggan #${heldSales.length + 1} - ${moment().format('HH:mm')}`;
            heldSales.push({ 
                name: saleName, 
                cart: JSON.parse(JSON.stringify(currentCart)),
                date: new Date()
            });
            
            saveData(STORAGE_KEYS.HELD_SALES, heldSales);
            resetCart();
            updateHeldSalesList();
            showToast(`Transaksi ditahan: ${saleName}`, 'success');
        }
        
        function resumeSale(index) {
            const sale = heldSales[index];
            if (currentCart.items.length > 0) {
                showToast('Selesaikan dulu transaksi saat ini.', 'warning');
                return;
            }
            
            currentCart = JSON.parse(JSON.stringify(sale.cart));
            heldSales.splice(index, 1);
            saveData(STORAGE_KEYS.HELD_SALES, heldSales);
            updateCart();
            updateHeldSalesList();
            showToast('Transaksi dilanjutkan.', 'info');
        }
        
        function deleteHeldSale(index) {
            const name = heldSales[index].name;
            showConfirmation(`Hapus transaksi "${name}"?`, confirmed => {
                if (confirmed) {
                    heldSales.splice(index, 1);
                    saveData(STORAGE_KEYS.HELD_SALES, heldSales);
                    updateHeldSalesList();
                    showToast('Transaksi dihapus.', 'success');
                }
            });
        }
        
        function updateHeldSalesList() {
            const list = $('#heldSalesList');
            list.empty();
            
            if (heldSales.length === 0) {
                list.html('<div class="empty-state"><p>Tidak ada transaksi ditahan.</p></div>');
            } else {
                heldSales.forEach((sale, index) => {
                    list.append(`
                        <div class="held-sale-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                            <div>
                                <div><strong>${sale.name}</strong></div>
                                <small>${moment(sale.date).format('DD/MM HH:mm')} • ${sale.cart.items.length} item</small>
                            </div>
                            <div>
                                <button class="btn btn-info btn-sm resume-sale" data-index="${index}"><i class="fas fa-play"></i></button>
                                <button class="btn btn-danger btn-sm delete-held-sale" data-index="${index}"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `);
                });
            }
        }
        
        // --- Shift Management ---
        function updateShiftStatus() {
            const badge = $('#shiftStatus');
            if (currentShift && currentShift.isActive) {
                badge.text(`Aktif ${moment(currentShift.startTime).format('HH:mm')}`).removeClass('badge-danger').addClass('badge-success');
            } else {
                badge.text('Belum Dimulai').removeClass('badge-success').addClass('badge-danger');
            }
        }
        
        function manageShift() {
            const modal = $('#shiftModal');
            
            if (currentShift && currentShift.isActive) {
                // End Shift
                $('#shiftModalTitle').text('Akhiri Shift');
                
                const cashSales = transactions.filter(t => 
                    moment(t.date).isAfter(currentShift.startTime) && 
                    t.paymentMethod === 'cash'
                ).reduce((s, t) => s + t.total, 0);
                
                const expected = currentShift.openingBalance + cashSales;
                
                $('#shiftModalBody').html(`
                    <p>Dimulai: <strong>${moment(currentShift.startTime).format('LLL')}</strong></p>
                    <p>Modal: <strong>${formatCurrency(currentShift.openingBalance)}</strong></p>
                    <p>Penjualan Tunai: <strong>${formatCurrency(cashSales)}</strong></p>
                    <hr>
                    <p>Harusnya: <strong>${formatCurrency(expected)}</strong></p>
                    <div class="form-group mt-3">
                        <label>Uang di Laci (Nyata)</label>
                        <input type="number" id="closingBalance" class="form-control" placeholder="Jumlah aktual">
                    </div>
                    <div class="form-group">
                        <label>Catatan</label>
                        <textarea id="shiftNotes" class="form-control" rows="2" placeholder="Catatan tambahan"></textarea>
                    </div>
                `);
                
                $('#shiftModalFooter').html(`
                    <button class="btn btn-secondary close-shift-modal">Batal</button>
                    <button class="btn btn-danger" id="endShiftBtn">Akhiri Shift</button>
                `);
                
                $('#endShiftBtn').click(() => {
                    const actual = parseFloat($('#closingBalance').val());
                    if (isNaN(actual)) { 
                        showToast('Isi jumlah uang.', 'error'); 
                        return; 
                    }
                    
                    currentShift.closingBalance = actual;
                    currentShift.difference = actual - expected;
                    currentShift.notes = $('#shiftNotes').val();
                    currentShift.isActive = false;
                    currentShift.endTime = new Date();
                    
                    saveData(STORAGE_KEYS.CURRENT_SHIFT, currentShift);
                    showToast(`Shift diakhiri. Selisih: ${formatCurrency(currentShift.difference)}`, 'success');
                    
                    currentShift = null;
                    modal.hide();
                    updateShiftStatus();
                });
            } else {
                // Start Shift
                $('#shiftModalTitle').text('Mulai Shift');
                
                $('#shiftModalBody').html(`
                    <div class="form-group">
                        <label>Modal Awal</label>
                        <input type="number" id="openingBalance" class="form-control" placeholder="Uang di laci">
                    </div>
                    <div class="form-group">
                        <label>Catatan</label>
                        <textarea id="shiftNotes" class="form-control" rows="2" placeholder="Catatan shift"></textarea>
                    </div>
                `);
                
                $('#shiftModalFooter').html(`
                    <button class="btn btn-secondary close-shift-modal">Batal</button>
                    <button class="btn btn-success" id="startShiftBtn">Mulai Shift</button>
                `);
                
                $('#startShiftBtn').click(() => {
                    const opening = parseFloat($('#openingBalance').val());
                    if (isNaN(opening)) { 
                        showToast('Isi modal awal.', 'error'); 
                        return; 
                    }
                    
                    currentShift = {
                        cashierId: currentCashier.id,
                        cashierName: currentCashier.name,
                        startTime: new Date(),
                        openingBalance: opening,
                        notes: $('#shiftNotes').val(),
                        isActive: true
                    };
                    
                    saveData(STORAGE_KEYS.CURRENT_SHIFT, currentShift);
                    showToast('Shift dimulai!', 'success');
                    modal.hide();
                    updateShiftStatus();
                });
            }
            
            modal.css('display', 'flex');
        }
        
        // --- Admin Functions ---
        function loadAdminData() {
            loadAdminProducts();
            loadAdminStockIn();
            loadAdminCategories();
            loadAdminCustomers();
            loadAdminTransactions();
            loadAdminCashiers();
            loadSalesReport();
            
            $('#settingStoreName').val(settings.storeName);
            $('#settingStoreAddress').val(settings.storeAddress);
            $('#settingStorePhone').val(settings.storePhone);
            $('#settingTaxRate').val(settings.taxRate);
            $('#settingReceiptFooter').val(settings.receiptFooter);
        }
        
        function loadAdminProducts() {
            $('#adminProductsTable').empty();
            
            products.forEach(p => {
                const category = categories.find(c => c.id === p.categoryId);
                const stockClass = p.stock <= p.minStock ? 'text-danger' : p.stock <= (p.minStock * 2) ? 'text-warning' : '';
                
                $('#adminProductsTable').append(`
                    <tr>
                        <td>${p.barcode}</td>
                        <td>
                            <div>${p.name}</div>
                            <small class="text-muted">${p.brand || ''} ${p.unit ? `(${p.unit})` : ''}</small>
                        </td>
                        <td>${category?.name || '-'}</td>
                        <td>${formatCurrency(p.costPrice)}</td>
                        <td>${formatCurrency(p.price)}</td>
                        <td class="${stockClass}">${p.stock}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-product" data-id="${p.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-product" data-id="${p.id}"><i class="fas fa-trash"></i></button>
                            <button class="btn btn-secondary btn-sm generate-codes" data-id="${p.id}"><i class="fas fa-barcode"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function saveProduct() {
            const productId = $('#productId').val();
            const data = {
                barcode: $('#productBarcode').val().trim(),
                name: $('#productName').val().trim(),
                categoryId: $('#productCategoryModal').val(),
                brand: $('#productBrand').val().trim(),
                unit: $('#productUnit').val().trim(),
                costPrice: parseFloat($('#productCostPrice').val()) || 0,
                price: parseFloat($('#productPrice').val()) || 0,
                stock: parseInt($('#productStock').val()) || 0,
                minStock: parseInt($('#productMinStock').val()) || 5
            };
            
            if (!data.name || !data.barcode || data.price <= 0) {
                showToast('Nama, barcode, dan harga harus diisi.', 'error');
                return;
            }
            
            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id === productId);
                products[index] = { ...products[index], ...data };
                showToast('Produk diperbarui.', 'success');
            } else {
                // Add new product
                data.id = 'P' + Date.now();
                products.push(data);
                
                // Record initial stock
                const record = {
                    id: 'SI' + Date.now(),
                    date: moment().format('YYYY-MM-DD'),
                    ref: 'AUTO-' + data.id,
                    supplier: 'Internal',
                    items: [{ 
                        productId: data.id, 
                        productName: data.name,
                        quantity: data.stock, 
                        purchasePrice: data.costPrice 
                    }],
                    totalCost: data.costPrice * data.stock
                };
                
                stockInRecords.unshift(record);
                saveData(STORAGE_KEYS.STOCK_IN, stockInRecords);
                showToast('Produk baru ditambahkan dan stok masuk dicatat.', 'success');
            }
            
            saveData(STORAGE_KEYS.PRODUCTS, products);
            loadAdminProducts();
            loadProducts();
            checkLowStock();
            $('#productModal').hide();
        }
        
        function editProduct(id) {
            const p = products.find(p => p.id === id);
            if (!p) return;
            
            $('#productModalTitle').text('Edit Produk');
            $('#productId').val(p.id);
            $('#productBarcode').val(p.barcode);
            $('#productName').val(p.name);
            $('#productCategoryModal').val(p.categoryId);
            $('#productBrand').val(p.brand || '');
            $('#productUnit').val(p.unit || '');
            $('#productCostPrice').val(p.costPrice);
            $('#productPrice').val(p.price);
            $('#productStock').val(p.stock);
            $('#productMinStock').val(p.minStock || 5);
            $('#productModal').css('display', 'flex');
        }
        
        function deleteProduct(id) {
            showConfirmation('Hapus produk ini?', confirmed => {
                if (confirmed) {
                    products = products.filter(p => p.id !== id);
                    saveData(STORAGE_KEYS.PRODUCTS, products);
                    loadAdminProducts();
                    loadProducts();
                    checkLowStock();
                    showToast('Produk dihapus.', 'success');
                }
            });
        }
        
        function generateBarcode(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            $('#codeGeneratorProductName').text(product.name);
            $('#barcode').empty();
            
            try {
                JsBarcode("#barcode", product.barcode, {
                    format: "CODE128",
                    lineColor: darkMode ? "#fff" : "#000",
                    width: 2,
                    height: 60,
                    displayValue: true,
                    fontSize: 14,
                    margin: 10
                });
                
                $('#qrcode').empty();
                new QRCode(document.getElementById("qrcode"), {
                    text: product.barcode,
                    width: 150,
                    height: 150,
                    colorDark: darkMode ? "#ffffff" : "#000000",
                    colorLight: "transparent",
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                $('#codeGeneratorModal').css('display', 'flex');
            } catch (e) {
                showToast('Gagal membuat barcode', 'error');
            }
        }
        
        function loadAdminStockIn() {
            $('#adminStockInTable').empty();
            
            stockInRecords.forEach(s => {
                $('#adminStockInTable').append(`
                    <tr>
                        <td>${moment(s.date).format('DD/MM/YYYY')}</td>
                        <td>${s.ref}</td>
                        <td>${s.supplier}</td>
                        <td>${s.items.reduce((sum, i) => sum + i.quantity, 0)}</td>
                        <td>${formatCurrency(s.totalCost)}</td>
                        <td>
                            <button class="btn btn-info btn-sm view-stock-in" data-id="${s.id}"><i class="fas fa-eye"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function addStockIn() {
            currentStockInItems = [];
            $('#stockInId').val('');
            $('#stockInDate').val(moment().format('YYYY-MM-DD'));
            $('#stockInRef').val('');
            $('#stockInSupplier').val('');
            $('#stockInItemsTable').empty();
            $('#stockInTotalCost').text('Rp 0');
            $('#stockInModal').css('display', 'flex');
        }
        
        function saveStockIn() {
            const id = $('#stockInId').val();
            const data = {
                date: $('#stockInDate').val(),
                ref: $('#stockInRef').val().trim(),
                supplier: $('#stockInSupplier').val().trim(),
                items: currentStockInItems,
                totalCost: currentStockInItems.reduce((sum, i) => sum + (i.quantity * i.purchasePrice), 0)
            };
            
            if (!data.ref || !data.supplier || data.items.length === 0) {
                showToast('Isi semua field yang diperlukan.', 'error');
                return;
            }
            
            if (id) {
                // Update existing stock in
                const index = stockInRecords.findIndex(s => s.id === id);
                stockInRecords[index] = { ...stockInRecords[index], ...data };
                showToast('Stok masuk diperbarui.', 'success');
            } else {
                // Add new stock in
                data.id = 'SI' + Date.now();
                stockInRecords.unshift(data);
                showToast('Stok masuk dicatat.', 'success');
                
                // Update product stocks
                data.items.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product) {
                        product.stock += item.quantity;
                    }
                });
                
                saveData(STORAGE_KEYS.PRODUCTS, products);
            }
            
            saveData(STORAGE_KEYS.STOCK_IN, stockInRecords);
            loadAdminStockIn();
            loadProducts();
            checkLowStock();
            $('#stockInModal').hide();
        }
        
        function loadAdminCategories() {
            $('#adminCategoriesTable').empty();
            
            categories.forEach(c => {
                const count = products.filter(p => p.categoryId === c.id).length;
                
                $('#adminCategoriesTable').append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>${c.description || '-'}</td>
                        <td>${count}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-category" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-category" data-id="${c.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function saveCategory() {
            const name = $('#categoryName').val().trim();
            if (!name) { 
                showToast('Nama kategori harus diisi.', 'error'); 
                return; 
            }
            
            const id = 'C' + Date.now();
            categories.push({ 
                id, 
                name, 
                description: $('#categoryDescription').val() 
            });
            
            saveData(STORAGE_KEYS.CATEGORIES, categories);
            updateCategoryDropdowns();
            loadAdminCategories();
            $('#categoryModal').hide();
            showToast('Kategori ditambahkan.', 'success');
        }
        
        function editCategory(id) {
            const c = categories.find(c => c.id === id);
            if (!c) return;
            
            $('#editCategoryId').val(c.id);
            $('#editCategoryName').val(c.name);
            $('#editCategoryDescription').val(c.description || '');
            $('#editCategoryModal').css('display', 'flex');
        }
        
        function updateCategory() {
            const id = $('#editCategoryId').val();
            const name = $('#editCategoryName').val().trim();
            
            if (!name) { 
                showToast('Nama kategori harus diisi.', 'error'); 
                return; 
            }
            
            const index = categories.findIndex(c => c.id === id);
            if (index >= 0) {
                categories[index] = {
                    ...categories[index],
                    name,
                    description: $('#editCategoryDescription').val()
                };
                
                saveData(STORAGE_KEYS.CATEGORIES, categories);
                updateCategoryDropdowns();
                loadAdminCategories();
                $('#editCategoryModal').hide();
                showToast('Kategori diperbarui.', 'success');
            }
        }
        
        function deleteCategory(id) {
            const productCount = products.filter(p => p.categoryId === id).length;
            
            if (productCount > 0) {
                showToast('Tidak bisa menghapus kategori yang memiliki produk.', 'error');
                return;
            }
            
            showConfirmation('Hapus kategori ini?', confirmed => {
                if (confirmed) {
                    categories = categories.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CATEGORIES, categories);
                    loadAdminCategories();
                    updateCategoryDropdowns();
                    showToast('Kategori dihapus.', 'success');
                }
            });
        }
        
        function loadAdminCustomers() {
            $('#adminCustomersTable').empty();
            
            customers.forEach(c => {
                $('#adminCustomersTable').append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>${c.phone}</td>
                        <td>${c.email || '-'}</td>
                        <td>${c.type === 'member' ? 'Member' : 'Biasa'}</td>
                        <td>
                            <button class="btn btn-info btn-sm edit-customer" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-customer" data-id="${c.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function saveCustomer() {
            const data = {
                id: 'CUST' + Date.now(),
                name: $('#customerNameModal').val().trim(),
                phone: $('#customerPhoneModal').val(),
                email: $('#customerEmailModal').val(),
                address: $('#customerAddressModal').val(),
                type: $('#customerTypeModal').val()
            };
            
            if (!data.name || !data.phone) { 
                showToast('Nama dan telepon harus diisi.', 'error'); 
                return; 
            }
            
            customers.push(data);
            saveData(STORAGE_KEYS.CUSTOMERS, customers);
            loadAdminCustomers();
            $('#customerModal').hide();
            showToast('Pelanggan ditambahkan.', 'success');
        }
        
        function editCustomer(id) {
            const c = customers.find(c => c.id === id);
            if (!c) return;
            
            $('#editCustomerId').val(c.id);
            $('#editCustomerType').val(c.type);
            $('#editCustomerName').val(c.name);
            $('#editCustomerPhone').val(c.phone);
            $('#editCustomerEmail').val(c.email || '');
            $('#editCustomerAddress').val(c.address || '');
            $('#editCustomerModal').css('display', 'flex');
        }
        
        function updateCustomer() {
            const id = $('#editCustomerId').val();
            const data = {
                type: $('#editCustomerType').val(),
                name: $('#editCustomerName').val().trim(),
                phone: $('#editCustomerPhone').val(),
                email: $('#editCustomerEmail').val(),
                address: $('#editCustomerAddress').val()
            };
            
            if (!data.name || !data.phone) { 
                showToast('Nama dan telepon harus diisi.', 'error'); 
                return; 
            }
            
            const index = customers.findIndex(c => c.id === id);
            if (index >= 0) {
                customers[index] = { ...customers[index], ...data };
                saveData(STORAGE_KEYS.CUSTOMERS, customers);
                loadAdminCustomers();
                $('#editCustomerModal').hide();
                showToast('Pelanggan diperbarui.', 'success');
            }
        }
        
        function deleteCustomer(id) {
            showConfirmation('Hapus pelanggan ini?', confirmed => {
                if (confirmed) {
                    customers = customers.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CUSTOMERS, customers);
                    loadAdminCustomers();
                    showToast('Pelanggan dihapus.', 'success');
                }
            });
        }
        
        function loadAdminTransactions() {
            $('#adminTransactionsTable').empty();
            
            transactions.forEach(t => {
                $('#adminTransactionsTable').append(`
                    <tr>
                        <td>${t.id}</td>
                        <td>${moment(t.date).format('DD/MM/YYYY HH:mm')}</td>
                        <td>${t.customer?.name || 'Walk-in'}</td>
                        <td>${formatCurrency(t.total)}</td>
                        <td>${t.cashier?.name || '-'}</td>
                        <td>
                            <button class="btn btn-info btn-sm view-transaction" data-id="${t.id}"><i class="fas fa-eye"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function loadAdminCashiers() {
            $('#adminCashiersTable').empty();
            
            cashiers.forEach(c => {
                $('#adminCashiersTable').append(`
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.name}</td>
                        <td>${c.pin}</td>
                        <td>
                            <span class="badge ${c.status === 'active' ? 'badge-success' : 'badge-danger'}">
                                ${c.status === 'active' ? 'Aktif' : 'Nonaktif'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-info btn-sm edit-cashier" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger btn-sm delete-cashier" data-id="${c.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `);
            });
        }
        
        function saveCashier() {
            const id = $('#cashierIdModal').val();
            const data = {
                name: $('#cashierNameModal').val().trim(),
                pin: $('#cashierPinModal').val(),
                status: $('#cashierStatusModal').val()
            };
            
            if (!data.name || !data.pin || data.pin.length !== 4) { 
                showToast('Nama dan PIN (4 digit) harus diisi.', 'error'); 
                return; 
            }
            
            if (id) {
                // Update existing cashier
                const index = cashiers.findIndex(c => c.id === id);
                if (index >= 0) {
                    cashiers[index] = { ...cashiers[index], ...data };
                }
            } else {
                // Add new cashier
                data.id = 'K' + (cashiers.length + 1).toString().padStart(3, '0');
                cashiers.push(data);
            }
            
            saveData(STORAGE_KEYS.CASHIERS, cashiers);
            loadAdminCashiers();
            $('#cashierModal').hide();
            showToast('Kasir disimpan.', 'success');
        }
        
        function editCashier(id) {
            const c = cashiers.find(c => c.id === id);
            if (!c) return;
            
            $('#cashierModalTitle').text('Edit Kasir');
            $('#cashierIdModal').val(c.id);
            $('#cashierNameModal').val(c.name);
            $('#cashierPinModal').val(c.pin);
            $('#cashierStatusModal').val(c.status);
            $('#cashierModal').css('display', 'flex');
        }
        
        function deleteCashier(id) {
            if (id === currentCashier?.id) {
                showToast('Tidak bisa menghapus kasir yang sedang login.', 'error');
                return;
            }
            
            showConfirmation('Hapus kasir ini?', confirmed => {
                if (confirmed) {
                    cashiers = cashiers.filter(c => c.id !== id);
                    saveData(STORAGE_KEYS.CASHIERS, cashiers);
                    loadAdminCashiers();
                    showToast('Kasir dihapus.', 'success');
                }
            });
        }
        
        // --- Reports ---
        function loadSalesReport(startDate, endDate) {
            const filtered = transactions.filter(t => {
                if (!startDate) return true;
                return moment(t.date).isBetween(startDate, endDate, null, '[]');
            });
            
            const totalRev = filtered.reduce((s, t) => s + t.total, 0);
            const totalProf = filtered.reduce((s, t) => s + t.profit, 0);
            
            $('#reportTotalRevenue').text(formatCurrency(totalRev));
            $('#reportTotalProfit').text(formatCurrency(totalProf));
            $('#reportTotalTransactions').text(filtered.length);
            
            // Find best selling product
            const productSales = {};
            filtered.forEach(t => {
                t.items.forEach(i => {
                    if (!productSales[i.productId]) {
                        productSales[i.productId] = { quantity: 0, revenue: 0 };
                    }
                    productSales[i.productId].quantity += i.quantity;
                    productSales[i.productId].revenue += (i.price * i.quantity);
                });
            });
            
            let bestSeller = '-';
            if (Object.keys(productSales).length > 0) {
                const sorted = Object.entries(productSales).sort((a, b) => b[1].quantity - a[1].quantity);
                const product = products.find(p => p.id === sorted[0][0]);
                if (product) {
                    bestSeller = `${product.name} (${sorted[0][1].quantity} terjual)`;
                }
            }
            $('#reportBestSeller').text(bestSeller);
            
            // Sales by day chart
            const salesByDay = {};
            filtered.forEach(t => {
                const day = moment(t.date).format('YYYY-MM-DD');
                if (!salesByDay[day]) salesByDay[day] = { revenue: 0, profit: 0 };
                salesByDay[day].revenue += t.total;
                salesByDay[day].profit += t.profit;
            });
            
            const labels = Object.keys(salesByDay).sort();
            
            if (salesChart) salesChart.destroy();
            salesChart = new Chart($('#salesChart'), {
                type: 'bar',
                data: {
                    labels: labels.map(l => moment(l).format('D MMM')),
                    datasets: [
                        { 
                            label: 'Pendapatan', 
                            data: labels.map(l => salesByDay[l].revenue), 
                            backgroundColor: 'rgba(67, 97, 238, 0.8)' 
                        },
                        { 
                            label: 'Laba', 
                            data: labels.map(l => salesByDay[l].profit), 
                            backgroundColor: 'rgba(139, 92, 246, 0.8)' 
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value).replace('Rp', '');
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    label += formatCurrency(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // --- Receipt Generator ---
        function generateReceipt(transaction) {
            const receipt = `
                <div class="receipt">
                    <div class="receipt-header">
                        <div class="receipt-title">${settings.storeName}</div>
                        <div class="receipt-address">${settings.storeAddress}</div>
                        <div class="receipt-address">Telp: ${settings.storePhone}</div>
                        <div class="receipt-date">${moment(transaction.date).format('DD/MM/YYYY HH:mm')}</div>
                        <div class="receipt-date">ID: ${transaction.id}</div>
                    </div>
                    <div class="receipt-items">
                        ${transaction.items.map(i => `
                            <div class="receipt-item">
                                <span>${i.name} (${i.quantity}x)</span>
                                <span>${formatCurrency(i.price * i.quantity)}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="receipt-total">
                        <div class="receipt-item"><span>Subtotal:</span><span>${formatCurrency(transaction.subtotal)}</span></div>
                        ${transaction.discount > 0 ? `
                            <div class="receipt-item"><span>Diskon:</span><span>-${formatCurrency(transaction.discount)}</span></div>
                        ` : ''}
                        <div class="receipt-item"><span>Pajak:</span><span>${formatCurrency(transaction.tax)}</span></div>
                        <div class="receipt-item"><span><strong>TOTAL:</strong></span><span><strong>${formatCurrency(transaction.total)}</strong></span></div>
                        <div class="receipt-item"><span>Dibayar (${transaction.paymentMethod}):</span><span>${formatCurrency(transaction.paymentAmount)}</span></div>
                        <div class="receipt-item"><span>Kembalian:</span><span>${formatCurrency(transaction.change)}</span></div>
                    </div>
                    <div class="receipt-footer">
                        ${settings.receiptFooter || 'Terima kasih atas kunjungan Anda!'}<br>
                        Kasir: ${transaction.cashier.name}
                    </div>
                </div>
            `;
            
            $('#receiptTemplate').html(receipt);
        }
        
        function viewTransactionDetail(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            const receipt = `
                <div class="receipt-header">
                    <div class="receipt-title">${settings.storeName}</div>
                    <div class="receipt-address">${settings.storeAddress}</div>
                    <div class="receipt-date">${moment(transaction.date).format('DD/MM/YYYY HH:mm')}</div>
                    <div class="receipt-date">ID: ${transaction.id}</div>
                </div>
                <div class="receipt-items">
                    ${transaction.items.map(i => `
                        <div class="receipt-item">
                            <span>${i.name} (${i.quantity}x)</span>
                            <span>${formatCurrency(i.price * i.quantity)}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="receipt-total">
                    <div class="receipt-item"><span>Subtotal:</span><span>${formatCurrency(transaction.subtotal)}</span></div>
                    ${transaction.discount > 0 ? `
                        <div class="receipt-item"><span>Diskon:</span><span>-${formatCurrency(transaction.discount)}</span></div>
                    ` : ''}
                    <div class="receipt-item"><span>Pajak:</span><span>${formatCurrency(transaction.tax)}</span></div>
                    <div class="receipt-item"><span><strong>TOTAL:</strong></span><span><strong>${formatCurrency(transaction.total)}</strong></span></div>
                    <div class="receipt-item"><span>Dibayar (${transaction.paymentMethod}):</span><span>${formatCurrency(transaction.paymentAmount)}</span></div>
                    <div class="receipt-item"><span>Kembalian:</span><span>${formatCurrency(transaction.change)}</span></div>
                </div>
                <div class="receipt-footer">
                    ${settings.receiptFooter || 'Terima kasih atas kunjungan Anda!'}<br>
                    Kasir: ${transaction.cashier.name}
                </div>
            `;
            
            $('#transactionDetailReceipt').html(receipt);
            $('#transactionDetailModal').css('display', 'flex');
        }
        
        // --- Import/Export ---
        function exportAllData() {
            const data = { 
                products, 
                categories, 
                customers, 
                cashiers, 
                transactions, 
                stockInRecords,
                settings: {
                    storeName: settings.storeName,
                    storeAddress: settings.storeAddress,
                    storePhone: settings.storePhone,
                    taxRate: settings.taxRate,
                    receiptFooter: settings.receiptFooter
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pos_backup_' + moment().format('YYYYMMDD') + '.json';
            a.click();
            
            showToast('Data berhasil diekspor', 'success');
        }
        
        function importData() {
            $('#importModal').css('display', 'flex');
        }
        
        function previewImportData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Pilih file terlebih dahulu', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const sheetName = workbook.SheetNames[0];
                        data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                    } else if (file.name.endsWith('.csv')) {
                        const csv = e.target.result;
                        data = XLSX.utils.sheet_to_json(XLSX.utils.csv_to_sheet(csv));
                    } else {
                        showToast('Format file tidak didukung', 'error');
                        return;
                    }
                    
                    const dataType = $('#importDataType').val();
                    const previewTable = $('#importPreviewTable');
                    previewTable.empty();
                    
                    if (data.length === 0) {
                        $('#importPreview').hide();
                        showToast('Tidak ada data yang ditemukan', 'warning');
                        return;
                    }
                    
                    // Show preview
                    $('#importPreview').show();
                    
                    // Create table header
                    const headers = Object.keys(data[0]);
                    const headerRow = $('<tr>');
                    headers.forEach(h => headerRow.append(`<th>${h}</th>`));
                    previewTable.append(headerRow);
                    
                    // Show first 5 rows
                    data.slice(0, 5).forEach(row => {
                        const rowEl = $('<tr>');
                        headers.forEach(h => rowEl.append(`<td>${row[h] || ''}</td>`));
                        previewTable.append(rowEl);
                    });
                    
                    if (data.length > 5) {
                        previewTable.append(`<tr><td colspan="${headers.length}" class="text-center">+ ${data.length - 5} baris lainnya</td></tr>`);
                    }
                    
                    // Store data for confirmation
                    $('#confirmImport').data('importData', data);
                    
                } catch (e) {
                    console.error(e);
                    showToast('Gagal memproses file', 'error');
                }
            };
            
            if (file.name.endsWith('.json')) {
                reader.readAsText(file);
            } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                reader.readAsBinaryString(file);
            } else if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                showToast('Format file tidak didukung', 'error');
            }
        }
        
        function confirmImport() {
            const dataType = $('#importDataType').val();
            const data = $('#confirmImport').data('importData');
            
            if (!data || data.length === 0) {
                showToast('Tidak ada data untuk diimpor', 'error');
                return;
            }
            
            try {
                let importedCount = 0;
                
                if (dataType === 'products') {
                    data.forEach(item => {
                        const existingIndex = products.findIndex(p => p.barcode === item.barcode);
                        
                        const productData = {
                            id: 'P' + Date.now() + Math.floor(Math.random() * 1000),
                            barcode: item.barcode || '',
                            name: item.name || item.nama || '',
                            categoryId: item.categoryId || 'C001',
                            brand: item.brand || item.merek || '',
                            unit: item.unit || item.satuan || 'pcs',
                            costPrice: parseFloat(item.costPrice) || parseFloat(item.modal) || 0,
                            price: parseFloat(item.price) || parseFloat(item.harga) || 0,
                            stock: parseInt(item.stock) || parseInt(item.stok) || 0,
                            minStock: parseInt(item.minStock) || parseInt(item.stok_minimal) || 5
                        };
                        
                        if (existingIndex >= 0) {
                            products[existingIndex] = productData;
                        } else {
                            products.push(productData);
                        }
                        
                        importedCount++;
                    });
                    
                    saveData(STORAGE_KEYS.PRODUCTS, products);
                    
                } else if (dataType === 'customers') {
                    data.forEach(item => {
                        const customerData = {
                            id: 'CUST' + Date.now() + Math.floor(Math.random() * 1000),
                            name: item.name || item.nama || '',
                            phone: item.phone || item.telepon || '',
                            email: item.email || '',
                            address: item.address || item.alamat || '',
                            type: item.type || item.tipe || 'walkin'
                        };
                        
                        customers.push(customerData);
                        importedCount++;
                    });
                    
                    saveData(STORAGE_KEYS.CUSTOMERS, customers);
                    
                } else if (dataType === 'categories') {
                    data.forEach(item => {
                        const categoryData = {
                            id: 'C' + Date.now() + Math.floor(Math.random() * 1000),
                            name: item.name || item.nama || '',
                            description: item.description || item.deskripsi || ''
                        };
                        
                        categories.push(categoryData);
                        importedCount++;
                    });
                    
                    saveData(STORAGE_KEYS.CATEGORIES, categories);
                }
                
                showToast(`Berhasil mengimpor ${importedCount} ${dataType}`, 'success');
                loadAdminData();
                $('#importModal').hide();
                
            } catch (e) {
                console.error(e);
                showToast('Gagal mengimpor data', 'error');
            }
        }
        
        function resetAllData() {
            showConfirmation('Reset semua data? Ini tidak bisa dibatalkan!', confirmed => {
                if (confirmed) {
                    localStorage.clear();
                    showToast('Semua data telah direset', 'success');
                    setTimeout(() => location.reload(), 1000);
                }
            });
        }
        
        // --- Event Handlers ---
        $(document).ready(function() {
            initializeDefaultData();
            
            if (!currentCashier) {
                $('#loginModal').css('display', 'flex');
                $('#mainApp').hide();
            } else {
                $('#loginModal').hide();
                $('#mainApp').show();
                $('#loggedInCashier').text(currentCashier.name);
                updateAllUI();
            }
            
            // Login
            $('#loginForm').submit(e => {
                e.preventDefault();
                const id = $('#cashierId').val();
                const pin = $('#cashierPin').val();
                const cashier = cashiers.find(c => c.id === id && c.pin === pin && c.status === 'active');
                
                if (cashier) {
                    currentCashier = cashier;
                    saveData(STORAGE_KEYS.CURRENT_CASHIER, currentCashier);
                    $('#loginModal').fadeOut(() => {
                        $('#mainApp').fadeIn();
                        $('#loggedInCashier').text(cashier.name);
                        updateAllUI();
                    });
                    showToast(`Halo, ${cashier.name}!`, 'success');
                } else {
                    showToast('ID atau PIN salah.', 'error');
                }
            });
            
            $('#logoutBtn').click(e => {
                e.preventDefault();
                showConfirmation('Logout?', confirmed => {
                    if (confirmed) {
                        currentCashier = null;
                        localStorage.removeItem(STORAGE_KEYS.CURRENT_CASHIER);
                        $('#mainApp').fadeOut(() => $('#loginModal').fadeIn());
                    }
                });
            });
            
            // Search & category
            $('#productSearch, #productCategory').on('input change', () => 
                loadProducts($('#productSearch').val(), $('#productCategory').val())
            );
            
            $('#adminProductSearch').on('input', () => {
                const term = $('#adminProductSearch').val();
                loadAdminProducts(term);
            });
            
            // Customer type change
            $('#customerType').change(function() {
                const type = $(this).val();
                if (type === 'member') {
                    $('#memberFields').show();
                    $('#customerFields').hide();
                } else {
                    $('#memberFields').hide();
                    $('#customerFields').show();
                }
            });
            
            // Add to cart
            $(document).on('click', '.add-to-cart', function() {
                const p = products.find(p => p.id === $(this).data('id'));
                const item = currentCart.items.find(i => i.productId === p.id);
                
                if (item) {
                    if (item.quantity < p.stock) item.quantity++;
                    else showToast('Stok tidak cukup.', 'error');
                } else {
                    currentCart.items.push({
                        productId: p.id, 
                        name: p.name, 
                        price: p.price, 
                        costPrice: p.costPrice, 
                        stock: p.stock,
                        brand: p.brand,
                        unit: p.unit,
                        quantity: 1
                    });
                }
                
                updateCart();
            });
            
            $(document).on('click', '.remove-from-cart', function() {
                currentCart.items = currentCart.items.filter(i => i.productId !== $(this).data('id'));
                updateCart();
            });
            
            $(document).on('change', '.cart-item-quantity', function() {
                const item = currentCart.items.find(i => i.productId === $(this).data('id'));
                const qty = parseInt($(this).val());
                
                if (qty > item.stock) {
                    showToast('Stok tidak cukup.', 'error');
                    $(this).val(item.quantity);
                } else {
                    item.quantity = qty;
                }
                
                updateCart();
            });
            
            // Hold & resume
            $('#holdSaleBtn, #quickHoldTransaction').click(holdSale);
            
            $(document).on('click', '.resume-sale', function() { 
                resumeSale($(this).data('index')); 
            });
            
            $(document).on('click', '.delete-held-sale', function() { 
                deleteHeldSale($(this).data('index')); 
            });
            
            // Tabs
            $('.tab').click(function() {
                $(this).addClass('active').siblings().removeClass('active');
                $('#' + $(this).data('tab') + 'Tab').addClass('active').siblings('.tab-content').removeClass('active');
            });
            
            $('.admin-tab').click(function() {
                $(this).addClass('active').siblings().removeClass('active');
                $('#' + $(this).data('tab') + 'Tab').addClass('active').siblings('.admin-tab-content').removeClass('active');
            });
            
            // Navigation
            $('#nextToCustomer').click(() => $('[data-tab="customer"]').click());
            $('#backToCart').click(() => $('[data-tab="cart"]').click());
            
            $('#nextToPayment').click(() => {
                const type = $('#customerType').val();
                if (type === 'member' && !$('#memberId').val()) {
                    showToast('Isi ID member.', 'warning'); 
                    return;
                }
                
                currentCart.customer = { 
                    type, 
                    name: $('#customerName').val() || 'Walk-in', 
                    phone: $('#customerPhone').val(),
                    email: $('#customerEmail').val()
                };
                
                updateCart();
                $('[data-tab="payment"]').click();
            });
            
            $('#backToCustomer').click(() => $('[data-tab="customer"]').click());
            
            // Complete payment
            $('#completePayment').click(() => {
                if (!currentShift || !currentShift.isActive) {
                    showToast('Mulai shift dulu.', 'error'); 
                    return;
                }
                
                const amt = parseFloat($('#paymentAmount').val()) || 0;
                if (amt < currentCart.total) {
                    showToast('Pembayaran kurang.', 'error'); 
                    return;
                }
                
                const transaction = {
                    id: 'T' + moment().format('YYYYMMDDHHmmss'),
                    date: new Date(),
                    ...currentCart,
                    paymentMethod: $('input[name="paymentMethod"]:checked').val(),
                    paymentAmount: amt,
                    change: amt - currentCart.total,
                    cashier: { id: currentCashier.id, name: currentCashier.name },
                    shiftId: currentShift.startTime
                };
                
                // Update product stocks
                transaction.items.forEach(item => {
                    const p = products.find(p => p.id === item.productId);
                    if (p) p.stock -= item.quantity;
                });
                
                transactions.unshift(transaction);
                saveData(STORAGE_KEYS.TRANSACTIONS, transactions);
                saveData(STORAGE_KEYS.PRODUCTS, products);
                
                generateReceipt(transaction);
                setTimeout(() => window.print(), 500);
                
                resetCart();
                updateAllUI();
                showToast('Transaksi berhasil!', 'success');
                $('[data-tab="cart"]').click();
            });
            
            // Admin access
            $('#adminAccess').click(() => $('#adminPasswordModal').css('display', 'flex'));
            
            $('.verify-admin-password').click(() => {
                if ($('#adminPassword').val() === ADMIN_PASSWORD) {
                    $('#adminPasswordModal').hide();
                    $('#adminModal').css('display', 'flex');
                    loadAdminData();
                    showToast('Berhasil masuk sebagai admin.', 'success');
                } else {
                    showToast('Password salah.', 'error');
                }
            });
            
            // Toggle password visibility
            $('#togglePassword').click(function() {
                const input = $('#adminPassword');
                const icon = $(this);
                
                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    input.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // Product management
            $('#addProduct').click(() => {
                $('#productModalTitle').text('Tambah Produk');
                $('#productModal input').val('');
                $('#productStock').prop('disabled', false);
                $('#productModal').css('display', 'flex');
            });
            
            $('#saveProductBtn').click(saveProduct);
            
            $(document).on('click', '.edit-product', function() { 
                editProduct($(this).data('id')); 
            });
            
            $(document).on('click', '.delete-product', function() { 
                deleteProduct($(this).data('id')); 
            });
            
            $(document).on('click', '.generate-codes', function() { 
                generateBarcode($(this).data('id')); 
            });
            
            // Category management
            $('#addCategory').click(() => {
                $('#categoryName, #categoryDescription').val('');
                $('#categoryModal').css('display', 'flex');
            });
            
            $('.save-category').click(saveCategory);
            
            $(document).on('click', '.edit-category', function() { 
                editCategory($(this).data('id')); 
            });
            
            $(document).on('click', '.delete-category', function() { 
                deleteCategory($(this).data('id')); 
            });
            
            $('.update-category').click(updateCategory);
            
            // Customer management
            $('#addCustomer').click(() => {
                $('#customerNameModal, #customerPhoneModal, #customerEmailModal, #customerAddressModal').val('');
                $('#customerTypeModal').val('walkin');
                $('#customerModal').css('display', 'flex');
            });
            
            $('.save-customer').click(saveCustomer);
            
            $(document).on('click', '.edit-customer', function() { 
                editCustomer($(this).data('id')); 
            });
            
            $(document).on('click', '.delete-customer', function() { 
                deleteCustomer($(this).data('id')); 
            });
            
            $('.update-customer').click(updateCustomer);
            
            // Cashier management
            $('#addCashier').click(() => {
                $('#cashierModalTitle').text('Tambah Kasir');
                $('#cashierIdModal').val('');
                $('#cashierNameModal, #cashierPinModal').val('');
                $('#cashierStatusModal').val('active');
                $('#cashierModal').css('display', 'flex');
            });
            
            $('.save-cashier').click(saveCashier);
            
            $(document).on('click', '.edit-cashier', function() { 
                editCashier($(this).data('id')); 
            });
            
            $(document).on('click', '.delete-cashier', function() { 
                deleteCashier($(this).data('id')); 
            });
            
            // Stock in management
            $('#addStockIn').click(addStockIn);
            
            $('#searchStockProductBtn').click(() => {
                const term = $('#stockInProductSearch').val().toLowerCase();
                const filtered = products.filter(p => 
                    p.name.toLowerCase().includes(term) || 
                    p.barcode.includes(term)
                );
                
                const table = $('#stockInItemsTable');
                table.empty();
                
                if (filtered.length === 0) {
                    table.html('<tr><td colspan="5" class="text-center">Produk tidak ditemukan</td></tr>');
                } else {
                    filtered.forEach(p => {
                        table.append(`
                            <tr>
                                <td>${p.name}</td>
                                <td><input type="number" class="form-control stock-in-qty" data-id="${p.id}" value="1" min="1"></td>
                                <td><input type="number" class="form-control stock-in-price" data-id="${p.id}" value="${p.costPrice}" min="0"></td>
                                <td class="stock-in-subtotal" data-id="${p.id}">${formatCurrency(p.costPrice)}</td>
                                <td><button class="btn btn-success btn-sm add-stock-in-item" data-id="${p.id}"><i class="fas fa-plus"></i></button></td>
                            </tr>
                        `);
                    });
                }
            });
            
            $(document).on('click', '.add-stock-in-item', function() {
                const productId = $(this).data('id');
                const product = products.find(p => p.id === productId);
                const qty = parseInt($(`.stock-in-qty[data-id="${productId}"]`).val()) || 0;
                const price = parseFloat($(`.stock-in-price[data-id="${productId}"]`).val()) || 0;
                
                if (qty <= 0 || price <= 0) {
                    showToast('Jumlah dan harga harus lebih dari 0', 'error');
                    return;
                }
                
                const existingIndex = currentStockInItems.findIndex(i => i.productId === productId);
                
                if (existingIndex >= 0) {
                    currentStockInItems[existingIndex].quantity = qty;
                    currentStockInItems[existingIndex].purchasePrice = price;
                } else {
                    currentStockInItems.push({
                        productId,
                        productName: product.name,
                        quantity: qty,
                        purchasePrice: price
                    });
                }
                
                updateStockInItemsTable();
            });
            
            function updateStockInItemsTable() {
                const table = $('#stockInItemsTable');
                table.empty();
                
                if (currentStockInItems.length === 0) {
                    table.html('<tr><td colspan="5" class="text-center">Tidak ada item</td></tr>');
                } else {
                    currentStockInItems.forEach(item => {
                        const subtotal = item.quantity * item.purchasePrice;
                        table.append(`
                            <tr>
                                <td>${item.productName}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.purchasePrice)}</td>
                                <td>${formatCurrency(subtotal)}</td>
                                <td><button class="btn btn-danger btn-sm remove-stock-in-item" data-id="${item.productId}"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        `);
                    });
                }
                
                const total = currentStockInItems.reduce((sum, i) => sum + (i.quantity * i.purchasePrice), 0);
                $('#stockInTotalCost').text(formatCurrency(total));
            }
            
            $(document).on('click', '.remove-stock-in-item', function() {
                const productId = $(this).data('id');
                currentStockInItems = currentStockInItems.filter(i => i.productId !== productId);
                updateStockInItemsTable();
            });
            
            $('#saveStockInBtn').click(saveStockIn);
            
            // View transaction detail
            $(document).on('click', '.view-transaction', function() {
                viewTransactionDetail($(this).data('id'));
            });
            
            // Print receipt
            $('.print-receipt').click(function() {
                window.print();
            });
            
            // Print barcode/QR code
            $('.print-codes').click(function() {
                const content = $('#codeGeneratorModal .modal-body').html();
                const printWindow = window.open('', '', 'width=600,height=600');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>Cetak Barcode</title>
                            <style>
                                body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
                                h4 { margin-bottom: 20px; }
                                .barcode-container, .qr-container { margin: 20px 0; }
                            </style>
                        </head>
                        <body>
                            ${content}
                            <script>
                                window.onload = function() {
                                    window.print();
                                    setTimeout(function() { window.close(); }, 500);
                                };
                            </script>
                        </body>
                    </html>
                `);
                printWindow.document.close();
            });
            
            // Date pickers
            $('#reportDateRange, #transactionDateRange').daterangepicker({
                opens: 'left',
                locale: { 
                    format: 'DD/MM/YYYY', 
                    applyLabel: 'Pilih', 
                    cancelLabel: 'Batal',
                    daysOfWeek: ['Mg', 'Sn', 'Sl', 'Rb', 'Km', 'Jm', 'Sb'],
                    monthNames: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember']
                }
            }).on('apply.daterangepicker', (e, p) => {
                loadSalesReport(p.startDate, p.endDate);
            });
            
            // Shift management
            $('#shiftAccess').click(manageShift);
            
            // Export reports
            $('#exportReportPDF').click(() => exportToPDF('reportsTab', 'laporan_penjualan.pdf'));
            $('#exportReportExcel').click(() => exportToExcel(transactions, 'transaksi.xlsx'));
            $('#exportReportCSV').click(() => exportToCSV(transactions, 'transaksi.csv'));
            
            // Data backup
            $('#exportData').click(exportAllData);
            $('#importData').click(importData);
            $('#resetData').click(resetAllData);
            
            // Import data
            $('#importFile').change(previewImportData);
            $('#importDataType').change(() => {
                if ($('#importPreview').is(':visible')) {
                    $('#importFile').trigger('change');
                }
            });
            
            $('#confirmImport').click(confirmImport);
            
            // Settings
            $('#saveSettings').click(() => {
                settings.storeName = $('#settingStoreName').val();
                settings.storeAddress = $('#settingStoreAddress').val();
                settings.storePhone = $('#settingStorePhone').val();
                settings.taxRate = parseInt($('#settingTaxRate').val()) || 10;
                settings.receiptFooter = $('#settingReceiptFooter').val();
                
                const newPass = $('#settingAdminPassword').val();
                if (newPass) window.ADMIN_PASSWORD = newPass;
                
                saveData(STORAGE_KEYS.SETTINGS, settings);
                updateAllUI();
                showToast('Pengaturan disimpan.', 'success');
            });
            
            // Quick actions
            $('#quickNewTransaction').click(() => {
                resetCart();
                $('[data-tab="cart"]').click();
            });
            
            $('#quickPrintReceipt').click(() => {
                if (transactions.length > 0) {
                    viewTransactionDetail(transactions[0].id);
                } else {
                    showToast('Tidak ada transaksi terakhir', 'warning');
                }
            });
            
            $('#quickStockCheck').click(() => {
                const lowStock = products.filter(p => p.stock <= p.minStock);
                if (lowStock.length > 0) {
                    let message = 'Produk stok rendah:\n';
                    lowStock.forEach(p => {
                        message += `- ${p.name}: ${p.stock} ${p.unit || ''}\n`;
                    });
                    alert(message);
                } else {
                    showToast('Tidak ada produk dengan stok rendah', 'info');
                }
            });
            
            // Close modals
            $('.modal-close, .close-admin-password-modal, .close-shift-modal, .close-product-modal, .close-category-modal, .close-customer-modal, .close-stock-in-modal, .close-code-generator-modal, .close-detail-modal, .close-import-modal').click(() => {
                $('.modal').hide();
            });
            
            $('.close-admin-modal, .close-edit-category-modal, .close-edit-customer-modal').click(() => {
                $(this).closest('.modal').hide();
            });
            
            // Theme toggle
            $('#themeToggle').click(() => {
                toggleDarkMode(!darkMode);
            });
            
            // Update time every minute
            setInterval(updateCurrentDate, 60000);
        });
    </script>
</body>
</html>
