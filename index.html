<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>POS ANEKAMARKET PRO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.css">
  <style>
    :root {
      --primary-color: #4361ee;
      --primary-light: #e6e9ff;
      --secondary-color: #3f37c9;
      --success-color: #06d6a0;
      --warning-color: #ffd166;
      --danger-color: #ef476f;
      --dark-color: #212529;
      --light-color: #f8f9fa;
      --gray-color: #6c757d;
      --rounded: 12px;
      --rounded-sm: 8px;
      --shadow: 0 4px 20px -1px rgba(0,0,0,0.1);
      --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
      --sidebar-width: 280px;
    }
    
    body { 
      background-color: #f4f6f9; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--dark-color);
    }
    
    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
    }
    
    .sidebar {
      width: var(--sidebar-width);
      background: white;
      box-shadow: var(--shadow);
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: transform 0.3s ease;
    }
    
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 20px;
      padding-top: 70px;
      transition: margin-left 0.3s ease;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: var(--sidebar-width);
      right: 0;
      height: 70px;
      background: white;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 90;
      transition: left 0.3s ease;
    }
    
    /* Sidebar Styles */
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .sidebar-brand {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    
    .sidebar-brand i {
      margin-right: 10px;
      font-size: 1.4rem;
    }
    
    .sidebar-menu {
      padding: 15px 0;
    }
    
    .menu-title {
      padding: 10px 20px;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: var(--gray-color);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: var(--dark-color);
      text-decoration: none;
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
    }
    
    .menu-item:hover, .menu-item.active {
      background: var(--primary-light);
      color: var(--primary-color);
      border-left-color: var(--primary-color);
    }
    
    .menu-item i {
      margin-right: 10px;
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }
    
    /* Card Styles */
    .card {
      border: none;
      border-radius: var(--rounded);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      background: white;
    }
    
    .card-header {
      background: white;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      padding: 15px 20px;
      border-radius: var(--rounded) var(--rounded) 0 0 !important;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-title {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    /* Button Styles */
    .btn {
      border-radius: var(--rounded-sm);
      padding: 8px 16px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .btn-primary {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
      background: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    
    .btn-success {
      background: var(--success-color);
      border-color: var(--success-color);
    }
    
    .btn-danger {
      background: var(--danger-color);
      border-color: var(--danger-color);
    }
    
    .btn-warning {
      background: var(--warning-color);
      border-color: var(--warning-color);
      color: var(--dark-color);
    }
    
    /* Form Styles */
    .form-control, .form-select {
      border-radius: var(--rounded-sm);
      padding: 10px 15px;
      border: 1px solid #e0e0e0;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    }
    
    /* Table Styles */
    .table {
      color: var(--dark-color);
    }
    
    .table th {
      font-weight: 600;
      background: #f8f9fa;
      border-bottom-width: 1px;
    }
    
    .table td, .table th {
      padding: 12px 15px;
      vertical-align: middle;
    }
    
    .table-hover tbody tr:hover {
      background-color: rgba(67, 97, 238, 0.05);
    }
    
    /* Badge Styles */
    .badge {
      padding: 5px 10px;
      font-weight: 500;
      border-radius: var(--rounded-sm);
    }
    
    .badge-primary {
      background: var(--primary-light);
      color: var(--primary-color);
    }
    
    .badge-success {
      background: rgba(6, 214, 160, 0.1);
      color: var(--success-color);
    }
    
    .badge-danger {
      background: rgba(239, 71, 111, 0.1);
      color: var(--danger-color);
    }
    
    /* Dashboard Stats */
    .stats-card {
      display: flex;
      align-items: center;
      padding: 20px;
      border-radius: var(--rounded);
      color: white;
      margin-bottom: 20px;
    }
    
    .stats-card i {
      font-size: 2rem;
      margin-right: 15px;
      opacity: 0.8;
    }
    
    .stats-card .stats-info h3 {
      font-size: 1.8rem;
      margin: 0;
      font-weight: 600;
    }
    
    .stats-card.sales {
      background: linear-gradient(135deg, #4361ee, #3f37c9);
    }
    
    .stats-card.products {
      background: linear-gradient(135deg, #06d6a0, #04a57a);
    }
    
    .stats-card.customers {
      background: linear-gradient(135deg, #ffd166, #f6aa1c);
    }
    
    .stats-card.transactions {
      background: linear-gradient(135deg, #ef476f, #d90429);
    }
    
    /* Login Styles */
    .login-container {
      max-width: 400px;
      margin: 10vh auto;
      padding: 30px;
      background: white;
      border-radius: var(--rounded);
      box-shadow: var(--shadow-md);
      text-align: center;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1050;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: #fff;
      border-radius: var(--rounded);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      background: var(--primary-color);
      color: white;
    }
    
    .modal-body {
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #eee;
      text-align: right;
    }
    
    /* Toast Styles */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      color: white;
      padding: 15px 20px;
      border-radius: var(--rounded-sm);
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease;
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
    }
    
    .toast.show {
      opacity: 1;
    }
    
    .toast i {
      margin-right: 10px;
    }
    
    .toast.success {
      background: var(--success-color);
    }
    
    .toast.error {
      background: var(--danger-color);
    }
    
    /* Cashier View */
    .cashier-view-container {
      display: flex;
      gap: 20px;
    }
    
    .cashier-left-panel {
      flex: 1 1 55%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .cashier-right-panel {
      flex: 1 1 45%;
      background: white;
      padding: 20px;
      border-radius: var(--rounded);
      box-shadow: var(--shadow);
      max-height: calc(100vh - 180px);
      display: flex;
      flex-direction: column;
    }
    
    .product-list-container {
      flex-grow: 1;
      overflow-y: auto;
      margin-top: 15px;
    }
    
    /* Product Grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .product-card {
      background: white;
      border-radius: var(--rounded-sm);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .product-image {
      height: 120px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .product-info {
      padding: 12px;
    }
    
    .product-name {
      font-weight: 500;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .product-price {
      font-weight: 600;
      color: var(--primary-color);
    }
    
    /* Responsive Styles */
    @media (max-width: 992px) {
      .cashier-view-container {
        flex-direction: column;
      }
      
      .cashier-right-panel {
        max-height: 400px;
      }
      
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content, .topbar {
        margin-left: 0;
      }
    }
    
    @media (max-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .stats-card {
        flex-direction: column;
        text-align: center;
      }
      
      .stats-card i {
        margin-right: 0;
        margin-bottom: 10px;
      }
    }
    
    /* Print Styles */
    @media print {
      body * {
        visibility: hidden;
      }
      
      #printable-receipt, #printable-receipt * {
        visibility: visible;
      }
      
      #printable-receipt {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: flex;">
    <div class="login-container">
      <div class="login-logo">
        <i class="fas fa-store-alt" style="font-size: 3rem; color: var(--primary-color);"></i>
        <h1 class="mb-4">POS ANEKAMARKET PRO</h1>
      </div>
      <form id="loginForm">
        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="loginCashierId" placeholder="ID Kasir" required>
          <label for="loginCashierId"><i class="fas fa-user me-2"></i>ID Kasir</label>
        </div>
        <div class="form-floating mb-3">
          <input type="password" class="form-control" id="loginCashierPin" placeholder="PIN" required maxlength="4">
          <label for="loginCashierPin"><i class="fas fa-lock me-2"></i>PIN</label>
        </div>
        <button type="submit" class="btn btn-primary w-100 py-2 mt-3">
          <i class="fas fa-sign-in-alt me-2"></i>Login
        </button>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="app-container" style="display: none;">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <i class="fas fa-store-alt"></i>
          <span id="sidebarStoreName">ANEKAMARKET PRO</span>
        </div>
        <button class="btn btn-sm btn-link sidebar-toggle d-none">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="sidebar-menu">
        <div class="menu-title">Menu Utama</div>
        <a href="#" class="menu-item active" data-tab="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="menu-item" data-tab="cashier">
          <i class="fas fa-cash-register"></i>
          <span>Kasir</span>
        </a>
        <a href="#" class="menu-item" data-tab="transactions">
          <i class="fas fa-receipt"></i>
          <span>Transaksi</span>
        </a>
        
        <div class="menu-title">Manajemen</div>
        <a href="#" class="menu-item" data-tab="products">
          <i class="fas fa-boxes"></i>
          <span>Produk</span>
        </a>
        <a href="#" class="menu-item" data-tab="categories">
          <i class="fas fa-tags"></i>
          <span>Kategori</span>
        </a>
        <a href="#" class="menu-item" data-tab="customers">
          <i class="fas fa-users"></i>
          <span>Pelanggan</span>
        </a>
        
        <div class="menu-title">Administrasi</div>
        <a href="#" class="menu-item" data-tab="cashiers">
          <i class="fas fa-user-tie"></i>
          <span>Kasir</span>
        </a>
        <a href="#" class="menu-item" data-tab="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Laporan</span>
        </a>
        <a href="#" class="menu-item" data-tab="settings">
          <i class="fas fa-cog"></i>
          <span>Pengaturan</span>
        </a>
      </div>
      
      <div class="sidebar-footer" style="padding: 20px; border-top: 1px solid rgba(0,0,0,0.05); margin-top: auto;">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <div class="fw-bold" id="sidebarCashierName">Admin</div>
            <small class="text-muted" id="sidebarCashierRole">Administrator</small>
          </div>
          <button class="btn btn-sm btn-link text-danger" id="sidebarLogoutBtn">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Topbar -->
      <div class="topbar">
        <button class="btn btn-sm btn-link sidebar-toggle d-none">
          <i class="fas fa-bars"></i>
        </button>
        <div class="flex-grow-1"></div>
        <div class="dropdown">
          <button class="btn btn-link dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
            <i class="fas fa-user-circle me-2"></i>
            <span id="topbarCashierName">Admin</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item text-danger" href="#" id="topbarLogoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
          </ul>
        </div>
      </div>
      
      <!-- Tab Contents -->
      <div class="tab-content active" id="dashboardTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Dashboard</h3>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-secondary" id="todayBtn">Hari Ini</button>
            <button class="btn btn-sm btn-outline-secondary" id="weekBtn">Minggu Ini</button>
            <button class="btn btn-sm btn-outline-secondary" id="monthBtn">Bulan Ini</button>
          </div>
        </div>
        
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="stats-card sales">
              <i class="fas fa-shopping-cart"></i>
              <div class="stats-info">
                <p>Total Penjualan</p>
                <h3 id="totalSales">Rp0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card products">
              <i class="fas fa-box-open"></i>
              <div class="stats-info">
                <p>Total Produk</p>
                <h3 id="totalProducts">0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card customers">
              <i class="fas fa-users"></i>
              <div class="stats-info">
                <p>Pelanggan</p>
                <h3 id="totalCustomers">0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stats-card transactions">
              <i class="fas fa-receipt"></i>
              <div class="stats-info">
                <p>Transaksi</p>
                <h3 id="totalTransactions">0</h3>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-lg-8">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title">Grafik Penjualan</h5>
              </div>
              <div class="card-body">
                <canvas id="salesChart" height="300"></canvas>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title">Produk Terlaris</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Produk</th>
                        <th>Terjual</th>
                      </tr>
                    </thead>
                    <tbody id="topProductsTable">
                      <tr><td colspan="2" class="text-center">Memuat data...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Cashier Tab -->
      <div class="tab-content" id="cashierTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Kasir</h3>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-primary" id="newTransactionBtn">
              <i class="fas fa-plus me-1"></i> Transaksi Baru
            </button>
            <button class="btn btn-sm btn-outline-secondary" id="holdTransactionBtn" disabled>
              <i class="fas fa-pause me-1"></i> Tahan
            </button>
            <button class="btn btn-sm btn-outline-secondary" id="recallTransactionBtn">
              <i class="fas fa-history me-1"></i> Panggil
            </button>
          </div>
        </div>
        
        <div class="cashier-view-container">
          <div class="cashier-left-panel">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-shopping-cart me-2"></i>Keranjang</h5>
                <div class="badge bg-primary-light text-primary" id="cartItemCount">0 item</div>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive" style="min-height: 200px; max-height: 400px; overflow-y: auto;">
                  <table class="table align-middle mb-0">
                    <thead>
                      <tr>
                        <th>Produk</th>
                        <th width="100">Qty</th>
                        <th>Subtotal</th>
                        <th width="40"></th>
                      </tr>
                    </thead>
                    <tbody id="cartItems">
                      <tr><td colspan="4" class="text-center py-5" id="cartEmptyState">Keranjang Kosong</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-money-bill-wave me-2"></i>Pembayaran</h5>
              </div>
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="input-group mb-3">
                      <span class="input-group-text">Customer</span>
                      <select class="form-select" id="customerSelect">
                        <option value="">Umum</option>
                      </select>
                      <button class="btn btn-outline-secondary" type="button" id="addCustomerBtn">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="input-group mb-3">
                      <span class="input-group-text">Metode</span>
                      <select class="form-select" id="paymentMethod">
                        <option value="cash">Tunai</option>
                        <option value="debit">Debit</option>
                        <option value="credit">Kredit</option>
                        <option value="transfer">Transfer</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Diskon</span>
                      <input type="number" class="form-control" id="discountAmount" placeholder="0" min="0">
                      <select class="form-select" id="discountType" style="max-width: 80px;">
                        <option value="percent">%</option>
                        <option value="amount">Rp</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="input-group">
                      <span class="input-group-text">Pajak</span>
                      <input type="number" class="form-control" id="taxAmount" placeholder="0" min="0" value="0">
                      <span class="input-group-text">%</span>
                    </div>
                  </div>
                </div>
                
                <div class="row mb-3">
                  <div class="col-md-7">
                    <div class="input-group">
                      <span class="input-group-text">Bayar</span>
                      <input type="number" class="form-control" id="paymentAmount" placeholder="Jumlah Bayar" min="0">
                    </div>
                  </div>
                  <div class="col-md-5">
                    <div class="d-flex flex-column">
                      <div class="d-flex justify-content-between">
                        <span>Total:</span>
                        <strong id="cartTotal">Rp0</strong>
                      </div>
                      <div class="d-flex justify-content-between">
                        <span>Kembalian:</span>
                        <strong id="changeAmount" class="text-success">Rp0</strong>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="d-grid gap-2">
                  <button class="btn btn-success btn-lg" id="checkoutBtn">
                    <i class="fas fa-check-circle me-2"></i>Checkout
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="cashier-right-panel">
            <div class="input-group mb-3">
              <input type="text" id="productSearchCart" class="form-control" placeholder="Cari produk...">
              <button class="btn btn-outline-secondary" type="button" id="barcodeScanBtn">
                <i class="fas fa-barcode"></i>
              </button>
            </div>
            
            <div class="tabs mb-3">
              <div class="tab active" data-category="all">Semua</div>
              <div class="tab" data-category="favorites">Favorit</div>
              <!-- Categories will be injected here -->
            </div>
            
            <div class="product-list-container">
              <div class="product-grid" id="productGridForCart">
                <!-- Products will be injected here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Transactions Tab -->
      <div class="tab-content" id="transactionsTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Daftar Transaksi</h3>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-secondary" id="filterTransactionsBtn">
              <i class="fas fa-filter me-1"></i> Filter
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Tanggal</th>
                    <th>Pelanggan</th>
                    <th>Items</th>
                    <th>Total</th>
                    <th>Metode</th>
                    <th>Kasir</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="transactionsTable">
                  <tr><td colspan="8" class="text-center py-5">Memuat data transaksi...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Products Tab -->
      <div class="tab-content" id="productsTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Manajemen Produk</h3>
          <button class="btn btn-sm btn-primary" id="addProductBtn">
            <i class="fas fa-plus me-1"></i> Tambah Produk
          </button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="input-group">
              <input type="text" class="form-control" id="productSearch" placeholder="Cari produk...">
              <button class="btn btn-outline-secondary" type="button">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th width="50">#</th>
                    <th>Nama</th>
                    <th>Kategori</th>
                    <th>Harga</th>
                    <th>Stok</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="adminProductsTable">
                  <tr><td colspan="7" class="text-center py-5">Memuat data produk...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Categories Tab -->
      <div class="tab-content" id="categoriesTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Manajemen Kategori</h3>
          <button class="btn btn-sm btn-primary" id="addCategoryBtn">
            <i class="fas fa-plus me-1"></i> Tambah Kategori
          </button>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Jumlah Produk</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="adminCategoriesTable">
                  <tr><td colspan="4" class="text-center py-5">Memuat data kategori...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Customers Tab -->
      <div class="tab-content" id="customersTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Manajemen Pelanggan</h3>
          <button class="btn btn-sm btn-primary" id="addCustomerBtn2">
            <i class="fas fa-plus me-1"></i> Tambah Pelanggan
          </button>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Telepon</th>
                    <th>Email</th>
                    <th>Total Belanja</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="adminCustomersTable">
                  <tr><td colspan="5" class="text-center py-5">Memuat data pelanggan...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Cashiers Tab -->
      <div class="tab-content" id="cashiersTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Manajemen Kasir</h3>
          <button class="btn btn-sm btn-primary" id="addCashierBtn">
            <i class="fas fa-plus me-1"></i> Tambah Kasir
          </button>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nama</th>
                    <th>Peran</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="adminCashiersTable">
                  <tr><td colspan="5" class="text-center py-5">Memuat data kasir...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Reports Tab -->
      <div class="tab-content" id="reportsTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Laporan</h3>
          <button class="btn btn-sm btn-primary" id="generateReportBtn">
            <i class="fas fa-file-export me-1"></i> Generate
          </button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="row">
              <div class="col-md-4">
                <select class="form-select" id="reportType">
                  <option value="sales">Laporan Penjualan</option>
                  <option value="products">Laporan Produk</option>
                  <option value="transactions">Laporan Transaksi</option>
                </select>
              </div>
              <div class="col-md-4">
                <input type="text" class="form-control" id="reportDateRange" placeholder="Pilih rentang tanggal">
              </div>
              <div class="col-md-4">
                <button class="btn btn-primary w-100" id="applyReportFilterBtn">
                  <i class="fas fa-filter me-1"></i> Filter
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div id="reportContainer">
              <div class="text-center py-5">
                <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                <p>Pilih parameter laporan dan klik "Generate" untuk melihat data</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Tab -->
      <div class="tab-content" id="settingsTab">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="mb-0">Pengaturan Toko</h3>
          <button class="btn btn-sm btn-primary" id="saveSettingsBtn">
            <i class="fas fa-save me-1"></i> Simpan
          </button>
        </div>
        
        <div class="card">
          <div class="card-body">
            <form id="storeSettingsForm">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Nama Toko</label>
                  <input type="text" class="form-control" id="settingStoreName" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Alamat Toko</label>
                  <input type="text" class="form-control" id="settingStoreAddress">
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Telepon</label>
                  <input type="text" class="form-control" id="settingStorePhone">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" id="settingStoreEmail">
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Default Pajak (%)</label>
                <input type="number" class="form-control" id="settingDefaultTax" min="0" max="100" step="0.1">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="itemModalTitle"></h5>
        <button type="button" class="btn-close close-modal"></button>
      </div>
      <div class="modal-body">
        <form id="itemForm"></form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close-modal">Batal</button>
        <button type="submit" class="btn btn-success" form="itemForm">Simpan</button>
      </div>
    </div>
  </div>
  
  <div id="transactionDetailModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header no-print">
        <h3 class="modal-title">Detail Transaksi</h3>
        <button type="button" class="btn-close close-modal"></button>
      </div>
      <div class="modal-body" id="printable-receipt"></div>
      <div class="modal-footer no-print">
        <button class="btn btn-secondary me-2" onclick="window.print()">
          <i class="fas fa-print me-1"></i> Cetak
        </button>
      </div>
    </div>
  </div>
  
  <div id="confirmationDialog" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-body">
        <div class="text-center mb-4">
          <i class="fas fa-exclamation-circle fa-3x text-warning mb-3"></i>
          <p id="confirmationMessage" class="mb-0"></p>
        </div>
        <div class="d-flex justify-content-center gap-2">
          <button class="btn btn-secondary" id="confirmCancel">Batal</button>
          <button class="btn btn-danger" id="confirmOk">Ya</button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="holdTransactionModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h5 class="modal-title">Transaksi Ditahan</h5>
        <button type="button" class="btn-close close-modal"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Tanggal</th>
                <th>Items</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="heldTransactionsTable">
              <tr><td colspan="4" class="text-center py-3">Tidak ada transaksi ditahan</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close-modal">Tutup</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage"></span>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // State Management
    const STORAGE_KEYS = {
      PRODUCTS: 'pos_pro_products',
      CATEGORIES: 'pos_pro_categories',
      CASHIERS: 'pos_pro_cashiers',
      CUSTOMERS: 'pos_pro_customers',
      SETTINGS: 'pos_pro_settings',
      TRANSACTIONS: 'pos_pro_transactions',
      HELD_TRANSACTIONS: 'pos_pro_held_transactions',
      CURRENT_CASHIER: 'pos_pro_current_cashier'
    };

    let appState = {};
    let currentCart = { 
      items: [],
      customer: null,
      paymentMethod: 'cash',
      discount: { amount: 0, type: 'percent' },
      tax: 0,
      date: new Date()
    };
    
    let currentCashier = null;
    let salesChart = null;

    // Initialize the application
    const initApp = () => {
      loadState();
      initializeDefaultData();
      setupEventListeners();
      
      const savedCashier = localStorage.getItem(STORAGE_KEYS.CURRENT_CASHIER);
      if (savedCashier) {
        currentCashier = JSON.parse(savedCashier);
        initUI();
      } else {
        $('#loginModal').style.display = 'flex';
      }
    };

    // Load state from localStorage
    const loadState = () => {
      for (const key in STORAGE_KEYS) {
        const stateKey = key.toLowerCase();
        appState[stateKey] = JSON.parse(localStorage.getItem(STORAGE_KEYS[key])) || [];
      }
      
      if (!appState.settings || Array.isArray(appState.settings)) {
        appState.settings = { 
          storeName: 'ANEKAMARKET PRO',
          storeAddress: '',
          storePhone: '',
          storeEmail: '',
          defaultTax: 0
        };
      }
    };

    // Save state to localStorage
    const saveState = (key) => {
      localStorage.setItem(STORAGE_KEYS[key.toUpperCase()], JSON.stringify(appState[key]));
    };

    // Initialize default data if empty
    const initializeDefaultData = () => {
      if (appState.cashiers.length === 0) {
        appState.cashiers = [
          { id: 'admin', name: 'Administrator', pin: '1234', role: 'admin', active: true },
          { id: 'kasir01', name: 'Kasir 1', pin: '1111', role: 'cashier', active: true }
        ];
        saveState('cashiers');
      }
      
      if (appState.categories.length === 0) {
        appState.categories = [
          { id: `cat-${Date.now()}`, name: 'Umum', active: true }
        ];
        saveState('categories');
      }
      
      if (appState.products.length === 0) {
        appState.products = [
          { 
            id: `prod-${Date.now()}`, 
            name: 'Contoh Produk', 
            categoryId: appState.categories[0].id,
            price: 10000,
            stock: 10,
            active: true
          }
        ];
        saveState('products');
      }
      
      if (appState.customers.length === 0) {
        appState.customers = [
          {
            id: `cust-${Date.now()}`,
            name: 'Pelanggan Umum',
            phone: '',
            email: '',
            address: '',
            active: true
          }
        ];
        saveState('customers');
      }
    };

    // UI Helpers
    const $ = (selector) => document.querySelector(selector);
    const $$ = (selector) => document.querySelectorAll(selector);
    
    const render = (element, html) => {
      element.innerHTML = html;
    };
    
    const formatCurrency = (amount) => {
      return new Intl.NumberFormat('id-ID', { 
        style: 'currency', 
        currency: 'IDR', 
        minimumFractionDigits: 0 
      }).format(amount || 0);
    };
    
    const formatDate = (date) => {
      return new Date(date).toLocaleDateString('id-ID', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    };
    
    const showToast = (message, type = 'success', duration = 3000) => {
      const toast = $('#toast');
      const toastIcon = toast.querySelector('i');
      const toastMessage = $('#toastMessage');
      
      toastIcon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-times-circle';
      toastMessage.textContent = message;
      toast.className = `toast show ${type}`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    };
    
    const showConfirmation = (message, onConfirm) => {
      $('#confirmationMessage').textContent = message;
      $('#confirmationDialog').style.display = 'flex';
      
      $('#confirmOk').onclick = () => {
        onConfirm();
        $('#confirmationDialog').style.display = 'none';
      };
      
      $('#confirmCancel').onclick = () => {
        $('#confirmationDialog').style.display = 'none';
      };
    };
    
    const openModal = (type, id = null) => {
      const modal = $('#itemModal');
      const title = $('#itemModalTitle');
      const form = $('#itemForm');
      let item = {};
      let formHtml = '';
      
      const actionText = id ? 'Edit' : 'Tambah';
      
      switch (type) {
        case 'products':
          title.textContent = `${actionText} Produk`;
          const categoriesOptions = appState.categories
            .filter(c => c.active)
            .map(c => `<option value="${c.id}">${c.name}</option>`)
            .join('');
            
          formHtml = `
            <input type="hidden" name="id" value="${item.id || ''}">
            <div class="mb-3">
              <label class="form-label">Nama Produk</label>
              <input type="text" class="form-control" name="name" value="${item.name || ''}" required>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Kategori</label>
                <select class="form-select" name="categoryId" required>
                  <option value="">Pilih Kategori</option>
                  ${categoriesOptions}
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Harga</label>
                <input type="number" class="form-control" name="price" value="${item.price || 0}" min="0" required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Stok</label>
              <input type="number" class="form-control" name="stock" value="${item.stock || 0}" min="0" required>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" name="active" id="productActive" ${item.active !== false ? 'checked' : ''}>
              <label class="form-check-label" for="productActive">Aktif</label>
            </div>
          `;
          break;
          
        case 'categories':
          title.textContent = `${actionText} Kategori`;
          formHtml = `
            <input type="hidden" name="id" value="${item.id || ''}">
            <div class="mb-3">
              <label class="form-label">Nama Kategori</label>
              <input type="text" class="form-control" name="name" value="${item.name || ''}" required>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" name="active" id="categoryActive" ${item.active !== false ? 'checked' : ''}>
              <label class="form-check-label" for="categoryActive">Aktif</label>
            </div>
          `;
          break;
          
        case 'cashiers':
          title.textContent = `${actionText} Kasir`;
          formHtml = `
            <input type="hidden" name="id" value="${item.id || ''}">
            <div class="mb-3">
              <label class="form-label">ID Kasir</label>
              <input type="text" class="form-control" name="id_new" value="${item.id || ''}" required ${id ? 'disabled' : ''}>
            </div>
            <div class="mb-3">
              <label class="form-label">Nama Lengkap</label>
              <input type="text" class="form-control" name="name" value="${item.name || ''}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">PIN</label>
              <input type="password" class="form-control" name="pin" placeholder="${id ? 'Kosongkan jika tidak ingin diubah' : ''}" ${id ? '' : 'required'}>
            </div>
            <div class="mb-3">
              <label class="form-label">Peran</label>
              <select class="form-select" name="role" required>
                <option value="cashier">Kasir</option>
                <option value="admin">Administrator</option>
              </select>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" name="active" id="cashierActive" ${item.active !== false ? 'checked' : ''}>
              <label class="form-check-label" for="cashierActive">Aktif</label>
            </div>
          `;
          break;
          
        case 'customers':
          title.textContent = `${actionText} Pelanggan`;
          formHtml = `
            <input type="hidden" name="id" value="${item.id || ''}">
            <div class="mb-3">
              <label class="form-label">Nama Pelanggan</label>
              <input type="text" class="form-control" name="name" value="${item.name || ''}" required>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Telepon</label>
                <input type="text" class="form-control" name="phone" value="${item.phone || ''}">
              </div>
              <div class="col-md-6">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" value="${item.email || ''}">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Alamat</label>
              <textarea class="form-control" name="address" rows="2">${item.address || ''}</textarea>
            </div>
          `;
          break;
      }
      
      if (id) {
        item = appState[type].find(i => i.id === id);
        if (item) {
          const formElements = form.elements;
          for (let element of formElements) {
            if (element.name && item[element.name] !== undefined) {
              if (element.type === 'checkbox') {
                element.checked = item[element.name];
              } else {
                element.value = item[element.name];
              }
            }
          }
        }
      } else {
        form.reset();
      }
      
      form.innerHTML = formHtml;
      form.dataset.type = type;
      modal.style.display = 'flex';
      
      const firstInput = form.querySelector('input, select, textarea');
      if (firstInput) firstInput.focus();
    };
    
    // Render functions
    const renderDashboard = () => {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const todayTransactions = appState.transactions.filter(t => {
        const transDate = new Date(t.date);
        return transDate >= today;
      });
      
      const totalSales = todayTransactions.reduce((sum, t) => sum + t.total, 0);
      const totalProducts = appState.products.filter(p => p.active).length;
      const totalCustomers = appState.customers.filter(c => c.active).length;
      const totalTransactions = todayTransactions.length;
      
      $('#totalSales').textContent = formatCurrency(totalSales);
      $('#totalProducts').textContent = totalProducts;
      $('#totalCustomers').textContent = totalCustomers;
      $('#totalTransactions').textContent = totalTransactions;
      
      renderSalesChart();
      renderTopProducts();
    };
    
    const renderSalesChart = () => {
      const ctx = $('#salesChart');
      
      if (salesChart) {
        salesChart.destroy();
      }
      
      let labels = [];
      let data = [];
      
      // Last 7 days
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('id-ID', { weekday: 'short', day: 'numeric' }));
        
        const dayStart = new Date(date);
        dayStart.setHours(0, 0, 0, 0);
        const dayEnd = new Date(date);
        dayEnd.setHours(23, 59, 59, 999);
        
        const dayTransactions = appState.transactions.filter(t => {
          const transDate = new Date(t.date);
          return transDate >= dayStart && transDate <= dayEnd;
        });
        
        data.push(dayTransactions.reduce((sum, t) => sum + t.total, 0));
      }
      
      salesChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Penjualan',
            data: data,
            backgroundColor: 'rgba(67, 97, 238, 0.7)',
            borderColor: 'rgba(67, 97, 238, 1)',
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatCurrency(context.raw);
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              }
            }
          }
        }
      });
    };
    
    const renderTopProducts = () => {
      const productSales = {};
      
      appState.transactions.forEach(transaction => {
        transaction.items.forEach(item => {
          productSales[item.id] = (productSales[item.id] || 0) + item.quantity;
        });
      });
      
      const sortedProducts = Object.entries(productSales)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      const tbody = $('#topProductsTable');
      
      if (sortedProducts.length === 0) {
        render(tbody, '<tr><td colspan="2" class="text-center">Tidak ada data penjualan</td></tr>');
        return;
      }
      
      render(tbody, sortedProducts.map(([productId, quantity]) => {
        const product = appState.products.find(p => p.id === productId);
        return `
          <tr>
            <td>${product ? product.name : 'Produk tidak ditemukan'}</td>
            <td>${quantity}</td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderCashierView = () => {
      renderProductGrid();
      renderCart();
      renderCustomerSelect();
    };
    
    const renderProductGrid = () => {
      const search = $('#productSearchCart').value.toLowerCase();
      const activeCategory = $('.cashier-right-panel .tab.active')?.dataset.category || 'all';
      
      let filteredProducts = appState.products.filter(p => 
        p.active && 
        p.name.toLowerCase().includes(search)
      );
      
      if (activeCategory !== 'all' && activeCategory !== 'favorites') {
        filteredProducts = filteredProducts.filter(p => p.categoryId === activeCategory);
      }
      
      const grid = $('#productGridForCart');
      
      if (filteredProducts.length === 0) {
        grid.innerHTML = '<div class="text-center py-5">Tidak ada produk ditemukan</div>';
        return;
      }
      
      render(grid, filteredProducts.map(p => {
        const category = appState.categories.find(c => c.id === p.categoryId) || { name: 'Umum' };
        
        return `
          <div class="product-card" data-id="${p.id}">
            <div class="product-image">
              <i class="fas fa-box-open fa-3x text-muted"></i>
            </div>
            <div class="product-info">
              <div class="product-name">${p.name}</div>
              <div class="product-price">${formatCurrency(p.price)}</div>
              <div class="product-stock">Stok: ${p.stock} | ${category.name}</div>
            </div>
          </div>
        `;
      }).join(''));
      
      const categoryTabsContainer = $('.cashier-right-panel .tabs');
      const categories = appState.categories.filter(c => c.active);
      
      render(categoryTabsContainer, `
        <div class="tab active" data-category="all">Semua</div>
        <div class="tab" data-category="favorites">Favorit</div>
        ${categories.map(c => `<div class="tab" data-category="${c.id}">${c.name}</div>`).join('')}
      `);
    };
    
    const renderCart = () => {
      const cartBody = $('#cartItems');
      const cartEmptyState = $('#cartEmptyState');
      
      if (currentCart.items.length === 0) {
        cartEmptyState.style.display = 'table-cell';
        render(cartBody, '');
      } else {
        cartEmptyState.style.display = 'none';
        render(cartBody, currentCart.items.map((item, index) => {
          const product = appState.products.find(p => p.id === item.id) || {};
          return `
            <tr>
              <td>
                <div class="fw-bold">${item.name}</div>
                <small class="text-muted">${formatCurrency(item.price)}</small>
              </td>
              <td>
                <input type="number" class="form-control form-control-sm cart-item-qty" 
                  value="${item.quantity}" min="1" max="${product.stock || 99}" 
                  data-index="${index}">
              </td>
              <td>${formatCurrency(item.price * item.quantity)}</td>
              <td class="text-center">
                <button class="btn btn-sm btn-danger remove-from-cart-btn" data-index="${index}">
                  <i class="fas fa-times"></i>
                </button>
              </td>
            </tr>
          `;
        }).join(''));
      }
      
      updateCartSummary();
    };
    
    const updateCartSummary = () => {
      const subtotal = currentCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      let discount = 0;
      
      if (currentCart.discount.amount > 0) {
        if (currentCart.discount.type === 'percent') {
          discount = subtotal * (currentCart.discount.amount / 100);
        } else {
          discount = Math.min(currentCart.discount.amount, subtotal);
        }
      }
      
      let tax = (subtotal - discount) * (currentCart.tax / 100);
      let total = subtotal - discount + tax;
      
      total = Math.max(0, total);
      
      $('#cartTotal').textContent = formatCurrency(total);
      $('#cartItemCount').textContent = `${currentCart.items.reduce((sum, item) => sum + item.quantity, 0)} item`;
      
      updateChange();
      
      currentCart.subtotal = subtotal;
      currentCart.discountAmount = discount;
      currentCart.taxAmount = tax;
      currentCart.total = total;
    };
    
    const updateChange = () => {
      const payment = parseFloat($('#paymentAmount').value) || 0;
      const change = payment - (currentCart.total || 0);
      $('#changeAmount').textContent = formatCurrency(change > 0 ? change : 0);
    };
    
    const renderCustomerSelect = () => {
      const select = $('#customerSelect');
      const customers = appState.customers.filter(c => c.active);
      
      render(select, `
        <option value="">Umum</option>
        ${customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
      `);
      
      if (currentCart.customer) {
        select.value = currentCart.customer.id;
      }
    };
    
    const renderTransactions = () => {
      const tbody = $('#transactionsTable');
      const transactions = appState.transactions.slice().reverse();
      
      if (transactions.length === 0) {
        render(tbody, '<tr><td colspan="8" class="text-center py-5">Tidak ada data transaksi</td></tr>');
        return;
      }
      
      render(tbody, transactions.map(t => {
        const customer = appState.customers.find(c => c.id === t.customer) || { name: 'Umum' };
        const cashier = appState.cashiers.find(c => c.id === t.cashierId) || { name: 'Unknown' };
        
        return `
          <tr>
            <td>${t.id}</td>
            <td>${formatDate(t.date)}</td>
            <td>${customer.name}</td>
            <td>${t.items.reduce((sum, item) => sum + item.quantity, 0)}</td>
            <td>${formatCurrency(t.total)}</td>
            <td>${t.paymentMethod === 'cash' ? 'Tunai' : 
                  t.paymentMethod === 'debit' ? 'Debit' : 
                  t.paymentMethod === 'credit' ? 'Kredit' : 'Transfer'}</td>
            <td>${cashier.name}</td>
            <td>
              <button class="btn btn-sm btn-primary view-transaction-btn" data-id="${t.id}">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderTransactionDetail = (transactionId) => {
      const transaction = appState.transactions.find(t => t.id === transactionId);
      if (!transaction) return;
      
      const customer = appState.customers.find(c => c.id === transaction.customer) || { name: 'Umum' };
      const cashier = appState.cashiers.find(c => c.id === transaction.cashierId) || { name: 'Unknown' };
      
      const receiptContent = `
        <div class="text-center mb-3">
          <h4>${appState.settings.storeName}</h4>
          <p class="mb-1">${appState.settings.storeAddress}</p>
          <p class="mb-1">${appState.settings.storePhone}</p>
        </div>
        
        <div class="mb-3">
          <div class="d-flex justify-content-between">
            <span>No: ${transaction.id}</span>
            <span>${formatDate(transaction.date)}</span>
          </div>
          <div>Kasir: ${cashier.name}</div>
          <div>Pelanggan: ${customer.name}</div>
        </div>
        
        <table class="table mb-3">
          <thead>
            <tr>
              <th>Item</th>
              <th class="text-end">Qty</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            ${transaction.items.map(item => `
              <tr>
                <td>${item.name}<br><small>${formatCurrency(item.price)}</small></td>
                <td class="text-end">${item.quantity}</td>
                <td class="text-end">${formatCurrency(item.price * item.quantity)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        
        <table class="table mb-3">
          <tbody>
            <tr>
              <td>Subtotal</td>
              <td class="text-end">${formatCurrency(transaction.subtotal)}</td>
            </tr>
            ${transaction.discountAmount > 0 ? `
              <tr>
                <td>Diskon (${transaction.discount.type === 'percent' ? transaction.discount.amount + '%' : ''})</td>
                <td class="text-end">-${formatCurrency(transaction.discountAmount)}</td>
              </tr>
            ` : ''}
            ${transaction.taxAmount > 0 ? `
              <tr>
                <td>Pajak (${transaction.tax}%)</td>
                <td class="text-end">${formatCurrency(transaction.taxAmount)}</td>
              </tr>
            ` : ''}
            <tr class="fw-bold">
              <td>TOTAL</td>
              <td class="text-end">${formatCurrency(transaction.total)}</td>
            </tr>
            <tr>
              <td>Bayar (${transaction.paymentMethod === 'cash' ? 'Tunai' : 
                  transaction.paymentMethod === 'debit' ? 'Debit' : 
                  transaction.paymentMethod === 'credit' ? 'Kredit' : 'Transfer'})</td>
              <td class="text-end">${formatCurrency(transaction.paymentAmount)}</td>
            </tr>
            <tr>
              <td>Kembalian</td>
              <td class="text-end">${formatCurrency(transaction.paymentAmount - transaction.total)}</td>
            </tr>
          </tbody>
        </table>
        
        <div class="text-center mt-3">
          <p>Terima kasih telah berbelanja</p>
        </div>
      `;
      
      render($('#printable-receipt'), receiptContent);
      $('#transactionDetailModal').style.display = 'flex';
    };
    
    const renderProductsTable = () => {
      const tbody = $('#adminProductsTable');
      const search = $('#productSearch').value.toLowerCase();
      
      let filteredProducts = appState.products.filter(p => 
        p.name.toLowerCase().includes(search) && 
        p.active
      );
      
      if (filteredProducts.length === 0) {
        render(tbody, '<tr><td colspan="7" class="text-center py-5">Tidak ada produk ditemukan</td></tr>');
        return;
      }
      
      render(tbody, filteredProducts.map((p, index) => {
        const category = appState.categories.find(c => c.id === p.categoryId) || { name: 'Umum' };
        let stockStatus = '';
        let statusClass = '';
        
        if (p.stock <= 0) {
          stockStatus = 'Habis';
          statusClass = 'danger';
        } else if (p.stock <= 10) {
          stockStatus = 'Sedikit';
          statusClass = 'warning';
        } else {
          stockStatus = 'Tersedia';
          statusClass = 'success';
        }
        
        return `
          <tr>
            <td>${index + 1}</td>
            <td>
              <div class="fw-bold">${p.name}</div>
            </td>
            <td>${category.name}</td>
            <td>${formatCurrency(p.price)}</td>
            <td>${p.stock}</td>
            <td><span class="badge badge-${statusClass}">${stockStatus}</span></td>
            <td>
              <button class="btn btn-sm btn-primary edit-btn" data-type="products" data-id="${p.id}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger delete-btn" data-type="products" data-id="${p.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderCategoriesTable = () => {
      const tbody = $('#adminCategoriesTable');
      const categories = appState.categories;
      
      if (categories.length === 0) {
        render(tbody, '<tr><td colspan="4" class="text-center py-5">Tidak ada kategori</td></tr>');
        return;
      }
      
      render(tbody, categories.map(c => {
        const productCount = appState.products.filter(p => p.categoryId === c.id).length;
        
        return `
          <tr>
            <td>
              <div class="fw-bold">${c.name}</div>
            </td>
            <td>${productCount} produk</td>
            <td>
              <span class="badge ${c.active ? 'badge-success' : 'badge-danger'}">
                ${c.active ? 'Aktif' : 'Nonaktif'}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-primary edit-btn" data-type="categories" data-id="${c.id}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger delete-btn" data-type="categories" data-id="${c.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderCustomersTable = () => {
      const tbody = $('#adminCustomersTable');
      const search = $('#customerSearch').value.toLowerCase();
      
      let filteredCustomers = appState.customers.filter(c => 
        c.name.toLowerCase().includes(search) && 
        c.active
      );
      
      if (filteredCustomers.length === 0) {
        render(tbody, '<tr><td colspan="5" class="text-center py-5">Tidak ada pelanggan</td></tr>');
        return;
      }
      
      render(tbody, filteredCustomers.map(c => {
        const customerTransactions = appState.transactions.filter(t => t.customer === c.id);
        const totalSpending = customerTransactions.reduce((sum, t) => sum + t.total, 0);
        
        return `
          <tr>
            <td>
              <div class="fw-bold">${c.name}</div>
            </td>
            <td>${c.phone || '-'}</td>
            <td>${c.email || '-'}</td>
            <td>${formatCurrency(totalSpending)}</td>
            <td>
              <button class="btn btn-sm btn-primary edit-btn" data-type="customers" data-id="${c.id}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger delete-btn" data-type="customers" data-id="${c.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderCashiersTable = () => {
      const tbody = $('#adminCashiersTable');
      const cashiers = appState.cashiers;
      
      if (cashiers.length === 0) {
        render(tbody, '<tr><td colspan="5" class="text-center py-5">Tidak ada kasir</td></tr>');
        return;
      }
      
      render(tbody, cashiers.map(c => {
        return `
          <tr>
            <td>${c.id}</td>
            <td>${c.name}</td>
            <td>${c.role === 'admin' ? 'Administrator' : 'Kasir'}</td>
            <td>
              <span class="badge ${c.active ? 'badge-success' : 'badge-danger'}">
                ${c.active ? 'Aktif' : 'Nonaktif'}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-primary edit-btn" data-type="cashiers" data-id="${c.id}">
                <i class="fas fa-edit"></i>
              </button>
              ${c.id !== currentCashier.id ? `
                <button class="btn btn-sm btn-danger delete-btn" data-type="cashiers" data-id="${c.id}">
                  <i class="fas fa-trash"></i>
                </button>
              ` : ''}
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const renderReports = () => {
      const reportContainer = $('#reportContainer');
      render(reportContainer, `
        <div class="text-center py-5">
          <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
          <p>Pilih parameter laporan dan klik "Generate" untuk melihat data</p>
        </div>
      `);
    };
    
    const renderSettings = () => {
      $('#settingStoreName').value = appState.settings.storeName || '';
      $('#settingStoreAddress').value = appState.settings.storeAddress || '';
      $('#settingStorePhone').value = appState.settings.storePhone || '';
      $('#settingStoreEmail').value = appState.settings.storeEmail || '';
      $('#settingDefaultTax').value = appState.settings.defaultTax || 0;
    };
    
    // Form handlers
    const handleFormSubmit = (e) => {
      e.preventDefault();
      const form = e.target;
      const type = form.dataset.type;
      const formData = new FormData(form);
      const id = formData.get('id');
      
      let entry = {};
      formData.forEach((value, key) => {
        if (key !== 'id') {
          if (form.elements[key]?.type === 'checkbox') {
            entry[key] = form.elements[key].checked;
          } else {
            entry[key] = value;
          }
        }
      });
      
      if (type === 'cashiers' && entry.id_new) {
        entry.id = entry.id_new;
        delete entry.id_new;
      }
      
      if (entry.active === undefined) {
        entry.active = true;
      }
      
      if (id) {
        const index = appState[type].findIndex(i => i.id === id);
        if (index !== -1) {
          if (type === 'cashiers' && !entry.pin') {
            entry.pin = appState[type][index].pin;
          }
          
          appState[type][index] = { ...appState[type][index], ...entry };
        }
      } else {
        entry.id = type === 'cashiers' ? entry.id : `${type.slice(0,3)}-${Date.now()}`;
        
        if (type === 'products') {
          entry.stock = entry.stock || 0;
          entry.price = entry.price || 0;
        }
        
        appState[type].push(entry);
      }
      
      saveState(type);
      updateUIAfterChange(type);
      $('#itemModal').style.display = 'none';
      showToast('Data berhasil disimpan');
    };
    
    const updateUIAfterChange = (type) => {
      switch (type) {
        case 'products':
          renderProductsTable();
          renderProductGrid();
          break;
        case 'categories':
          renderCategoriesTable();
          renderProductGrid();
          break;
        case 'customers':
          renderCustomersTable();
          renderCustomerSelect();
          break;
        case 'cashiers':
          renderCashiersTable();
          break;
        case 'settings':
          $('#sidebarStoreName').textContent = appState.settings.storeName;
          break;
      }
    };
    
    const handleDelete = (type, id) => {
      const item = appState[type].find(i => i.id === id);
      if (!item) return;
      
      let warning = '';
      
      if (type === 'categories') {
        const productCount = appState.products.filter(p => p.categoryId === id).length;
        if (productCount > 0) {
          showToast('Tidak dapat menghapus kategori yang memiliki produk', 'error');
          return;
        }
        warning = `Yakin ingin menghapus kategori "${item.name}"?`;
      } else if (type === 'products') {
        warning = `Yakin ingin menghapus produk "${item.name}"?`;
      } else if (type === 'customers') {
        warning = `Yakin ingin menghapus pelanggan "${item.name}"?`;
      } else if (type === 'cashiers') {
        if (item.id === currentCashier.id) {
          showToast('Tidak dapat menghapus akun sendiri', 'error');
          return;
        }
        warning = `Yakin ingin menghapus kasir "${item.name}"?`;
      }
      
      showConfirmation(warning, () => {
        appState[type] = appState[type].filter(i => i.id !== id);
        saveState(type);
        updateUIAfterChange(type);
        showToast('Item berhasil dihapus');
      });
    };
    
    // Transaction handlers
    const handleCheckout = () => {
      if (currentCart.items.length === 0) {
        showToast('Keranjang kosong', 'error');
        return;
      }
      
      const paymentAmount = parseFloat($('#paymentAmount').value) || 0;
      if (paymentAmount < currentCart.total) {
        showToast('Jumlah pembayaran kurang', 'error');
        return;
      }
      
      const transaction = {
        id: `TRX-${Date.now().toString().slice(-6)}`,
        date: new Date().toISOString(),
        customer: $('#customerSelect').value || null,
        items: [...currentCart.items],
        subtotal: currentCart.subtotal,
        discount: { ...currentCart.discount },
        discountAmount: currentCart.discountAmount,
        tax: currentCart.tax,
        taxAmount: currentCart.taxAmount,
        total: currentCart.total,
        paymentMethod: $('#paymentMethod').value,
        paymentAmount: paymentAmount,
        cashierId: currentCashier.id
      };
      
      currentCart.items.forEach(item => {
        const product = appState.products.find(p => p.id === item.id);
        if (product) {
          product.stock -= item.quantity;
          if (product.stock < 0) product.stock = 0;
        }
      });
      
      appState.transactions.push(transaction);
      saveState('transactions');
      saveState('products');
      
      resetCart();
      renderTransactionDetail(transaction.id);
      showToast('Transaksi berhasil', 'success');
    };
    
    const resetCart = () => {
      currentCart = { 
        items: [],
        customer: null,
        paymentMethod: 'cash',
        discount: { amount: 0, type: 'percent' },
        tax: appState.settings.defaultTax || 0,
        date: new Date()
      };
      
      $('#paymentAmount').value = '';
      $('#discountAmount').value = '0';
      $('#discountType').value = 'percent';
      $('#taxAmount').value = appState.settings.defaultTax || '0';
      $('#paymentMethod').value = 'cash';
      $('#customerSelect').value = '';
      
      renderCart();
    };
    
    const holdCurrentTransaction = () => {
      if (currentCart.items.length === 0) {
        showToast('Keranjang kosong', 'error');
        return;
      }
      
      const heldTransaction = {
        id: `HLD-${Date.now().toString().slice(-6)}`,
        date: new Date().toISOString(),
        ...currentCart
      };
      
      if (!appState.held_transactions) {
        appState.held_transactions = [];
      }
      
      appState.held_transactions.push(heldTransaction);
      saveState('held_transactions');
      
      resetCart();
      showToast('Transaksi ditahan', 'success');
    };
    
    const recallHeldTransaction = (transactionId) => {
      const transaction = appState.held_transactions.find(t => t.id === transactionId);
      if (!transaction) return;
      
      for (const item of transaction.items) {
        const product = appState.products.find(p => p.id === item.id);
        if (!product || product.stock < item.quantity) {
          showToast(`Produk ${item.name} tidak tersedia cukup`, 'error');
          return;
        }
      }
      
      currentCart = {
        items: [...transaction.items],
        customer: transaction.customer,
        paymentMethod: transaction.paymentMethod,
        discount: { ...transaction.discount },
        tax: transaction.tax,
        date: new Date()
      };
      
      $('#paymentMethod').value = currentCart.paymentMethod;
      $('#discountAmount').value = currentCart.discount.amount;
      $('#discountType').value = currentCart.discount.type;
      $('#taxAmount').value = currentCart.tax;
      
      if (currentCart.customer) {
        $('#customerSelect').value = currentCart.customer.id;
      }
      
      renderCart();
      $('#holdTransactionModal').style.display = 'none';
      showToast('Transaksi dipanggil', 'success');
    };
    
    const renderHeldTransactions = () => {
      const tbody = $('#heldTransactionsTable');
      
      if (!appState.held_transactions || appState.held_transactions.length === 0) {
        render(tbody, '<tr><td colspan="4" class="text-center py-3">Tidak ada transaksi ditahan</td></tr>');
        return;
      }
      
      render(tbody, appState.held_transactions.map(t => {
        const itemCount = t.items.reduce((sum, item) => sum + item.quantity, 0);
        
        return `
          <tr>
            <td>${t.id}</td>
            <td>${formatDate(t.date)}</td>
            <td>${itemCount} item</td>
            <td class="text-end">
              <button class="btn btn-sm btn-primary recall-transaction-btn" data-id="${t.id}">
                <i class="fas fa-redo"></i>
              </button>
              <button class="btn btn-sm btn-danger delete-held-transaction-btn" data-id="${t.id}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join(''));
    };
    
    const deleteHeldTransaction = (transactionId) => {
      appState.held_transactions = appState.held_transactions.filter(t => t.id !== transactionId);
      saveState('held_transactions');
      renderHeldTransactions();
      showToast('Transaksi dihapus', 'success');
    };
    
    // Cart functions
    const addProductToCart = (product) => {
      if (product.stock <= 0) {
        showToast('Stok habis', 'error');
        return;
      }
      
      const cartItem = currentCart.items.find(i => i.id === product.id);
      
      if (cartItem) {
        if (cartItem.quantity >= product.stock) {
          showToast('Stok tidak mencukupi', 'error');
          return;
        }
        cartItem.quantity++;
      } else {
        currentCart.items.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: 1
        });
      }
      
      renderCart();
    };
    
    const updateCartItemQuantity = (index, quantity) => {
      if (quantity < 1) {
        showToast('Jumlah tidak valid', 'error');
        return;
      }
      
      const product = appState.products.find(p => p.id === currentCart.items[index].id);
      if (!product) return;
      
      if (quantity > product.stock) {
        showToast('Stok tidak mencukupi', 'error');
        currentCart.items[index].quantity = product.stock;
        renderCart();
        return;
      }
      
      currentCart.items[index].quantity = quantity;
      updateCartSummary();
    };
    
    const removeCartItem = (index) => {
      currentCart.items.splice(index, 1);
      renderCart();
    };
    
    // Login/Logout
    const handleLogin = (e) => {
      e.preventDefault();
      const id = $('#loginCashierId').value;
      const pin = $('#loginCashierPin').value;
      
      const cashier = appState.cashiers.find(c => c.id === id && c.pin === pin && c.active);
      
      if (cashier) {
        currentCashier = cashier;
        localStorage.setItem(STORAGE_KEYS.CURRENT_CASHIER, JSON.stringify(cashier));
        initUI();
      } else {
        showToast('ID atau PIN salah', 'error');
      }
    };
    
    const handleLogout = () => {
      showConfirmation('Yakin ingin logout?', () => {
        currentCashier = null;
        localStorage.removeItem(STORAGE_KEYS.CURRENT_CASHIER);
        $('#mainApp').style.display = 'none';
        $('#loginModal').style.display = 'flex';
        $('#loginCashierId').value = '';
        $('#loginCashierPin').value = '';
        $('#loginCashierId').focus();
      });
    };
    
    // Initialize UI after login
    const initUI = () => {
      $('#mainApp').style.display = 'flex';
      $('#loginModal').style.display = 'none';
      
      $('#sidebarStoreName').textContent = appState.settings.storeName;
      $('#sidebarCashierName').textContent = currentCashier.name;
      $('#sidebarCashierRole').textContent = currentCashier.role === 'admin' ? 'Administrator' : 'Kasir';
      $('#topbarCashierName').textContent = currentCashier.name;
      
      if (currentCashier.role !== 'admin') {
        $$('[data-tab="products"], [data-tab="categories"], [data-tab="customers"], [data-tab="cashiers"], [data-tab="reports"], [data-tab="settings"]').forEach(el => {
          el.style.display = 'none';
        });
      }
      
      renderDashboard();
      renderCashierView();
      renderTransactions();
      renderProductsTable();
      renderCategoriesTable();
      renderCustomersTable();
      renderCashiersTable();
      renderReports();
      renderSettings();
      
      $('#reportDateRange').daterangepicker({
        locale: {
          format: 'DD/MM/YYYY',
          applyLabel: 'Pilih',
          cancelLabel: 'Batal',
          fromLabel: 'Dari',
          toLabel: 'Sampai'
        },
        opens: 'left',
        autoUpdateInput: false
      });
      
      $('#reportDateRange').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
      });
    };
    
    // Event listeners setup
    const setupEventListeners = () => {
      $('#loginForm').addEventListener('submit', handleLogin);
      $('#logoutBtn').addEventListener('click', handleLogout);
      $('#sidebarLogoutBtn').addEventListener('click', handleLogout);
      $('#topbarLogoutBtn').addEventListener('click', handleLogout);
      
      $('#itemForm').addEventListener('submit', handleFormSubmit);
      $('#storeSettingsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        appState.settings.storeName = $('#settingStoreName').value;
        appState.settings.storeAddress = $('#settingStoreAddress').value;
        appState.settings.storePhone = $('#settingStorePhone').value;
        appState.settings.storeEmail = $('#settingStoreEmail').value;
        appState.settings.defaultTax = parseFloat($('#settingDefaultTax').value) || 0;
        
        saveState('settings');
        showToast('Pengaturan disimpan', 'success');
        $('#sidebarStoreName').textContent = appState.settings.storeName;
      });
      
      $$('.close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('.modal').style.display = 'none';
        });
      });
      
      $$('.menu-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const tab = this.dataset.tab;
          
          $$('.tab-content').forEach(content => content.classList.remove('active'));
          $$('.menu-item').forEach(i => i.classList.remove('active'));
          
          $(`#${tab}Tab`).classList.add('active');
          this.classList.add('active');
          
          if (tab === 'dashboard') {
            renderDashboard();
          } else if (tab === 'cashier') {
            renderCashierView();
          } else if (tab === 'transactions') {
            renderTransactions();
          }
        });
      });
      
      $('#productSearchCart').addEventListener('input', renderProductGrid);
      $('#paymentAmount').addEventListener('input', updateChange);
      $('#discountAmount').addEventListener('input', updateCartSummary);
      $('#discountType').addEventListener('change', updateCartSummary);
      $('#taxAmount').addEventListener('input', function() {
        currentCart.tax = parseFloat(this.value) || 0;
        updateCartSummary();
      });
      $('#paymentMethod').addEventListener('change', function() {
        currentCart.paymentMethod = this.value;
      });
      $('#customerSelect').addEventListener('change', function() {
        currentCart.customer = this.value ? 
          appState.customers.find(c => c.id === this.value) : null;
      });
      
      document.addEventListener('click', function(e) {
        if (e.target.closest('.product-card')) {
          const productId = e.target.closest('.product-card').dataset.id;
          const product = appState.products.find(p => p.id === productId);
          if (product) addProductToCart(product);
        }
        
        if (e.target.closest('.cashier-right-panel .tab')) {
          const tab = e.target.closest('.tab');
          $$('.cashier-right-panel .tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          renderProductGrid();
        }
      });
      
      document.addEventListener('change', function(e) {
        if (e.target.classList.contains('cart-item-qty')) {
          const index = e.target.dataset.index;
          const quantity = parseInt(e.target.value) || 1;
          updateCartItemQuantity(index, quantity);
        }
      });
      
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-from-cart-btn') || 
            e.target.closest('.remove-from-cart-btn')) {
          const index = e.target.closest('.remove-from-cart-btn').dataset.index;
          removeCartItem(index);
        }
      });
      
      $('#checkoutBtn').addEventListener('click', handleCheckout);
      
      $('#holdTransactionBtn').addEventListener('click', holdCurrentTransaction);
      $('#recallTransactionBtn').addEventListener('click', function() {
        renderHeldTransactions();
        $('#holdTransactionModal').style.display = 'flex';
      });
      
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('recall-transaction-btn') || 
            e.target.closest('.recall-transaction-btn')) {
          const transactionId = e.target.closest('.recall-transaction-btn').dataset.id;
          recallHeldTransaction(transactionId);
        }
        
        if (e.target.classList.contains('delete-held-transaction-btn') || 
            e.target.closest('.delete-held-transaction-btn')) {
          const transactionId = e.target.closest('.delete-held-transaction-btn').dataset.id;
          deleteHeldTransaction(transactionId);
        }
      });
      
      $('#newTransactionBtn').addEventListener('click', resetCart);
      
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('view-transaction-btn') || 
            e.target.closest('.view-transaction-btn')) {
          const transactionId = e.target.closest('.view-transaction-btn').dataset.id;
          renderTransactionDetail(transactionId);
        }
      });
      
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('edit-btn') || 
            e.target.closest('.edit-btn')) {
          const btn = e.target.closest('.edit-btn');
          openModal(btn.dataset.type, btn.dataset.id);
        }
        
        if (e.target.classList.contains('delete-btn') || 
            e.target.closest('.delete-btn')) {
          const btn = e.target.closest('.delete-btn');
          handleDelete(btn.dataset.type, btn.dataset.id);
        }
      });
      
      $('#addProductBtn').addEventListener('click', () => openModal('products'));
      $('#addCategoryBtn').addEventListener('click', () => openModal('categories'));
      $('#addCashierBtn').addEventListener('click', () => openModal('cashiers'));
      $('#addCustomerBtn').addEventListener('click', () => openModal('customers'));
      $('#addCustomerBtn2').addEventListener('click', () => openModal('customers'));
      
      $('#productSearch').addEventListener('input', renderProductsTable);
      $('#customerSearch').addEventListener('input', renderCustomersTable);
      $('#transactionSearch').addEventListener('input', renderTransactions);
      
      $('#applyReportFilterBtn').addEventListener('click', renderReports);
      
      $$('.sidebar-toggle').forEach(btn => {
        btn.addEventListener('click', function() {
          $('.sidebar').classList.toggle('active');
        });
      });
      
      document.addEventListener('click', function(e) {
        if (window.innerWidth <= 992) {
          if (!$('.sidebar').contains(e.target) && !e.target.closest('.sidebar-toggle')) {
            $('.sidebar').classList.remove('active');
          }
        }
      });
    };
    
    // Initialize the application
    initApp();
  });
  </script>
</body>
</html>
